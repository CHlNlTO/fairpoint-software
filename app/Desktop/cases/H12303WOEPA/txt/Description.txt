           SERVICE CHAIN FAULT DETECTION METHOD AND
                                            APPARATUS

        [0001] This application claims priority to Chinese Patent Application No.
        CN201410224672.0, filed With the Chinese Patent Office on May 26, 2014 and
        entitled "SERVICE CHAIN FAULT DETECTION METHOD AND APPARATUS",
        Which is incorporated herein by reference in its entirety.

                                                  TECHNICAL FIELD

         [0002] The present invention relates to communications technologies, and in
        particular, to a service chain fault detection method, a service forwarding apparatus, a
10 device for initiating fault detection, and a service function apparatus.

                                                     BACKGROUND

        [0003] In addition to providing basic forwarding functions such as switching and
        routing, a general network device may further provide a value-added service (English
        full name: Value-Added Service, English abbreviation: VAS). For example, the VAS
15 may be a service such as network address translation (English fiall name: Network
        Address Translation, English abbreviation: NAT) or a firewall.
        [0004] In a network that provides a value-added service, a service chain (English
        name: service chain) includes a service classifier (English name: service classifier)
        and N service forwarding entities (English filll name: service forwarding entity,
20 English abbreviation: SFE). The SFEs included in the service chain are successively
        connected. The SFE may be connected to one or more service function (English fiall
        name: service fianction, English abbreviation: SF) nodes. According to a service to
        Which a received packet belongs, the service classifier adds an identifier of the service
        chain to the packet, to obtain a service packet. The service classifier sends the service
25 packet to an SFE connected to the service classifier. The SFE sends the received
        service packet to an SF node that is connected to the SFE and that belongs to the
        service chain, and the SF node performs service processing on the service packet.

                                                                                         1
        [0005] To implement normal forwarding 0f the service packet, a detection deVice
        in the network may detect whether the SFE, the SF node, and the service classifier can
        forward the service packet. When the SFE can forward the service packet to the SF
        node that is connected to the SFE and that belongs to the service chain, the detection
        deVice cannot detect Whether an order in Which the SFE forwards the service packet to
        an SF node belonging to the service chain is correct, that is, the detection device
        cannot learn an SF node that the service packet passes through When being forwarded
         0n the service chain.

                                                        SUMMARY

10 [0006] In View of the foregoing, embodiments of the present invention provide a
        service Chain fault detection method, a service forwarding apparatus, a device for
        initiating fault detection, and a service function apparatus, Which are helpful to learn
        an SF node that a service packet passes through When being forwarded on a service
        chain.

15 [0007] The technical solutions provided in the embodiments of the present
        invention are as follows:
        [0008] According to a first aspect, a service chain fault detection method is
        provided, including:
                       obtaining, by an SFE, a first fault tracing detection request packet, and

20 then determining to communicate With a first SF node, Where the first fault tracing
        detection request packet includes a path ID and an address of a device for initiating
        fault detection, and the path ID is used to identify a path of a service chain;
                       obtaining, by the SFE, an ID of the first SF node; and
                       sending, by the SFE, a first fault tracing detection response packet to the

25 device for initiating fault detection, Where the first fault tracing detection response
        packet includes the path ID, the ID of the first SF node, and the address of the device
        for initiating fault detection.
        [0009] In a first possible implementation manner of the foregoing first aspect, the
        determining, by an SFE, to communicate With a first SF node 011 the service chain

30 includes:
                       determining, by the SFE according to the path ID, to forward the first fault

        tracing detection request packet according to a first forwarding entry, Where the first
    forwarding entry includes the path ID and an address of the first SF node;

    sending, by the SFE, the first fault tracing detection request packet to the

    first SF node according to the address of the first SF node; and

    receiving, by the SFE, a second fault tracing detection request packet from

    the first SF node, where the second fault tracing detection request packet includes the

    path ID and the address of the deVice for initiating fault detection.

    [0010] With reference to the first possible implementation manner of the

    foregoing first aspect, a second possible implementation manner of the first aspect is

    further provided, Where the first fault tracing detection request packet further includes

10 a first parameter, the first parameter is used to identify the first SF node or is used to

    identify a previous-hop SF node of the first SF node 011 the service chain, and the first

    forwarding entry further includes the first parameter; and

    the determining, by the SFE according to the path ID, to forward the first

    fault tracing detection request packet according to a first forwarding entry includes:

15 determining, by the SFE according to the first parameter and the path ID, to forward

    the first fault tracing detection request packet according to the first forwarding entry.

    [0011] With reference to the second possible implementation manner of the

    foregoing first aspect, a third possible implementation manner of the first aspect is

    further provided, Where the first fault tracing detection request packet further includes

20 a time to live (English filll name: time to live, English abbreviation: TTL) field;

    after the receiving, by the SFE, a second fault tracing detection request

    packet from the first SF node, the method further includes: obtaining, by the SFE, a

    TTL parameter, Where the TTL parameter is data obtained after a value of the TTL

    field in the first fault tracing detection request packet is updated; and

25  the sending, by the SFE, a first fault tracing detection response packet to

    the deVice for initiating fault detection includes: When the TTL parameter is equal to a

    preset value, sending, by the SFE, the first fault tracing detection response packet to

    the deVice for initiating fault detection.

    [0012] With reference to the third possible implementation manner of the

30 foregoing first aspect, a fourth possible implementation manner of the first aspect is

    further provided, where the method fithher includes:

    When the TTL parameter is not equal to the preset value, obtaining, by the

    SFE, a third fault tracing detection request packet, Where the third fault tracing

    detection request packet includes a second parameter, the path ID, a TTL field, and

                                                3
    the address of the device for initiating fault detection, and the second parameter is
    used to identify a next-hop SF node of an SF node, on the service chain, identified by
    using the first parameter;

                  determining, by the SFE according to the second parameter and the path
    ID, to forward the third fault tracing detection request packet according to a second
    forwarding entry, Where the second forwarding entry includes the path ID, the second

    parameter, and an address of a first device, the first device is a next-hop SFE 0f the

    SFE 0n the service chain or a second SF node, and the second SF node is a next-hop

    SF node of the first SF node on the service chain; and

10             sending, by the SFE, the third fault tracing detection request packet to the

    first device according to the address of the first device.

    [0013] With reference to the second possible implementation manner of the

    foregoing first aspect, a fifth possible implementation manner of the first aspect is

    further provided, Where before the sending, by the SFE, a first fault tracing detection

15 response packet to the device for initiating fault detection, the method further

    includes:

               sending, by the SFE, a second fault tracing detection response packet to

    the device for initiating fault detection, Where the second fault tracing detection

    response packet includes the path ID, an ID of the SFE, and the address of the deVice

20 for initiating fault detection.

    [0014] With reference to the second possible implementation manner of the

    foregoing first aspect or the fifth possible implementation manner of the first aspect, a

    sixth possible implementation manner of the first aspect is filrther provided, Where

    after the sending, by the SFE, a first fault tracing detection response packet to the

25 device for initiating fault detection, the method further includes:

               obtaining, by the SFE, a fourth fault tracing detection request packet,

    where the fourth fault tracing detection request packet includes a second parameter,

    the path ID, and the address of the device for initiating fault detection, and the second

    parameter is used to identify a next-hop SF node of an SF node, 011 the service chain,

30 identified by using the first parameter;

               determining, by the SFE according to the second parameter and the path

    ID, to forward the fourth fault tracing detection request packet according to a second

    forwarding entry, Where the second forwarding entry includes the path ID, the second

    parameter, and an address of a first device, the first device is a next-hop SFE 0f the

                                             4
        SFE 0n the service chain or a second SF node, and the second SF node is a next-hop
        SF node of the first SF node on the service chain; and

                       sending, by the SFE, the fourth fault tracing detection request packet to the
        first device according to the address of the first device.
        [0015] With reference to the sixth possible implementation manner of the
        foregoing first aspect, a seventh possible implementation manner of the first aspect is
        further provided, Where the first deVice is the second SF node, and the method further
        includes:

                       receiving, by the SFE, a fifth fault tracing detection request packet from
10 the second SF node, Where the fifth fault tracing detection request packet includes the

        path ID and the address of the device for initiating fault detection;
                       obtaining, by the SFE, an ID of the second SF node according to the fifth

        fault tracing detection request packet; and
                       sending, by the SFE, a third fault tracing detection response packet to the

15 device for initiating fault detection, Where the third fault tracing detection response
        packet includes the path ID, the ID of the second SF node, and the address of the
        device for initiating fault detection.
        [0016] With reference to the first possible implementation manner of the
        foregoing first aspect, the second possible implementation manner of the first aspect,

20 the fifth possible implementation manner of the first aspect, the sixth possible
        implementation manner of the first aspect, or the seventh possible implementation
        manner of the first aspect, an eighth possible implementation manner of the first
        aspect is further provided, Where the method fithher includes:
                       adding, by the SFE, at least one of the first parameter or the ID of the SFE

25 t0 the first fault tracing detection response packet.
        [0017] With reference to the first possible implementation manner of the
        foregoing first aspect, the second possible implementation manner of the first aspect,
        the fifth possible implementation manner of the first aspect, the sixth possible
        implementation manner of the first aspect, or the seventh possible implementation

30 manner of the first aspect, a ninth possible implementation manner of the first aspect
        is filrther provided, Where the first fault tracing detection request packet further
        includes a node list, and the node list includes an ID of the previous-hop SF node of
         the first SF node 011 the service chain; and
                       before the sending, by the SFE, a first fault tracing detection response

                                                                                        5
    packet to the device for initiating fault detection, the method filrther includes:

    obtaining, by the SFE, an updated node list, where the updated node list is

    a list generated after the ID of the first SF node is added to the node list, and an order

    of all SF nodes included in the updated node list is the same as an order of all the SF

    nodes on the service chain; and

    adding, by the SFE, the updated node list to the first fault tracing detection

    response packet.

    [0018] With reference to any one of the first possible implementation manner of

    the foregoing first aspect, the second possible implementation manner of the first

10 aspect, or the fifth possible implementation manner of the first aspect to the ninth

    possible implementation manner of the first aspect, a tenth possible implementation

    manner of the first aspect is filrther provided, Where the first fault tracing detection

    request packet further includes an ID of an SF node used as an end point; and

    after the sending, by the SFE, a first fault tracing detection response packet

15 to the device for initiating fault detection, the method filrther includes:

    ending, by the SFE, detection on the service chain When the ID of the first

    SF node is the same as the ID of the SF node used as the end point.

    [0019] With reference to any one of the foregoing first aspect or possible

    implementation manners of the first aspect, an eleventh possible implementation

20 manner of the first aspect is filrther provided, Where the obtaining, by an SFE, a first

    fault tracing detection request packet includes:

    receiving, by the SFE, the first fault tracing detection request packet sent

    by the device for initiating fault detection; or

    receiving, by the SFE, the first fault tracing detection request packet sent

25 by a previous-hop SFE of the SFE on the service chain; or

    generating, by the SFE, the first fault tracing detection request packet.

    [0020] With reference to any one of the foregoing first aspect or possible

    implementation manners of the first aspect, a twelfth possible implementation manner

    of the first aspect is fiarther provided, Where

30  the sending, by the SFE, a first fault tracing detection response packet to

    the device for initiating fault detection includes:

    obtaining, by the SFE, a path ID of a reverse service chain of the service

    chain by using the path ID, Where the reverse service chain and the service Chain are

    opposite in direction; and
    sending, by the SFE according to a forwarding entry corresponding to the

    path ID of the reverse service chain, the first fault tracing detection response packet to

    the device for initiating fault detection, Where the forwarding entry corresponding to

    the path ID of the reverse service chain includes the path ID of the reverse service

    chain and the address of the device for initiating fault detection; or

    the sending, by the SFE, a first fault tracing detection response packet to

    the device for initiating fault detection includes:

    adding, by the SFE, the first fault tracing detection response packet to a

    unicast Internet Protocol (English full name: Internet Protocol, English abbreviation:

10 1P) packet, and sending the unicast IP packet to the device for initiating fault detection,

    where a destination IP address in the unicast 1P packet is the address of the deVice for

    initiating fault detection.

    [0021] According to a second aspect, a service chain fault detection method is

    provided, including:

15  sending, by a device for initiating fault detection, at first fault tracing

    detection request packet to an SFE, Where the first fault tracing detection request

    packet includes a path identifier ID and an address of the device for initiating fault

    detection, and the path ID is used to identify a path of a service chain;

    receiving, by the device for initiating fault detection, at first fault tracing

20 detection response packet from the SFE, where the first fault tracing detection

    response packet includes the path ID, an ID of a first SF node, and the address of the

    device for initiating fault detection; and

    after receiving the first fault tracing detection response packet, determining,

    by the device for initiating fault detection, that the service chain passes through the

25 first SF node, and forwarding between the SFE and the first SF node is normal.

    [0022] In a first possible implementation manner of the second aspect, the sending,

    by a device for initiating fault detection, at first fault tracing detection request packet

    to the SFE includes:

    determining, according to the path ID by the device for initiating fault

30 detection, to forward the first fault tracing detection request packet according to a

    forwarding entry, Where the forwarding entry includes the path ID and an address of

    the SFE; and

    sending, by the device for initiating fault detection, the first fault tracing

    detection request packet to the SFE according to the address of the SFE.

                                                7
        [0023] With reference to the foregoing second aspect or the first possible
        implementation manner of the second aspect, a second possible implementation
        manner of the second aspect is filrther provided, Where the first fault tracing detection
        request packet filrther includes a first parameter, and the first parameter is used to
        identify the first SF node or is used to identify a previous-hop SF node of the first SF
        node 011 the service chain.
        [0024] With reference to the foregoing second aspect, the first possible
        implementation manner of the second aspect, or the second possible implementation
        manner of the second aspect, a third possible implementation manner of the second
10 aspect is further provided, Where the first fault tracing detection request packet further
        includes a TTL field.
        [0025] With reference to the foregoing second aspect, the first possible
        implementation manner of the second aspect, or the second possible implementation
        manner of the second aspect, a fourth possible implementation manner of the second
15 aspect is further provided, Where the first fault tracing detection request packet further
        includes a node list, and the node list includes an ID of the previous-hop SF node of
        the first SF node 011 the service chain; and the first fault tracing detection response
        packet further includes an updated node list, the updated node list is a list generated
         after the ID of the first SF node is added to the node list, and an order of all SF nodes
20 included in the updated node list is the same as an order of all the SF nodes 011 the
        service chain.
        [0026] With reference to the foregoing second aspect, the first possible
        implementation manner of the second aspect, or the second possible implementation
        manner of the second aspect, a fifth possible implementation manner of the second
25 aspect is further provided, Where before the receiving, by the device for initiating fault
        detection, at first fault tracing detection response packet from the SFE, the method
        further includes:

                       receiving, by the device for initiating fault detection, at second fault tracing
        detection response packet from the SFE, where the second fault tracing detection
30 response packet includes the path ID, an ID of the SFE, and the address of the deVice
        for initiating fault detection; and

                       after receiving the second fault tracing detection response packet,
        determining, by the device for initiating fault detection, that the service chain passes
        through the SFE, and forwarding between the SFE and the device for initiating fault

                                                                                        8
    detection is normal.

    [0027] With reference to any one of the foregoing second aspect or possible

    implementation manners of the second aspect, a sixth possible implementation

    manner of the second aspect is filrther provided, Where after the receiving, by the

    deVice for initiating fault detection, at first fault tracing detection response packet from

    the SFE, the method further includes:

               receiving, by the deVice for initiating fault detection, at third fault tracing

    detection response packet from the SFE, where the third fault tracing detection

    response packet includes the path ID, an ID of a second SF node, and the address of

10 the device for initiating fault detection, and the second SF node is a next-hop SF node

    of the first SF node on the service chain; and

               after receiving the third fault tracing detection response packet,

    determining, by the deVice for initiating fault detection, that the service chain passes

    through the second SF node, and forwarding between the SFE and the second SF node

15 is normal.

    [0028] According to a third aspect, a service chain fault detection method is

    provided, including:

               receiving, by an SF node, a first fault tracing detection request packet from

    an SFE, Where the first fault tracing detection request packet includes a path identifier

20 ID and an address of a deVice for initiating fault detection, and the path ID is used to

    identify a path of a service chain; and

               sending, by the SF node, a second fault tracing detection request packet to

    the SFE, Where the second fault tracing detection request packet includes the path ID

    and the address of the deVice for initiating fault detection.

25 [0029] In a first possible implementation manner of the third aspect, the first fault

    tracing detection request packet and the second fault tracing detection request packet

    each further includes a TTL field; and
                  before the sending, by the SF node, a second fault tracing detection request

    packet to the SFE, the method fithher includes:

30             obtaining, by the SF node, a TTL parameter, Where the TTL parameter is

    data obtained after a value of the TTL field included in the first fault tracing detection

    request packet is updated; and

               using, by the SF node, the TTL parameter as a value of the TTL field

    included in the second fault tracing detection request packet.

                                             9
        [0030] With reference to the foregoing third aspect, a second possible
        implementation manner of the third aspect is filrther provided, Where the first fault
        tracing detection request packet fiirther includes a node list, and the node list includes
        an ID of a previous-hop SF node of the SF node 011 the service chain; and

                       before the sending, by the SF node, a second fault tracing detection request
        packet to the SFE, the method fithher includes:

                       obtaining, by the SF node, an updated node list, Where the updated node
        list is a list generated after an ID of the SF node is added to the node list, and an order
        of all SF nodes in the updated node list is the same as an order of all the SF nodes 011
10 the service chain; and

                       adding, by the SF node, the updated node list to the second fault tracing
        detection request packet.
        [0031] With reference to the foregoing third aspect, the first possible
        implementation manner of the third aspect, or the second possible implementation
15 manner of the third aspect, a third possible implementation manner of the third aspect
        is filrther provided, Where the first fault tracing detection request packet further
        includes a first parameter, the first parameter is used to identify the SF node or is used
        to identify the previous-hop SF node of the SF node on the service chain, and the
        second fault tracing detection request packet further includes at least one of the first
20 parameter or the ID of the SF node.
        [0032] According to a fourth aspect, a service forwarding apparatus is provided,
        including:

                       a first communications unit, configured to: obtain a first fault tracing
        detection request packet, and then determine to communicate With a first SF node,
25 Where the first fault tracing detection request packet includes a path identifier ID and
        an address of a device for initiating fault detection, and the path ID is used to identify
        a path of a service chain;

                       a first obtaining unit, configured to obtain an ID of the first SF node; and
                       a first sending unit, configured to send a first fault tracing detection
30 response packet to the device for initiating fault detection, where the first fault tracing
        detection response packet includes the path ID, the ID of the first SF node, and the
        address of the device for initiating fault detection.
         [0033] In a first possible implementation manner of the fourth aspect,
                       the first communications unit is specifically configured to determine,

                                                                                        10
    according to the path ID, to forward the first fault tracing detection request packet

    according to a first forwarding entry, Where the first forwarding entry includes the

    path ID and an address of the first SF node;

    the first communications unit is specifically configured to send the first

    fault tracing detection request packet to the first SF node according to the address of

    the first SF node; and

    the first communications unit is specifically configured to receive a second

    fault tracing detection request packet from the first SF node, Where the second fault

    tracing detection request packet includes the path ID and the address of the device for

10 initiating fault detection.

    [0034] With reference to the first possible implementation manner of the

    foregoing fourth aspect, a second possible implementation manner of the fourth aspect

    is filrther provided, Where the first fault tracing detection request packet filrther

    includes a first parameter, the first parameter is used to identify the first SF node or is

15 used to identify a previous-hop SF node of the first SF node on the service chain, and

    the first forwarding entry filrther includes the first parameter; and

    the first communications unit is filrther configured to determine, according

    to the first parameter and the path ID, to forward the first fault tracing detection

    request packet according to the first forwarding entry.

20 [0035] With reference to the second possible implementation manner of the

    foregoing fourth aspect, a third possible implementation manner of the fourth aspect

    is filrther provided, Where the first fault tracing detection request packet further

    includes a TTL field;

    the service forwarding apparatus further includes: a second obtaining unit;

25  the second obtaining unit is configured to obtain a TTL parameter, Where

    the TTL parameter is data obtained after a value of the TTL field in the first fault

    tracing detection request packet is updated; and

    the first sending unit is further configured to: When the TTL parameter is

    equal to a preset value, send the first fault tracing detection response packet to the

30 device for initiating fault detection.

    [0036] With reference to the third possible implementation manner of the

    foregoing fourth aspect, a fourth possible implementation manner of the fourth aspect

    is further provided, Where the service forwarding apparatus further includes: a third

    obtaining unit, a first determining unit, and a second sending unit, Where

                                           11
                the third obtaining unit is configured to: When the TTL parameter is not

    equal the preset value, obtain a third fault tracing detection request packet, Where the

    third fault tracing detection request packet includes a second parameter, the path ID, a

    TTL field, and the address of the device for initiating fault detection, the second

    parameter is used to identify a next-hop SF node of an SF node, 011 the service chain,

    identified by using the first parameter, and a value of the TTL field in the third fault

    tracing detection request packet is the TTL parameter;

                the first determining unit is configured to determine, according to the

    second parameter and the path ID, to forward the third fault tracing detection request

10 packet according to a second forwarding entry, where the second forwarding entry

    includes the path ID, the second parameter, and an address of a first device, the first

    device is a next-hop SFE 0f the service forwarding apparatus 011 the service chain or a

    second SF node, and the second SF node is a next-hop SF node of the first SF node on

    the service chain; and

15              the second sending unit is configured to send the third fault tracing

    detection request packet to the first device according to the address of the first device.

    [0037] With reference to the second possible implementation manner of the

    foregoing fourth aspect, a fifth possible implementation manner of the fourth aspect is

    further provided, where the first sending unit is further configured to send a second

20 fault tracing detection response packet to the device for initiating fault detection,

    Where the second fault tracing detection response packet includes the path ID, an ID

    of the service forwarding apparatus, and the address of the device for initiating fault

    detection.

    [0038] With reference to the second possible implementation manner of the

25 foregoing fourth aspect or the fifth possible implementation manner of the fourth

    aspect, a sixth possible implementation manner of the fourth aspect is filrther

    provided, Where the service forwarding apparatus further includes:

                a fourth obtaining unit, configured to obtain a fourth fault tracing detection

    request packet, Where the fourth fault tracing detection request packet includes a

30 second parameter, the path ID, and the address of the device for initiating fault

    detection, and the second parameter is used to identify a next-hop SF node of an SF

    node, 011 the service chain, identified by using the first parameter;

                a second determining unit, configured to determine, according to the

    second parameter and the path ID, to forward the fourth fault tracing detection request

                            12
        packet according to a second forwarding entry, where the second forwarding entry
         includes the path ID, the second parameter, and an address of a first device, the first
        deVice is a next-hop SFE 0f the service forwarding apparatus 011 the service chain or a
        second SF node, and the second SF node is a next-hop SF node of the first SF node on
        the service chain; and

                       a third sending unit, configured to send the fourth fault tracing detection
        request packet to the first deVice according to the address of the first device.
        [0039] With reference to the sixth possible implementation manner of the
        foregoing fourth aspect, a seventh possible implementation manner of the fourth
10 aspect is further provided, Where the service forwarding apparatus fiirther includes:

                       a receiving unit, configured to receive a fifth fault tracing detection request
        packet from the second SF node, Where the fifth fault tracing detection request packet
        includes the path ID and the address of the device for initiating fault detection; and

                       a fifth obtaining unit, configured to obtain an ID of the second SF node
15 according to the fifth fault tracing detection request packet; and

                       the first sending unit is filrther configured to send a third fault tracing
        detection response packet to the device for initiating fault detection, where the third
        fault tracing detection response packet includes the path ID, the ID of the second SF
        node, and the address of the device for initiating fault detection.
20 [0040] With reference to the first possible implementation manner of the
        foregoing fourth aspect, the second possible implementation manner of the fourth
        aspect, the fifth possible implementation manner of the fourth aspect, the sixth
        possible implementation manner of the fourth aspect, or the seventh possible
        implementation manner of the fourth aspect, an eighth possible implementation
25 manner of the fourth aspect is further provided, Where the first obtaining unit is
        further configured to add at least one of the first parameter or the ID of the service
        forwarding apparatus to the first fault tracing detection response packet.
        [0041] With reference to the first possible implementation manner of the
        foregoing fourth aspect, the second possible implementation manner of the fourth
30 aspect, the fifth possible implementation manner of the fourth aspect, the sixth
        possible implementation manner of the fourth aspect, or the seventh possible
        implementation manner of the fourth aspect, a ninth possible implementation manner
        of the fourth aspect is further provided, Where the first fault tracing detection request
        packet further includes a node list, and the node list includes an ID of the

                                                                                        13
    previous-hop SF node of the first SF node on the service chain;

       the service forwarding apparatus further includes:

       a first parameter updating unit, configured to obtain an updated node list,

    Where the updated node list is a list generated after the ID of the first SF node is added

    to the node list, and an order of all SF nodes included in the updated node list is the

    same as an order of all the SF nodes on the service chain; and

       the first obtaining unit is further configured to add the updated node list to

    the first fault tracing detection response packet.

    [0042] With reference to any one of the first possible implementation manner of

10 the foregoing fourth aspect, the second possible implementation manner of the fourth

    aspect, or the fifth possible implementation manner of the fourth aspect to the ninth

    possible implementation manner of the fourth aspect, a tenth possible implementation

    manner of the fourth aspect is further provided, Where the first fault tracing detection

    request packet further includes an ID of an SF node used as an end point; and

15     the service forwarding apparatus filrther includes:

       a control unit, configured to: after the first sending unit sends the first fault

    tracing detection response packet to the device for initiating fault detection, determine

    that the ID of the first SF node is the same as the ID of the SF node used as the end

    point, and end detection on the service chain.

20 [0043] With reference to any one of the foregoing fourth aspect or possible

    implementation manners of the fourth aspect, an eleventh possible implementation

    manner of the fourth aspect is fiarther provided, Where

       the first communications unit is specifically configured to receive the first

    fault tracing detection request packet sent by the device for initiating fault detection;

25 or

       the first communications unit is specifically configured to receive the first

    fault tracing detection request packet sent by a previous-hop SFE of the service

    forwarding apparatus on the service chain; or

       the first communications unit is specifically configured to generate the first

30 fault tracing detection request packet.

    [0044] With reference to any one of the foregoing fourth aspect or possible

    implementation manners of the fourth aspect, a twelfth possible implementation

    manner of the fourth aspect is further provided, Where the first sending unit is

    specifically configured to obtain a path ID of a reverse service chain of the service

                                            14
    chain by using the path ID, Where the reverse service chain and the service Chain are

    opposite in direction; and

    the first sending unit is specifically configured to send, according to a

    forwarding entry corresponding to the path ID of the reverse service chain, the first

    fault tracing detection response packet to the device for initiating fault detection,

    Where the forwarding entry includes the path ID of the reverse service chain and the

    address of the device for initiating fault detection; or

    the first sending unit is specifically configured to: add the first fault tracing

    detection response packet to a unicast 1P packet, and send the unicast 1P packet to the

10 device for initiating fault detection, Where a destination IP address in the unicast IP

    packet is the address of the device for initiating fault detection.

    [0045] According to a fifth aspect, a device for initiating fault detection is

    provided, including:

    a sending unit, configured to send a first fault tracing detection request

15 packet to an SFE, Where the first fault tracing detection request packet includes a path

    ID and an address of the device for initiating fault detection, and the path ID is used to

    identify a path of a service chain;

    a first receiving unit, configured to receive a first fault tracing detection

    response packet from the SFE, Where the first fault tracing detection response packet

20 includes the path ID, an ID of a first SF node, and the address of the deVice for

    initiating fault detection; and

    a first determining unit, configured to: after the first fault tracing detection

    response packet is received, determine that the service chain passes through the first

    SF node, and forwarding between the SFE and the first SF node is normal.

25 [0046] In a first possible implementation manner of the fifth aspect,

    the sending unit is specifically configured to determine, according to the

    path ID, to forward the first fault tracing detection request packet according to a

    forwarding entry, Where the forwarding entry includes the path ID and an address of

    the SFE; and

30  the sending unit is specifically configured to send the first fault tracing

    detection request packet to the SFE according to the address of the SFE.

    [0047] With reference to the foregoing fifth aspect or the first possible

    implementation manner of the fifth aspect, a second possible implementation manner

    of the fifth aspect is further provided, Where the first fault tracing detection request

                                         15
    packet further includes a first parameter, and the first parameter is used to identify the

    first SF node or is used to identify a previous-hop SF node of the first SF node on the

    service chain.

    [0048] With reference to the foregoing fifth aspect, the first possible

    implementation manner of the fifth aspect, or the second possible implementation

    manner of the fifth aspect, a third possible implementation manner of the fifth aspect

    is filrther provided, Where the device for initiating fault detection further includes:

    a first adding unit, configured to add a TTL field to the first fault tracing

    detection request packet.

10 [0049] With reference to the foregoing fifth aspect, the first possible

    implementation manner of the fifth aspect, or the second possible implementation

    manner of the fifth aspect, a fourth possible implementation manner of the fifth aspect

    is filrther provided, Where the device for initiating fault detection further includes:

    a second adding unit, configured to add a node list to the first fault tracing

15 detection request packet, Where the node list includes an ID of the previous-hop SF

    node of the first SF node on the service chain; and

    the first fault tracing detection response packet fiarther includes an updated

    node list, the updated node list is a list generated after the ID of the first SF node is

    added to the node list, and an order of all SF nodes included in the updated node list is

20 the same as an order of all the SF nodes on the service chain.

    [0050] With reference to any one of the foregoing fifth aspect or possible

    implementation manners of the fifth aspect, a fifth possible implementation manner of

    the fifth aspect is further provided, Where the device for initiating fault detection

    further includes:

25  a second receiving unit, configured to receive a second fault tracing

    detection response packet from the SFE, where the second fault tracing detection

    response packet includes the path ID, an ID of the SFE, and the address of the deVice

    for initiating fault detection; and

    the first determining unit is filrther configured to: after the second fault

30 tracing detection response packet is received, determine that the service chain passes

    through the SFE, and forwarding between the SFE and the device for initiating fault

    detection is normal.

    [0051] With reference to any one of the foregoing fifth aspect or possible

    implementation manners of the fifth aspect, a sixth possible implementation manner

                                         16
    0f the fifth aspect is further provided, Where the device for initiating fault detection

    further includes:

                a third receiving unit, configured to receive a third fault tracing detection

    response packet from the SFE, Where the third fault tracing detection response packet

    includes the path ID, an ID of a second SF node, and the address of the device for

    initiating fault detection, and the second SF node is a next-hop SF node of the first SF

    node 011 the service chain; and

                the first determining unit is further configured to: after the third fault

    tracing detection response packet is received, determine that the service chain passes

10 through the second SF node, and forwarding between the SFE and the second SF node

    is normal.

    [0052] According to a sixth aspect, an SF apparatus is provided, including:

                a receiving unit, configured to receive a first fault tracing detection request

    packet from an SFE, Where the first fault tracing detection request packet includes a

15 path identifier ID and an address of a device for initiating fault detection, and the path

    ID is used to identify a path of a service chain; and

                a sending unit, configured to send a second fault tracing detection request

    packet to the SFE, where the second fault tracing detection request packet includes the

    path ID and the address of the device for initiating fault detection.

20 [0053] In a first possible implementation manner of the sixth aspect, the first fault

    tracing detection request packet further includes a first parameter, the first parameter

    is used to identify the SF apparatus or is used to identify a previous-hop SF node of

    theSF apparatus 011 the service chain, and the second fault tracing detection request

    packet further includes at least one of the first parameter or an ID of the SF apparatus.

25 [0054] With reference to the foregoing sixth aspect or the first possible

    implementation manner of the sixth aspect, a second possible implementation manner

    of the sixth aspect is further provided, Where the first fault tracing detection request

    packet and the second fault tracing detection request packet each filrther includes a

    TTL field;

30              the SF apparatus fiirther includes:

                a first parameter updating unit, configured to obtain a TTL parameter,

    Where the TTL parameter is data obtained after a value of the TTL field included in

    the first fault tracing detection request packet is updated; and

                the first parameter updating unit is configured to use the TTL parameter as

                                     17
        a value of the TTL field included in the second fault tracing detection request packet.
        [0055] With reference to the foregoing sixth aspect or the first possible
        implementation manner of the sixth aspect, a third possible implementation manner of
        the sixth aspect is further provided, Where the first fault tracing detection request
        packet further includes a node list, and the node list includes an ID of the
        previous-hop SF node of the SF apparatus 011 the service chain;

                       the SF apparatus fiarther includes:
                       a second parameter updating unit, configured to obtain an updated node
        list, Where the updated node list is a list generated after the ID of the SF apparatus is
10 added to the node list, and an order of all SF nodes in the updated node list is the same
         as an order of all the SF nodes 011 the service chain; and
                       the second parameter updating unit is configured to add the updated node
        list to the second fault tracing detection request packet.
        [0056] According to the foregoing solutions, an SFE provided in the embodiments
15 of the present invention obtains a first fault tracing detection request packet, then
         determines to communicate With a first SF node, and obtains an ID of the first SF
        node; and the SFE sends a first fault tracing detection response packet that includes
        the ID of the first SF node to a device for initiating fault detection, Which helps the
        device for initiating fault detection to learn an SF node that a service packet passes
20 through when being forwarded 011 a service chain.

                                    BRIEF DESCRIPTION OF DRAWINGS

        [0057] To describe the technical solutions in the embodiments of the present
        invention more clearly, the following briefly describes the accompanying drawings
        required for describing the embodiments. Apparently, the accompanying drawings in
25 the following description show merely some embodiments of the present invention,
        and an ordinary person skilled in the art may still derive other drawings from these
        accompanying drawings.
        [0058] FIG. 1 is a schematic structural diagram of a network that provides a
         value-added service;
30 [0059] FIG. 2 is a schematic structural diagram of a network according to
        Embodiment l of the present invention;
        [0060] FIG. 3 is a schematic diagram of a service forwarding apparatus according

                                                                                        18
        to Embodiment 1 of the present invention;
        [0061] FIG. 4 is a schematic diagram of a service forwarding apparatus according
        to Embodiment 1 of the present invention;
        [0062] FIG. 5 is a schematic diagram of a deVice for initiating fault detection
        according to Embodiment 1 of the present invention;
        [0063] FIG. 6 is a schematic diagram of a deVice for initiating fault detection
        according to Embodiment 1 of the present invention;
        [0064] FIG. 7 is a schematic diagram of a service flinction apparatus according to
        Embodiment 1 of the present invention;
10 [0065] FIG. 8 is a schematic diagram of a service fianction apparatus according to
        Embodiment 1 of the present invention;
        [0066] FIG. 9 is a flowchart of a service chain fault detection method according to
        Embodiment 1 of the present invention;
        [0067] FIG. 10 is a schematic structural diagram of a network according to
15 Embodiment 2 of the present invention;
        [0068] FIG. 11 is a schematic diagram of a service forwarding apparatus
        according to Embodiment 2 of the present invention;
        [0069] FIG. 12 is a schematic diagram of a deVice for initiating fault detection
        according to Embodiment 2 of the present invention;
20 [0070] FIG. 13 is a schematic diagram of a service function apparatus according to
        Embodiment 2 of the present invention;
         [0071] FIG. 14 is a flowchart of a service chain fault detection method according
        to Embodiment 2 of the present invention;
        [0072] FIG. 15 is a schematic structural diagram of a network according to
25 Embodiment 3 of the present invention;
        [0073] FIG. 16 is a flowchart of a service chain fault detection method according
        to Embodiment 3 of the present invention; and
        [0074] FIG. 17 is a schematic diagram of an 0AM packet according to an
        embodiment of the present invention.

30  DESCRIPTION OF EMBODIMENTS

    [0075] To make the objectives, technical solutions, and advantages of the
    embodiments of the present invention clearer, the following clearly describes the

    19
        technical solutions in the embodiments of the present invention With reference to the
        accompanying drawings in the embodiments of the present invention. Apparently, the
        described embodiments are a part rather than all of the embodiments of the present
        invention. All other embodiments obtained by persons of ordinary skill in the art
        based on the embodiments of the present invention shall fall Within the protection
        scope of the present invention.
        [0076] FIG. 1 is a schematic structural diagram of a network that provides a
        value-added service. The network shown in FIG. 1 includes a detection device 141, a
         service classifier 131, an SFE 111, an SF node 121, and an SF node 122. A service
10 chain in the network shown in FIG. 1 includes the service classifier 131, the SFE 111,
        the SF node 121, and the SF node 122. A service processing order planned on the
        service chain is as follows: A packet forwarded 0n the service chain first passes
        through the SF node 121, and then passes through the SF node 122. On the service
        Chain, the service classifier 131 is connected to the SFE 111, and the SFE 111 is
15 connected to the SF node 121 and the SF node 122. The detection device 141 may
         communicate With the service classifier 131, the SFE 111, the SF node 121, and the
        SF node 122. The detection device 141 sends a detection packet 1001 to each of the
         service classifier 131, the SFE 111, the SF node 121, and the SF node 122, to detect
         that the service classifier 131, the SFE 111, the SF node 121, and the SF node 122 all
20 can normally work. In the network shown in FIG. 1, the service classifier 131 sends a
        service packet 1011 to the SFE 111. If a forwarding entry in the SFE 111 is abnormal,
        the SFE 111 first sends the received service packet 1011 to the SF node 122 according
        to the abnormal forwarding entry, and the SF node 122 performs service processing
        on the service packet 1011. Then, the SFE 111 sends, according to the abnormal
25 forwarding entry, a service packet 1012 received from the SF node 122 to the SF node
        121, and the SF node 121 performs service processing on the service packet 1012.
         [0077] In a scenario shown in FIG. 1, although the service classifier 131, the SFE
        111, the SF node 121, and the SF node 122 all can forward a service packet,
        abnormality of the forwarding entry in the SFE 111 causes a difference between an
30 order of SF nodes that the service packet passes through on the service chain and the
        planned processing order. The detection device 141 cannot learn a problem that the
        order of the SF nodes that the service packet passes through on the service chain is
        wrong because of the abnormality of the forwarding entry in the SFE 111.
        [0078] For the foregoing problem, a solution that is helpful to learn an SF node

                                                                                        20
       that a service chain passes through is put forward. The solution is as follows: An SFE
       obtains a first fault tracing detection request packet, then determines to communicate
        With a first SF node, and obtains an ID of the first SF node; and the SFE sends a first
       fault tracing detection response packet that includes a path ID and the ID of the first
        SF node to a device for initiating fault detection, so that the device for initiating fault
       detection learns information about an SF node that a service chain passes through.
       The solution may be implemented by using the following several embodiments.
        [0079] The following describes reference numerals mentioned in the
       embodiments of the present invention: 131 may be used to identify a device for
10 initiating fault detection; 111 and 112 may be used to identify an SFE; 121, 122, and
         123 may be used to identify an SF node; 1021, 1022, 1023, 1024, 1025, 1026, 1042,
        1043, and 1044 may be used to identify a fault tracing detection request packet; 1031,
        1032, 1034, 1035, and 1036 may be used to identify a fault tracing detection response
       packet; and 1051 may be used to identify a connectivity detection packet.

15  Embodiment 1

        [0080] FIG. 2 is a schematic structural diagram of a network according to
        Embodiment 1 0f the present invention. The network shown in FIG. 2 may be used to
        provide a value-added service. In the network shown in FIG. 2, a service classifier 131
         is connected to an SFE 111, and the SFE 111 is connected to each of an SF node 121
20 and an SF node 122. A service chain shown in FIG. 2 includes the service classifier
        131, the SFE 111, the SF node 121, and the SF node 122. The service chain is a set of
        SF nodes, included in the service chain, that a packet passes through according to an
        order of the SF nodes. In the following embodiment of the present invention, a packet
        belonging to a particular type of service is referred to as a service packet. In a
25 direction from the service classifier 131 to the SF node 122, the SFE 111 is a first SFE
        0n the service chain, and the SF node 121 is a previous-hop SF node of the SF node
        122 on the service chain.
        [0081] FIG. 3 is a schematic diagram of a service forwarding apparatus according
        to Embodiment 1 0f the present invention. The service forwarding apparatus shown in
30 FIG. 3 may be any SFE in the structure of the network shown in FIG. 2. The service
        forwarding apparatus shown in FIG. 3 may be a switch, a router, or a server in a
        network. With reference to FIG. 2, an example in Which the service forwarding

    21
        apparatus shown in FIG. 3 is an SFE 111 is used in the following for description. The
        service forwarding apparatus shown in FIG. 3 includes: a processor 1101, a memory
        1102, and a communications interface 1103. The processor 1101, the memory 1102,
        and the communications interface 1103 are connected by using a communications bus
        1104. If the service forwarding apparatus shown in FIG. 3 is a switch in a network, the
        processor 1101 may be a network processor (English fiall name: network processor,
        English abbreviation: NP). If the service forwarding apparatus shown in FIG. 3 is a
        router or a server, the processor 1101 may be a central processing unit (English full
        name: central processing unit, English abbreviation: CPU).
10 [0082] The memory 1102 is configured to store a program. Optionally, the
        memory 1102 may further store an ID of a service fimction apparatus and a
        forwarding entry.
        [0083] The processor 1101 performs the following operations according to an
        executable instruction included in the program that is read from the memory 1102:
15 [0084] The processor 1101 obtains a fault tracing detection request packet 1042
        by using the communications interface 1103, and then determines to communicate
        With an SF node 121. The fault tracing detection request packet 1042 includes a path
        ID and an address of a deVice for initiating fault detection, and the path ID is used to
        identify a path of a service chain.
20 [0085] The processor 1101 obtains an ID of the SF node 121 from the memory
        1 102.
        [0086] The processor 1101 sends a fault tracing detection response packet 1032 to
        a service classifier 131 by using the communications interface 1103. The fault tracing
        detection response packet 1032 includes the path ID, the ID of the SF node 121, and
25 an address of the service classifier 131.
        [0087] Optionally, the fault tracing detection request packet 1042 filrther includes
        a TTL field. After determining to communicate with the SF node 121, the processor
        1101 obtains a TTL parameter, and When the TTL parameter is equal a preset value,
        sends the fault tracing detection response packet 1032 to the service classifier 131 by
30 using the communications interface 1103. The TTL parameter is data obtained after a
        value of the TTL field in the fault tracing detection request packet 1042 is updated.
        The updating may be an operation of adding an offset to or subtracting an offset from
        a reference value. The value of the TTL field in the fault tracing detection request
        packet 1042 is used as the reference value. The reference value is greater than or

                                                                                        22
        equal to 0, the offset is greater than 0, and the preset value is greater than or equal to
        0.
        [0088] Further, the processor 1101 enables, according to the executable
        instruction and the forwarding entry in the memory 1102 by cooperating With the
        communications interface 1103, the service forwarding apparatus shown in FIG. 3 to
        perform all operations performed by an SFE 111 or an SFE 112 in the embodiment
        shown in FIG. 9. Alternatively, it may be considered that the service forwarding
        apparatus shown in FIG. 3 is the SFE 111 or the SFE 112 in the embodiment shown in
        FIG. 9.
10 [0089] FIG. 4 is a schematic diagram of a service forwarding apparatus according
        to Embodiment 1 0f the present invention. The service forwarding apparatus shown in
         FIG. 4 includes: a first communications unit 1105, a first sending unit 1106, and a first
        obtaining unit 1107. Optionally, the service forwarding apparatus shown in FIG. 4
        further includes a second obtaining unit 1108. Optionally, the service forwarding
15 apparatus shown in FIG. 4 further includes: a third obtaining unit 1109, a first
        determining unit 1110, and a second sending unit 1111. Optionally, the service
        forwarding apparatus shown in FIG. 4 may further include a storage unit (not shown
        in FIG. 4). The storage unit may be configured to store a forwarding entry and an ID
        of an SF node connected to the service forwarding apparatus.
20 [0090] The service forwarding apparatus shown in FIG. 4 and the service
        forwarding apparatus shown in FIG. 3 may be a same apparatus. For example, both
        are the SFE 111 or the SFE 112 in the network shown in FIG. 2. It may be considered
        that from a physical perspective, FIG. 3 displays content included in a service
        forwarding apparatus, and from a logical perspective, FIG. 4 displays content included
25 in a service forwarding apparatus. Optionally, a sending function included in the first
        communications unit 1105 in FIG. 4 may be implemented by the communications
        interface 1103 in FIG. 3. A forwarding entry determining function included in the first
        communications unit 1105 in FIG. 4 may be implemented by the processor 1101 in
        FIG. 3 according to an executable instruction stored in the memory 1102. In other
30 words, the first communications unit 1105 in FIG. 4 may be implemented by a unit
        that implements the sending function and a unit that implements the forwarding entry
        determining function. The first sending unit 1106 and the second sending unit 1111 in
        FIG. 4 may be implemented by the communications interface 1103 in FIG. 3, and the
        communications interface 1103 may include at least one physical interface. The first

                                                                                        23
         obtaining unit 1107, the second obtaining unit 1108, the third obtaining unit 1109, and
        the first determining unit 1110 in FIG. 4 may be implemented by the processor 1101 in
        FIG. 3 according to the executable instruction stored in the memory 1102, and the
        processor 1101 may include at least one physical processor. The storage unit included
        in the service forwarding apparatus shown in FIG. 4 may be implemented by the
        memory 1102 in FIG. 3.
        [0091] FIG. 5 is a schematic diagram of a device for initiating fault detection
        according to Embodiment 1 0f the present invention. The device for initiating fault
        detection shown in FIG. 5 may be the service classifier 131, the SFE 111, or the SFE
10 112 in the structure of the network shown in FIG. 2. With reference to FIG. 2, an
        example in Which the device for initiating fault detection in FIG. 5 is the service
        Classifier 131 is used in the following for description. The device for initiating fault
        detection shown in FIG. 5 includes: a processor 1301, a memory 1302, and a
         communications interface 1303. The processor 1301, the memory 1302, and the
15 communications interface 1303 are connected by using a communications bus 1304.
        If the device for initiating fault detection shown in FIG. 5 is a switch in a network, the
        processor 1301 may be an NP. If the device for initiating fault detection shown in FIG.
        5 is a router or a server, the processor 1301 may be a CPU.
        [0092] The memory 1302 is configured to store a program and a forwarding entry.
20 [0093] The processor 1301 performs the following operations according to an
        executable instruction included in the program that is read from the memory 1302:
        [0094] The processor 1301 sends a fault tracing detection request packet 1042 to
        an SFE 111 by using the communications interface 1303 according to the forwarding
        entry that is read from the memory 1302. The fault tracing detection request packet
25 1042 includes a path ID of a service chain and an address of the device for initiating
        fault detection. The forwarding entry includes the path ID and an address of the SFE
        111. Optionally, the fault tracing detection request packet 1042 filrther includes a TTL
        field, and a value of the TTL field further included in the fault tracing detection
        request packet 1042 is in direct proportion to ranking of an SF node 121 011 the
30 service chain.
        [0095] The processor 1301 receives a fault tracing detection response packet 1032
        from the SFE 111 by using the communications interface 1303. The fault tracing
        detection response packet 1032 includes the path ID of the service chain, an ID of the
        SF node 121, and the address of the device for initiating fault detection. The processor

                                                                                        24
        1301 may learn, according to the ID of the SF node 121 included in the fault tracing
        detection response packet 1032, that the service chain passes through the SF node 121
        connected to the SFE 111.
        [0096] Further, the processor 1301 enables, according to the executable
        instruction and the forwarding entry in the memory 1302 by cooperating With the
        communications interface 1303, the device for initiating fault detection shown in FIG.
        5 to perform all operations performed by a service classifier 131 in the embodiment
        shown in FIG. 9. Alternatively, it may be considered that the device for initiating fault
        detection shown in FIG. 5 is the service classifier 131 in the embodiment shown in
10 FIG. 9.
        [0097] FIG. 6 is a schematic diagram of a device for initiating fault detection
        according to Embodiment 1 0f the present invention. The device for initiating fault
         detection shown in FIG. 6 includes: a sending unit 1306, a first receiving unit 1305,
        and a first determining unit 1313. Optionally, the device for initiating fault detection
15 shown in FIG. 6 further includes: a first adding unit 1307 and a third receiving unit
        1312. Optionally, the device for initiating fault detection shown in FIG. 6 may further
        include a storage unit (not shown in FIG. 6). The storage unit is configured to store a
        forwarding entry.
         [0098] The device for initiating fault detection shown in FIG. 6 and the device for
20 initiating fault detection shown in FIG. 5 may be a same apparatus. For example, both
        are the service classifier 131 in the network shown in FIG. 2. It may be considered
        that from a physical perspective, FIG. 5 displays content included in a device for
        initiating fault detection, and from a logical perspective, FIG. 6 displays content
        included in a device for initiating fault detection. Optionally, a sending fimction
25 included in the sending unit 1306 in FIG. 6 may be implemented by the
        communications interface 1303 in FIG. 5. A forwarding entry determining fimction
        included in the sending unit 1306 in FIG. 6 may be implemented by the processor
        1301 in FIG. 5 according to an executable instruction stored in the memory 1302. The
        first receiving unit 1305 and the third receiving unit 1312 in FIG. 6 may be
30 implemented by the communications interface 1303 in FIG. 5, and the
        communications interface 1303 may include at least one physical interface. The first
        adding unit 1307 and the first determining unit 1313 in FIG. 6 may be implemented by
        the processor 1301 in FIG. 5 according to the executable instruction and a forwarding
        entry that are stored in the memory 1302, and the processor 1301 may include at least

                                                                                        25
        one physical processor. The storage unit included in the device for initiating fault
        detection shown in FIG. 6 may be implemented by the memory 1302 in FIG. 5.
        [0099] FIG. 7 is a schematic diagram of a service fianction apparatus according to
        Embodiment 1 0f the present invention. The service function apparatus shown in FIG.
        7 may be any SF node in the structure of the network shown in FIG. 2. With reference
        to FIG. 2, an example in Which the service function apparatus shown in FIG. 7 is an
        SF node 121 is used in the following for description. The service function apparatus
        shown in FIG. 7 includes: a processor 1201, a memory 1202, and a communications
        interface 1203. The processor 1201, the memory 1202, and the communications
10 interface 1203 are connected by using a communications bus 1204. If the service
        function apparatus shown in FIG. 7 is a switch in a network, the processor 1201 may
        be an NP. If the service function apparatus shown in FIG. 7 is a router or a server, the
        processor 1201 may be a CPU.
        [0100] The memory 1202 is configured to store a program. Optionally, the
15 memory 1202 may be further configured to store a forwarding entry and an ID of the
        service function apparatus. The ID of the service function apparatus includes an ID of
        the SF node 121.
        [0101] The processor 1201 performs the following operations according to an
        executable instruction included in the program that is read from the memory 1202:
20 [0102] The processor 1201 receives a fault tracing detection request packet 1042
        from an SFE 111 by using the communications interface 1203. The fault tracing
        detection request packet 1042 includes a path ID and an address of a device for
        initiating fault detection, and the path ID is used to identify a path of a service chain.
        Optionally, the fault tracing detection request packet 1042 filrther includes a TTL
25 field.
        [0103] The processor 1201 sends a fault tracing detection request packet 1042 to
        the SFE 111 by using the communications interface 1203.
        [0104] Optionally, the processor 1201 may further read the ID of the SF node 121
        from the memory 1202, for example, the ID of the SF node 121. The processor 1201
30 may add the ID of the SF node 121 to the fault tracing detection request packet 1042.
        [0105] Further, the processor 1201 enables, according to the executable
        instruction in the memory 1202 by cooperating With the communications interface
        1203, the service function apparatus in FIG. 7 to perform all operations performed by
        any SF node in the embodiment shown in FIG. 9. Alternatively, it may be considered

                                                                                        26
        that the service function apparatus shown in FIG. 7 is an SF node 121 or an SF node
        122 in the embodiment shown in FIG. 9.
        [0106] FIG. 8 is a schematic diagram of a service fianction apparatus according to
        Embodiment 1 of the present invention. The service function apparatus shown in FIG.
        8 includes: a receiving unit 1205 and a sending unit 1206. Optionally, the service
        function apparatus shown in FIG. 8 filrther includes a first parameter updating unit
        1207. Optionally, the service function apparatus shown in FIG. 8 may filrther include
        a storage unit (not shown in FIG. 8). The storage unit is configured to store an ID of
        the service fianction apparatus. Optionally, the storage unit is filrther configured to
10 store a forwarding entry.
        [0107] The service function apparatus shown in FIG. 8 and the service forwarding
        apparatus shown in FIG. 7 may be a same apparatus. For example, both are the SF
        node 121 or the SF node 122 in the network shown in FIG. 2. It may be considered
        that from a physical perspective, FIG. 7 displays content included in a service function
15 apparatus, and from a logical perspective, FIG. 8 displays content included in a
        service function apparatus. Optionally, the receiving unit 1205 and the sending unit
        1206 in FIG. 8 may be implemented by the communications interface 1203 in FIG. 7,
        and the communications interface 1203 may include at least one physical interface.
        The first parameter updating unit 1207 in FIG. 8 may be implemented by the
20 processor 1201 in FIG. 7 according to an executable instruction stored in the memory
        1202, and the processor 1201 may include at least one physical processor. The storage
        unit included in the service fianction apparatus shown in FIG. 8 may be implemented
        by the memory 1202 in FIG. 7.
        [0108] FIG. 9 is a flowchart of a service chain fault detection method according to
25 Embodiment 1 of the present invention. If a device for initiating fault detection is a
         service classifier 131, and the service classifier 131 detects all SFEs included in a
        service chain and SF nodes connected to all the SFEs, the service classifier 131 may
        determine, according to a quantity of SF nodes on the service chain, a quantity of fault
        tracing detection request packets to be sent. Each fault tracing detection request
30 packet sent by the service classifier 131 may be used to obtain an identifier of one SF
        node on the service chain. The service classifier 131 may determine, according to an
        order of sending a fault tracing detection request packet and the obtained ID of the SF
        node, a location of the SF node that is corresponding to the obtained ID of the SF
         node and is on the service chain. The network shown in FIG. 2 includes an SF node

                                                                                        27
        121 and an SF node 122. With reference to the structure of the network shown in FIG.
        2, the following describes in detail the service chain fault detection method provided
        in Embodiment 1.
        [0109] 501. A service classifier 131 sends a fault tracing detection request packet
        1042 to an SFE111.
        [0110] For example, a sending unit 1306 in the service classifier 131 sends the
        fault tracing detection request packet 1042 to the SFE 111. Specifically, a forwarding
        entry stored in a storage unit in the service classifier 131 includes a path ID and an
        address of the SFE 111. The sending unit 1306 determines, according to the obtained
10 path ID of the service chain, to forward the fault tracing detection request packet 1042
        according to the forwarding entry in the storage unit. The sending unit 1306 sends the
        fault tracing detection request packet 1042 to the SFE 111 according to the address of
        the SFE 111.
        [0111] For example, the path ID obtained by the sending unit 1306 may be from a
15 detection instruction received by the service classifier 131. The fault tracing detection
        request packet 1042 sent by the sending unit 1306 may be a fault tracing detection
        request packet 1042 generated by the service classifier 131 according to the detection
        instruction. Optionally, the service classifier 131 further includes a unit configured to
        generate the fault tracing detection request packet 1042 according to the detection
20 instruction. Alternatively, the fault tracing detection request packet 1042 sent by the
        sending unit 1306 may be a fault tracing detection request packet 1042 that is
        generated by another deVice and is received by the service classifier 131.
        [0112] For example, a first adding unit 1307 may add a TTL field to the fault
        tracing detection request packet 1042, that is, the fault tracing detection request packet
25 1042 includes the TTL field, a first parameter, an address of the service Classifier 131,
        and the path ID of the service chain. A value of the TTL field included in the fault
        tracing detection request packet 1042 may be used to identify a location of an SF node
         121 011 the service chain. That is, the value of the TTL field included in the fault
        tracing detection request packet 1042 is in direct proportion to ranking of the SF node
30 121 011 the service chain. The first parameter is used to identify the SF node 121, a
        previous-hop SF node of the SF node 121 011 the service chain, or a next-hop SF node
        of the SF node 121 011 the service chain. If the SF node 121 is a first SF node 011 the
        service chain, the first parameter is a first preset ID, and the first preset ID indicates
        that the previous-hop SF node of the SF node 121 011 the service chain does not exist.

                                                                                        28
        If the SF node 121 is a last SF node 011 the service chain, the first parameter is a
        second preset ID, and the second preset ID indicates that the next-hop SF node of the
        SF node 121 011 the service chain does not exist. The first parameter may be an ID of
        an SF node identified by using the first parameter. An ID, mentioned in this
        embodiment of the present invention, of an SF node may be information such as a
        character, a string, a name, or an index (English name: index), or may be an ID of a
        device to Which the SF node belongs. An ID, mentioned in this embodiment of the
        present invention, of an SFE or a parameter, mentioned in this embodiment of the
        present invention, for identifying an SFE may be information such as a character, a
10 digit, a string, a name, or an index, or may be an ID of a device to Which the SFE
        belongs.
        [0113] In the network shown in FIG. 2, the service classifier 131 is a device for
        initiating fault detection. Alternatively, a device for initiating fault detection may be
        the SFE 111 or another SFE connected to the SFE 111. As the device for initiating
15 fault detection, the SFE 111 may implement all functions of the service classifier 131
        in a service chain fault detection process. As the device for initiating fault detection,
        the another SFE may implement all the functions of the service classifier 131 in the
        service chain fault detection process.
        [0114] 502. The SFE 111 sends the fault tracing detection request packet 1042 to
20 an SF n0de121.
         [0115] For example, a first communications unit 1105 in the SFE 111 obtains the
        fault tracing detection request packet 1042. A first forwarding entry stored in a storage
        unit in the SFE 111 includes the first parameter, the path ID, and an address of the SF
        node 121. The first communications unit 1105 may determine, according to the path
25 ID and the first parameter that are included in the fault tracing detection request
        packet 1042, to forward the fault tracing detection request packet 1042 according to
        the first forwarding entry. The first communications unit 1105 sends the fault tracing
        detection request packet 1042 to the SF node 121 according to the address of the SF
        node 121.
30 [0116] For example, the first forwarding entry stored in the storage unit in the
        SFE 111 may include the path ID and the address of the SF node 121. The first
        communications unit 1105 may determine, according to the path ID included in the
        fault tracing detection request packet 1042, to forward the fault tracing detection
        request packet 1042 according to the first forwarding entry. Alternatively, the first

                                                                                        29
        forwarding entry stored in the storage unit in the SFE 111 may include the path ID, an
        identifier of an interface for connecting to the service classifier 131, and the address
        of the SF node 121. When an interface for receiving the fault tracing detection request
        packet 1042 is the interface for connecting to the service classifier 131, the first
        communications unit 1105 may determine, according to the path ID and the identifier
        of the interface for connecting to the service classifier 131, to forward the fault tracing
        detection request packet 1042 according to the first forwarding entry.
        [0117] For example, the address of the SF node 121 may be an IP address of the
        SF node 121 or a MAC address of the SF node 121. If the SF node 121 and the SFE
10 111 are located 011 a same network device, the address of the SF node 121 may be an
        I/O address for connecting to the SF node 121 by the SFE 111. Alternatively, the
        address of the SF node 121 may be an identifier of an interface for connecting to the
        SF node 121 by the SFE111.
        [0118] 503. The SF node 121 sends a fault tracing detection request packet 1042
15 to the SFE111.
        [0119] For example, a receiving unit 1205 in the SF node 121 receives the fault
        tracing detection request packet 1042 from the SFE 111. A sending unit 1206 in the
        SF node 121 sends the fault tracing detection request packet 1042 to the SFE 111.
        [0120] For example, the sending unit 1206 may send the fault tracing detection
20 request packet 1042 to the SFE 111 according to an interface through Which the
        receiving unit 1205 receives the fault tracing detection request packet 1042.
        Alternatively, the sending unit 1206 may determine the address of the SFE 111
        according to a forwarding entry stored in a storage unit in the SF node 121. The
        forwarding entry stored in the storage unit in the SF node 121 includes the path ID
25 and the address of the SFE 111. The sending unit 1206 sends the fault tracing
        detection request packet 1042 to the SFE 111 according to the address of the SFE 111.
        The address of the SFE 111 may be an IP address of the SFE 111 or a MAC address of
        the SFE 111. If the SF node 121 and the SFE 111 are located 011 a same network
        device, the address of the SFE 111 may be an I/O address for connecting to the SFE
30 111 by the SF node 121. Alternatively, the address of the SFE 111 may be an identifier
        of an interface for connecting to the SFE 111 by the SF node 121.
        [0121] For example, the SF node 121 has two working manners. One working
        manner is that the SF node 121 directly forwards the received fault tracing detection
        request packet 1042 to the SFE 111. The other working manner is that the SF node

                                                                                        30
        121 adds an ID of the SF node 121 to the fault tracing detection request packet 1042
        sent to the SFE 111. In the other working manner of the SF node 121, a first
        parameter updating unit 1207 included in the SF node 121 may add the ID of the SF
        node 121 to the fault tracing detection request packet 1042. In this embodiment, the
        sending unit 1206 sends, to the SFE 111, the fault tracing detection request packet
         1042 to Which the ID of the SF node 121 is added, so that the SFE 111 can obtain the
        ID of the SF node 121 from the fault tracing detection request packet 1042.
         [0122] 504. The SFE 111 obtains an ID of the SF node 121 and a first TTL
         parameter.
10 [0123] For example, a first obtaining unit 1107 in the SFE 111 obtains the ID of
        the SF node 121. The first obtaining unit 1107 may obtain the ID of the SF node 121
        according to an interface for receiving the fault tracing detection request packet 1042
        and a correspondence between the stored ID of the SF node 121 and the interface for
        receiving the fault tracing detection request packet 1042. Alternatively, the first
15 obtaining unit 1107 may obtain the ID of the SF node 121 from the fault tracing
        detection request packet 1042. Alternatively, When the first parameter in the fault
        tracing detection request packet 1042 is used to identify the SF node 121, the first
        obtaining unit 1107 may use the obtained first parameter as the ID of the SF node 121.
         [0124] For example, a second obtaining unit 1108 in the SFE 111 obtains the first
20 TTL parameter. The first TTL parameter is data obtained after the value of the TTL
        field included in the fault tracing detection request packet 1042 from the service
        Classifier 131 is updated. Specifically, after the first communications unit 1105
         determines that the SFE 111 can communicate With the SF node 121, the second
        obtaining unit 1108 adds an offset to or subtracts an offset from a reference value to
25 obtain the first TTL parameter, Where the value of the TTL field included in the fault
        tracing detection request packet 1042 from the service classifier 131 is used as the
        reference value. Alternatively, the SF node 121 may update the value of the TTL field
        included in the fault tracing detection request packet 1042 from the SFE 111, to obtain
        the first TTL parameter. A value of a TTL field included in the fault tracing detection
30 request packet 1042 sent by the SF node 121 to the SFE 111 is the first TTL parameter,
        and the second obtaining unit 1108 may obtain the first TTL parameter from the TTL
        field included in the fault tracing detection request packet 1042 from the SF node 121.
        For example, the value of the TTL field in the fault tracing detection request packet
         1042 from the service classifier 131 is 2, the offset is 1, and the first TTL parameter

                                                                                        31
        obtained by the second obtaining unit 1108 may be 1.
        [0125] 505. When a value of the first TTL parameter is equal to a preset value, the
        SFE 111 sends a fault tracing detection response packet 1032 to the service classifier
        13 1 .
        [0126] For example, When the value of the first TTL parameter obtained by the
        second obtaining unit 1108 is equal to the preset value, a first sending unit 1106 in the
        SFE 111 sends the fault tracing detection response packet 1032 to the service
        classifier 131. Specifically, the first sending unit 1106 may send the fault tracing
        detection response packet 1032 to the service classifier 131 according to the address
10 of the service classifier 131 in the fault tracing detection request packet 1042. The
        preset value is greater than or equal to 0. For example, if the preset value is 1, the first
        TTL parameter obtained by the second obtaining unit 1108 is equal to the preset value,
        and the first sending unit 1106 may send the fault tracing detection response packet
        1032 to the service classifier 131.
15 [0127] For example, the fault tracing detection response packet 1032 in step 505
        may be generated by the SFE 111 according to the path ID, the ID of the SF node 121,
        and the address of the service classifier 131. Alternatively, the fault tracing detection
        response packet 1032 in step 505 may be a fault tracing detection response packet that
        is generated by another deVice and is received by the SFE 111. Alternatively, a fault
20 tracing detection response packet that is generated by another device and is received
        by the SFE 111 includes the path ID and the address of the service classifier 131, and
        the SFE 111 may add the ID of the SF node 121 to the fault tracing detection response
        packet, to obtain the fault tracing detection response packet 1032 in step 505. The
        another device is different from an SFE 0n the service chain.
25 [0128] For example, a first receiving unit 1305 in the service classifier 131
        receives the fault tracing detection response packet 1032. A first determining unit
        1313 in the service classifier 131 may determine, according to the ID of the SF node
        121 in the fault tracing detection response packet 1032, that the service chain passes
        through the SF node 121 connected to the SFE 111, and forwarding between the SF
30 node 121 and the SFE 111 is normal. That forwarding is normal mentioned in this
        embodiment of the present invention means that packet receiving and sending can be
        implemented between devices. The deVice is a device 011 Which an SF node is located
        or a device 011 Which an SFE is located.
        [0129] Step 501 to step 505 are a procedure in Which the service classifier 131

                                                                                        32
        detects the SFE 111 and the SF node 121 connected to the SFE 111. If the service
        classifier 131 further needs to detect the SFE 111 and an SF node 122 connected to
        the SFE 111, a subsequent procedure including step 506 to step 513 may be executed.
        That is, step 506 to step 513 are optional content.
        [0130] 506. The service classifier 131 sends a fault tracing detection request
        packet 1043 to the SFE 111.
        [0131] For example, a difference between the fault tracing detection request
        packet 1043 and the fault tracing detection request packet 1042 lies in that a value of a
        TTL field included in the fault tracing detection request packet 1043 identifies a
10 location of the SF node 122 011 the service chain. That is, the value of the TTL field
        included in the fault tracing detection request packet 1043 is in direct proportion to
        ranking of the SF node 122 011 the service chain. For example, the value of the TTL
        field included in the fault tracing detection request packet 1043 is 3. Optionally, the
        first adding unit 1307 in the service classifier 131 may add the value of the TTL field
15 to the fault tracing detection request packet 1043.
        [0132] For example, after the first receiving unit 1305 in the service classifier 131
        receives the fault tracing detection response packet 1032, the sending unit 1306 in the
        service Classifier 131 may send the fault tracing detection request packet 1043 to the
        SFE 111. The fault tracing detection request packet 1043 may be generated by the
20 service Classifier 131 according to the fault tracing detection request packet 1042.
        Alternatively, the fault tracing detection request packet 1043 may be obtained by the
        service classifier 131 from another device.
        [0133] A method for sending the fault tracing detection request packet 1043 by
        the service classifier 131 to the SFE 111 in step 506 is the same as a method for
25 sending the fault tracing detection request packet 1042 by the service Classifier 131 to
        the SFE 111 in step 501, and details are not described herein again.
        [0134] 507. The SFE 111 sends the fault tracing detection request packet 1043 to
        the SF node 121.
        [0135] A method for sending the fault tracing detection request packet 1043 by
30 the SFE 111 to the SF node 121 in step 507 is the same as a method for sending the
        fault tracing detection request packet 1042 by the SFE 111 to the SF node 121 in step
        502, and details are not described herein again.
        [0136] 508. The SF node 121 sends a fault tracing detection request packet 1043
        to the SFE111.

                                                                                        33
        [0137] A method for sending the fault tracing detection request packet 1043 by
        the SF node 121 to the SFE 111 in step 508 is the same as a method for sending the
        fault tracing detection request packet 1042 by the SF node 121 to the SFE 111 in step
        503, and details are not described herein again.
         [0138] 509. The SFE 111 obtains the ID of the SF node 121 and a second TTL
         parameter.
        [0139] A method for obtaining the ID of the SF node 121 by the SFE 111 in step
        509 is the same as a method for obtaining the ID of the SF node 121 by the SFE 111
        in step 504, a method for obtaining the second TTL parameter by the SFE 111 in step
10 509 is the same as a method for obtaining the first TTL parameter by the SFE 111 in
        step 504, and details are not described herein again.
        [0140] For example, the value of the TTL field included in the fault tracing
        detection request packet 1043 from the service classifier 131 is 3. If a preset value is 1,
        the second TTL parameter obtained by the second obtaining unit 1108 in the SFE 111
15 is 2.
        [0141] 510. When a value of the second TTL parameter is not equal to the preset
        value, the SFE 111 sends a fault tracing detection request packet 1044 to an SF node
        122.
        [0142] For example, when the second TTL parameter obtained by the second
20 obtaining unit 1108 is not equal to the preset value, a third obtaining unit 1109 in the
        SFE 111 obtains the fault tracing detection request packet 1044. The preset value is
        greater than or equal to 0. For example, the second TTL parameter obtained by the
        second obtaining unit 1108 is 2, and is greater than the preset value. The third
        obtaining unit 1109 in the SFE 111 obtains the fault tracing detection request packet
25 1044.
        [0143] For example, a method for obtaining the fault tracing detection request
        packet 1044 by the third obtaining unit 1109 in the SFE 111 may be as follows: the
        third obtaining unit 1109 replaces the value of the TTL field in the fault tracing
        detection request packet 1043 with the second TTL parameter obtained by the second
30 obtaining unit 1108. Alternatively, the third obtaining unit 1109 generates the fault
        tracing detection request packet 1044 according to the fault tracing detection request
        packet 1043 and the second TTL parameter obtained by the second obtaining unit
        1 108.
        [0144] Optionally, if the fault tracing detection request packet 1043 filrther

                                                                                        34
        includes the first parameter, the third obtaining unit 1109 may filrther replace the first
        parameter in the fault tracing detection request packet 1043 With a second parameter,
        that is, the fault tracing detection request packet 1044 obtained by the third obtaining
        unit 1109 includes the second parameter. The second parameter is used to identify a
        next-hop SF node of an SF node, 011 the service chain, identified by using the first
         parameter.
        [0145] For example, a second forwarding entry in the storage unit in the SFE 111
        may include the second parameter, the path ID, and an address of a first device. The
        first device in this embodiment is the SF node 122. Alternatively, the first device
10 mentioned in this embodiment of the present invention may be a next-hop SFE 0f the
        SFE 111 011 the service chain. N0 filrther example is given herein for illustration. A
        first determining unit 1110 in the SFE 111 may determine, according to the second
        parameter and the path ID, to forward the fault tracing detection request packet 1044
        according to the second forwarding entry. A second sending unit 1111 in the SFE 111
15 sends the fault tracing detection request packet 1044 to the SF node 122 according to
        an address of the SF node 122. Alternatively, a second forwarding entry in the storage
        unit in the SFE 111 may include the path ID, an identifier of an interface for
        connecting to the SF node 121, and an address of the SF node 122. After determining
        that the received fault tracing detection request packet 1043 is from the SF node 121,
20 a first determining unit 1110 in the SFE 111 determines, according to the path ID and
        the identifier of the interface for connecting to the SF node 121, to forward the fault
        tracing detection request packet 1044 according to the second forwarding entry.
        [0146] 511. The SF node 122 sends a fault tracing detection request packet 1044
        to the SFE111.
25 [0147] A method for sending the fault tracing detection request packet 1044 by
        the SF node 122 to the SFE 111 in step 511 is the same as a method for sending the
        fault tracing detection request packet 1042 by the SF node 121 to the SFE 111 in step
        503, and details are not described herein again. A value of a TTL field included in the
        fault tracing detection request packet 1044 sent by the SF node 122 to the SFE 111 is
30 2.
         [0148] 512. The SFE 111 obtains an ID of the SF node 122 and a third TTL
         parameter.
        [0149] A method for obtaining the ID of the SF node 122 by the first obtaining
        unit 1107 in the SFE 111 is the same as a method for obtaining the ID of the SF node

                                                                                        35
        121 by the first obtaining unit 1107 in step 504, and details are not described herein
        again.
         [0150] For example, the second obtaining unit 1108 in the SFE 111 obtains the
        third TTL parameter according to the value of the TTL field included in the fault
        tracing detection request packet 1044. Specifically, after a first communications unit
         1105 determines that the SFE 111 can communicate With the SF node 122, the second
        obtaining unit 1108 may add an offset to or subtract an offset from a reference value
        to obtain the third TTL parameter, Where the value of the TTL field included in the
        fault tracing detection request packet 1044 is used as the reference value.
10 Alternatively, the SF node 122 adds an offset to or subtracts an offset from a reference
        value to obtain the third TTL parameter, Where a value of a TTL field included in the
        fault tracing detection request packet 1044 from the SFE 111 is used as the reference
        value. The SF node 122 adds the third TTL parameter to the TTL field in the fault
        tracing detection request packet 1044 sent to the SFE 111, so that the second
15 obtaining unit 1108 obtains the third TTL parameter from the TTL field included in
        the fault tracing detection request packet 1044. For example, the value of the TTL
        field in the fault tracing detection request packet 1044 is 2, the offset is 1, and the
        third TTL parameter obtained by the second obtaining unit 1108 is 1.
        [0151] 513. When the third TTL parameter is equal to the preset value, the SFE
20 111 sends a fault tracing detection response packet 1034 to the service classifier 131.
        [0152] For example, When the third TTL parameter obtained by the second
        obtaining unit 1108 is equal to the preset value, the first sending unit 1106 in the SFE
        111 sends the fault tracing detection response packet 1034 to the service classifier 131.
        For example, the third TTL parameter obtained by the second obtaining unit 1108 is 1,
25 and is the same as the preset value. The first sending unit 1106 may send the fault
        tracing detection response packet 1034 to the service classifier 131 according to the
        address of the service classifier 131.
        [0153] For example, the fault tracing detection response packet 1034 may be
        generated by the SFE 111 according to the path ID, the ID of the SF node 122, and the
30 address of the service classifier 131. Alternatively, the fault tracing detection response
        packet 1034 may be a fault tracing detection response packet that is generated by
        another deVice and is received by the SFE 111. Alternatively, a fault tracing detection
        response packet that is generated by another device and is received by the SFE 111
        includes the path ID and the address of the service classifier 131, and the SFE 111

                                                                                        36
        may add the ID of the SF node 122 to the fault tracing detection response packet, to
        obtain the fault tracing detection response packet 1034. Alternatively, the SFE 111
        replaces the ID of the SF node 121 in the fault tracing detection response packet 1032
        With the ID of the SF node 122, to obtain the fault tracing detection response packet
        1034.
        [0154] For example, a third receiving unit 1312 in the service classifier 131
        receives the fault tracing detection response packet 1034. The first determining unit
        1313 in the service classifier 131 may determine, according to the ID of the SF node
        122 in the fault tracing detection response packet 1034, that the service chain passes
10 through the SF node 122 connected to the SFE 111, and a link between the SF node
        122 and the SFE 111 is normal. After the fault tracing detection response packet 1032
        and the fault tracing detection response packet 1034 are received, the first determining
        unit 1313 may further determine that the SF node 122 011 the service chain is located
        011 a next hop 0fthe SF node 121.
15 [0155] Optionally, an SF node 011 the service chain may further update a value of
        a TTL field in a received fault tracing detection request packet, so that an SFE
        connected to the SF node does not need to update the value of the TTL field in the
        fault tracing detection request packet.
        [0156] Between step 502 and step 503, the following is further included: the first
20 parameter updating unit 1207 in the SF node 121 obtains the first TTL parameter. A
        method for obtaining the first TTL parameter by the first parameter updating unit
        1207 is the same as a method for obtaining the first TTL parameter by the second
        obtaining unit 1108 in the SFE 111 in step 504, and details are not described herein
        again. The first parameter updating unit 1207 in the SF node 121 adds the value of the
25 first TTL parameter to the TTL field included in the fault tracing detection request
        packet 1042, so that the second obtaining unit 1108 in the SFE 111 can obtain the first
        TTL parameter from the TTL field included in the fault tracing detection request
        packet 1042.
        [0157] Between step 507 and step 508, the following is further included: the first
30 parameter updating unit 1207 in the SF node 121 obtains the second TTL parameter. A
        method for obtaining the second TTL parameter by the first parameter updating unit
        1207 is the same as a method for obtaining the second TTL parameter by the second
        obtaining unit 1108 in the SFE 111 in step 509, and details are not described herein
        again. The first parameter updating unit 1207 in the SF node 121 adds the second TTL

                                                                                        37
        parameter to a TTL field included in the fault tracing detection request packet 1043,
        so that the second obtaining unit 1108 in the SFE 111 can obtain the second TTL
        parameter from the TTL field in the fault tracing detection request packet 1043.
        [0158] Between step 510 and step 511, the following is further included: the first
        parameter updating unit 1207 in the SF node 122 obtains the third TTL parameter. A
        method for obtaining the third TTL parameter by the first parameter updating unit
        1207 is the same as a method for obtaining the third TTL parameter by the second
        obtaining unit 1108 in the SFE 111 in step 512. The first parameter updating unit 1207
        in the SF node 122 adds the third TTL parameter to the TTL field included in the fault
10 tracing detection request packet 1044, so that the second obtaining unit 1108 in the
        SFE 111 can obtain the third TTL parameter from the TTL field in the fault tracing
        detection request packet 1044.

                                                                   Embodiment 2

        [0159] FIG. 10 is a schematic structural diagram of a network according to
15 Embodiment 2 0f the present invention. The network shown in FIG. 10 may be used to

        provide a value-added service. In the network shown in FIG. 10, a service classifier
         131 is connected to an SFE 111, the SFE 111 is connected to each of an SFE 112, an
         SF node 121, and an SF node 122, and the SFE 112 is connected to an SF node 123. A
        service chain shown in FIG. 10 includes the service classifier 131, the SFE 111, the
20 SFE 112, the SF node 121, the SF node 122, and the SF node 123. The service chain
        is a set of SF nodes, included in the service chain, that a packet passes through
        according to an order of the SF nodes. In the following embodiment of the present
        invention, a packet belonging to a particular type of service is referred to as a service
        packet. In a direction from the service classifier 131 to the SF node 123, the SFE 111
25 is a previous-hop SFE 0f the SFE 112 on the service chain, the SF node 121 is a
        previous-hop SF node of the SF node 122 on the service chain, and the SF node 122 is
        a previous-hop SF node of the SF node 123 on the service chain.
        [0160] A difference between any SFE in the network shown in FIG. 10 and an
        SFE in the network shown in FIG. 2 lies in that a fault tracing detection request packet
30 1021 sent by any SFE in the network shown in FIG. 10 is different from a fault tracing
        detection request packet 1042 sent by the SFE in the network shown in FIG. 2. In
        other words, any SFE in the network shown in FIG. 10 may include content included

                                                                                        38
        in the service forwarding apparatus shown in FIG. 3. That is, any SFE in the network
        shown in FIG. 10 includes: a processor 1101, a memory 1102, and a communications
        interface 1103. The processor 1101, the memory 1102, and the communications
        interface 1103 are connected by using a communications bus 1104. If the SFE shown
        in FIG. 10 is a switch in a network, the processor 1101 may be an NP. If the SFE
        shown in FIG. 10 is a router or a server, the processor 1011 may be a CPU.
        [0161] The memory 1102 is configured to store a program. Optionally, the
        memory 1102 may further store an ID of a service fimction apparatus and a
        forwarding entry.
10 [0162] The processor 1101 performs the following operations according to an
        executable instruction included in the program that is read from the memory 1102:
        [0163] The processor 1101 obtains a fault tracing detection request packet 1021
        by using the communications interface 1103, and then determines to communicate
        With the SF node 121. The fault tracing detection request packet 1021 includes a path
15 ID and an address of a device for initiating fault detection, and the path ID is used to
        identify a path of a service chain.
         [0164] The processor 1101 obtains an ID of the SF node 121 from the memory
        1 102.
        [0165] The processor 1101 sends a fault tracing detection response packet 1032 to
20 the service classifier 131 by using the communications interface 1103. The fault
        tracing detection response packet 1032 includes the path ID, the ID of the SF node
        121, and an address of the service classifier 131.
        [0166] Further, the processor 1101 enables, according to the executable
        instruction and the forwarding entry in the memory 1102 by cooperating With the
25 communications interface 1103, the SFE shown in FIG. 10 to perform all operations
        performed by an SFE 111 or an SFE 112 in the embodiment shown in FIG. 14.
        [0167] FIG. 11 is a schematic diagram of a service forwarding apparatus
        according to Embodiment 2 0f the present invention. The service forwarding
        apparatus shown in FIG. 11 includes: a first communications unit 1105, a first sending
30 unit 1106, and a first obtaining unit 1107. Optionally, the service forwarding apparatus
        shown in FIG. 11 filrther includes: a fourth obtaining unit 1113, a second determining
        unit 1114, and a third sending unit 1115. Optionally, the service forwarding apparatus
        shown in FIG. 11 further includes: a receiving unit 1116 and a fifth obtaining unit
        1117. Optionally, the service forwarding apparatus shown in FIG. 11 further includes:

                                                                                        39
        a first parameter updating unit 1118, a second parameter updating unit 1119, and/or a
        control unit 1120. Optionally, the service forwarding apparatus shown in FIG. 11 may
        further include a storage unit (not shown in FIG. 11). The storage unit is configured to
        store a forwarding entry and an ID of an SF node connected to an SFE 111. There is a
        correspondence between an identifier of an interface on the SFE 111 and the ID that is
        of the SF node connected to the SFE 111 and is stored in the storage unit.
        [0168] The service forwarding apparatus shown in FIG. 11 and the service
        forwarding apparatus shown in FIG. 3 may be a same apparatus. For example, both
        are the SFE 111 or the SFE 112 in the network shown in FIG. 10. It may be considered
10 that from a physical perspective, FIG. 3 displays content included in a service
        forwarding apparatus, and from a logical perspective, FIG. 11 displays content
        included in a service forwarding apparatus. Optionally, a sending function included in
        the first communications unit 1105 in FIG. 11 may be implemented by the
        communications interface 1103 in FIG. 3. A forwarding entry determining function
15 included in the first communications unit 1105 in FIG. 11 may be implemented by the
        processor 1101 in FIG. 3 according to an executable instruction stored in the memory
        1102. The first sending unit 1106, the third sending unit 1115, and the receiving unit
        1116 in FIG. 11 may be implemented by the communications interface 1103 in FIG. 3,
        and the communications interface 1103 may include at least one physical interface.
20 The first obtaining unit 1107, the fourth obtaining unit 1113, the second determining
        unit 1114, the fifth obtaining unit 1117, the first parameter updating unit 1118, the
        second parameter updating unit 1119, and the control unit 1120 in FIG. 11 may be
        implemented by the processor 1101 in FIG. 3 according to the executable instruction
        stored in the memory 1102, and the processor 1101 may include at least one physical
25 processor. The storage unit included in the service forwarding apparatus shown in FIG.
        11 may be implemented by the memory 1102 in FIG. 3.
        [0169] A difference between the service classifier 131 in the network shown in
        FIG. 10 and the service classifier 131 in the network shown in FIG. 2 lies in that the
        service classifier 131 in the network shown in FIG. 10 may send a fault tracing
30 detection request packet 1021 to detect a service chain. That is, a manner in which the
        service classifier 131 in the network shown in FIG. 10 sends a fault tracing detection
        request packet is different from that of the service classifier 131 in the network shown
         in FIG. 2. In other words, the service classifier 131 in the network shown in FIG. 10
        may include content included in the device for initiating fault detection shown in FIG.

                                                                                        40
        5. That is, the service classifier 131 in the network shown in FIG. 10 includes: a
        processor 1301, a memory 1302, and a communications interface 1303. The processor
        1301, the memory 1302, and the communications interface 1303 are connected by
        using a communications bus 1304. If the service classifier 131 shown in FIG. 10 is a
        switch in a network, the processor 1301 may be an NP. If the service Classifier 131
        shown in FIG. 10 is a router or a server, the processor 1301 may be a CPU.
        [0170] The memory 1302 is configured to store a program and a forwarding entry.
        [0171] The processor 1301 performs the following operations according to an
        executable instruction included in the program that is read from the memory 1302:
10 [0172] The processor 1301 sends a fault tracing detection request packet 1021 to
        the SFE 111 according to the forwarding entry that is read from the memory 1302 and
        by using the communications interface 1303. The fault tracing detection request
        packet 1021 includes a path ID of a service chain and an address of a deVice for
        initiating fault detection. The forwarding entry includes the path ID and an address of
15 the SFE 111.
        [0173] The processor 1301 receives a fault tracing detection response packet 1032
        from the SFE 111 by using the communications interface 1303. The fault tracing
        detection response packet 1032 includes the path ID of the service chain, an ID of the
        SF node 121, and the address of the device for initiating fault detection. The processor
20 1301 may learn, according to the ID of the SF node 121 included in the fault tracing
        detection response packet 1032, that the service chain passes through the SF node 121
        connected to the SFE 111.
        [0174] Further, the processor 1301 enables, according to the executable
        instruction and the forwarding entry in the memory 1302 by cooperating With the
25 communications interface 1303, the service classifier 131 shown in FIG. 10 to
        perform all operations performed by a service classifier 131 in the embodiment shown
        in FIG. 14.
        [0175] FIG. 12 is a schematic diagram of a device for initiating fault detection
        according to Embodiment 2 0f the present invention. The device for initiating fault
30 detection shown in FIG. 12 includes: a sending unit 1306, a first receiving unit 1305,
        and a first determining unit 1313. Optionally, the device for initiating fault detection
        shown in FIG. 12 further includes: a second adding unit 1308, a third adding unit 1309,
        a fourth adding unit 1310, a second receiving unit 1311, and/or a third receiving unit
        1312. Optionally, the device for initiating fault detection shown in FIG. 12 may

                                                                                        41
        further include a storage unit (not shown in FIG. 12). The storage unit is configured to
        store a forwarding entry.
        [0176] The device for initiating fault detection shown in FIG. 12 and the device
        for initiating fault detection shown in FIG. 5 may be a same apparatus. For example,
        both are the service classifier 131 in the network shown in FIG. 10. It may be
        considered that from a physical perspective, FIG. 5 displays content included in a
        device for initiating fault detection, and from a logical perspective, FIG. 12 displays
        content included in a device for initiating fault detection. Optionally, a sending
        function included in the sending unit 1306 in FIG. 12 may be implemented by the
10 communications interface 1303 in FIG. 5. A forwarding entry determining function
        included in the sending unit 1306 in FIG. 12 may be implemented by the processor
        1301 in FIG. 5 according to an executable instruction stored in the memory 1302. The
        first receiving unit 1305, the second receiving unit 1311, and the third receiving unit
        1312 in FIG. 12 may be implemented by the communications interface 1303 in FIG. 5,
15 and the communications interface 1303 may include at least one physical interface.
        The second adding unit 1308, the third adding unit 1309, the fourth adding unit 1310,
        and the first determining unit 1313 in FIG. 12 may be implemented by the processor
        1301 in FIG. 5 according to the executable instruction and a forwarding entry that are
        stored in the memory 1302, and the processor 1301 may include at least one physical
20 processor. The storage unit included in the device for initiating fault detection shown
        in FIG. 12 may be implemented by the memory 1302 in FIG. 5.
        [0177] A difference between any SF node in the network shown in FIG. 10 and an
        SF node in the network shown in FIG. 2 lies in that a fault tracing detection request
        packet received and sent by any SF node in the network shown in FIG. 10 is different
25 from a fault tracing detection request packet sent by the SF node in the network
        shown in FIG. 2. In other words, any SF node in the network shown in FIG. 10 may
        include content included in the service fianction apparatus shown in FIG. 7. That is,
        any SF node in the network shown in FIG. 10 includes: a processor 1201, a memory
        1202, and a communications interface 1203. The processor 1201, the memory 1202,
30 and the communications interface 1203 are connected by using a communications bus
        1204. If the SF node shown in FIG. 10 is a switch in a network, the processor 1201
        may be an NP. If the SF node shown in FIG. 10 is a router or a server, the processor
        1201 may be a CPU.
        [0178] The memory 1202 is configured to store a program and an ID of the SF

                                                                                        42
        node. Optionally, the memory 1202 may be further configured to store a forwarding
         entry.
        [0179] The processor 1201 performs the following operations according to an
        executable instruction included in the program that is read from the memory 1202:
        [0180] The processor 1201 receives a fault tracing detection request packet 1021
        from the SFE 111 by using the communications interface 1203. The fault tracing
        detection request packet 1021 includes a path ID and an address of a device for
        initiating fault detection, and the path ID is used to identify a path of a service chain.
        [0181] The processor 1201 sends a fault tracing detection request packet 1022 to
10 the SFE 111 by using the communications interface 1203. The fault tracing detection
        request packet 1022 includes the path ID and the address of the device for initiating
        fault detection.
        [0182] Optionally, the processor 1201 may filrther read the ID of the SF node
        from the memory 1202, for example, an ID of the SF node 121. The processor 1201
15 may add the ID of the SF node 121 to the fault tracing detection request packet 1022.
        [0183] Further, the processor 1201 enables, according to the executable
        instruction in the memory 1202 by cooperating With the communications interface
        1203, the SF node shown in FIG. 10 to perform all operations performed by any SF
        node in the embodiment shown in FIG. 14.
20 [0184] FIG. 13 is a schematic diagram of a service fimction apparatus according to
        Embodiment 2 0f the present invention. The service function apparatus shown in FIG.
        13 includes: a receiving unit 1205 and a sending unit 1206. Optionally, the service
        function apparatus shown in FIG. 13 filrther includes: a second parameter updating
        unit 1208 and a third parameter updating unit 1209. Optionally, the service function
25 apparatus shown in FIG. 13 may further include a storage unit (not shown in FIG. 13).
        The storage unit is configured to store an ID of the service function apparatus.
        Optionally, the storage unit is further configured to store a forwarding entry.
        [0185] The service function apparatus shown in FIG. 13 and the service
        forwarding apparatus shown in FIG. 7 may be a same apparatus. For example, both
30 are the SF node 121 or the SF node 122 in the network shown in FIG. 10. It may be
        considered that from a physical perspective, FIG. 7 displays content included in a
        service function apparatus, and from a logical perspective, FIG. 13 displays content
        included in a service fimction apparatus. Optionally, the receiving unit 1205 and the
        sending unit 1206 in FIG. 13 may be implemented by the communications interface

                                                                                        43
        1203 in FIG. 7, and the communications interface 1203 may include at least one
        physical interface. The second parameter updating unit 1208 and the third parameter
        updating unit 1209 in FIG. 13 may be implemented by the processor 1201 in FIG. 7
        according to an executable instruction stored in the memory 1202, and the processor
        1201 may include at least one physical processor. The storage unit included in the
        service function apparatus shown in FIG. 13 may be implemented by the memory
        1202 in FIG. 7.
         [0186] FIG. 14 is a flowchart of a service chain fault detection method according
        to Embodiment 2 0f the present invention. With reference to FIG. 10 to FIG. 13, the
10 following describes in detail the service chain fault detection method provided in
        Embodiment 2.
        [0187] 301. A service classifier 131 sends a fault tracing detection request packet
        1021 to an SFE111.
        [0188] For example, a sending unit 1306 in the service classifier 131 sends the
15 fault tracing detection request packet 1021 to the SFE 111. The fault tracing detection
        request packet 1021 includes an address of the service classifier 131 and a path ID of
        a service chain. Specifically, a forwarding entry stored in a storage unit in the service
        classifier 131 includes the path ID and an address of the SFE 111. The sending unit
        1306 determines, according to the obtained path ID of the service chain, to forward
20 the fault tracing detection request packet 1021 according to the forwarding entry in
        the storage unit in the service classifier 131. The sending unit 1306 sends the fault
        tracing detection request packet 1021 to the SFE 111 according to the address of the
        SFE 1 1 1 .
        [0189] For example, the path ID obtained by the sending unit 1306 may be from a
25 detection instruction received by the service classifier 131. The fault tracing detection
        request packet 1021 sent by the sending unit 1306 may be a fault tracing detection
        request packet 1021 generated according to the detection instruction. Alternatively,
        the fault tracing detection request packet 1021 sent by the sending unit 1306 may be a
        received fault tracing detection request packet 1021 generated by another device.
30 [0190] Optionally, the fault tracing detection request packet 1021 further includes
        a first parameter. The first parameter in Embodiment 2 and the first parameter in step
         501 m Embodiment 1 are the same in definition, and details are not described herein
        again.
        [0191] In the network shown in FIG. 10, the service classifier 131 is a device for

                                                                44
        initiating fault detection that receives the detection instruction. If the deVice for
        initiating fault detection is the SFE 111 itself or another SFE connected to the SFE
        111, the SFE 111 itself or the another SFE (an SFE except the SFE 112) connected to
        the SFE 111 may implement all operations of the service classifier 131 in a service
        chain fault detection process. For example, if the another SFE (an SFE except the SFE
        112) connected to the SFE 111 is the device for initiating fault detection, the another
        SFE (an SFE except the SFE 112) connected to the SFE 111 may generate the fault
        tracing detection request packet 1021 according to the received detection instruction.
        If the SFE 111 is the device for initiating fault detection, the SFE 111 may generate
10 the fault tracing detection request packet 1021 according to the received detection
        instruction.
        [0192] 302. The SFE 111 sends the fault tracing detection request packet 1021 to
        an SF node 121.
        [0193] A method for sending the fault tracing detection request packet 1021 by
15 the SFE 111 to the SF node 121 in step 302 is the same as a method for sending the
        fault tracing detection request packet 1042 by the SFE 111 to the SF node 121 in step
        502 in Embodiment 1, and details are not described herein again.
        [0194] 303. The SF node 121 sends a fault tracing detection request packet 1022
        to the SFE111.
20 [0195] For example, a receiving unit 1205 in the SF node 121 is configured to
        receive the fault tracing detection request packet 1021 from the SFE 111. A sending
        unit 1206 in the SF node 121 is configured to send the fault tracing detection request
        packet 1022 to the SFE 111. The fault tracing detection request packet 1022 includes
        the path ID and the address of the service classifier 131. Alternatively, in addition to
25 the path ID and the address of the service classifier 131, the fault tracing detection
        request packet 1022 includes at least one of the first parameter or an ID of the SF
        node 121.
        [0196] For example, the sending unit 1206 may send the fault tracing detection
        request packet 1022 to the SFE 111 according to an interface through Which the
30 receiving unit 1205 receives the fault tracing detection request packet 1021.
        Alternatively, the sending unit 1206 may determine the address of the SFE 111
        according to a forwarding entry stored in a storage unit in the SF node 121. The
        forwarding entry stored in the storage unit in the SF node 121 includes the path ID
        and the address of the SFE 111. The sending unit 1206 sends the fault tracing

                                                                                        45
        detection request packet 1022 to the SFE 111 according to the address of the SFE 111.
        The address of the SFE 111 may be an IP address of the SFE 111 or a MAC address of
        the SFE 111. If the SF node 121 and the SFE 111 are located 011 a same network
        device, the address of the SFE 111 may be an I/O address for connecting to the SF
        node 121. Alternatively, the address of the SFE 111 may be an identifier of an
        interface for connecting to the SFE 111 by the SF node 121.
        [0197] For example, the SF node 121 has two working manners. One working
        manner is that the SF node 121 uses the received fault tracing detection request packet
        1021 as the fault tracing detection request packet 1022, and sends the fault tracing
10 detection request packet 1022 to the SFE 111. The other working manner is that the
        SF node 121 obtains the fault tracing detection request packet 1022 according to the
        ID of the SF node 121 and the fault tracing detection request packet 1021. Specifically,
        in the other working manner of the SF node 121, a second parameter updating unit
        1208 in the SF node 121 may add the ID of the SF node 121 to the fault tracing
15 detection request packet 1021, to obtain the fault tracing detection request packet
        1022. Alternatively, a second parameter updating unit 1208 replaces the first
        parameter in the fault tracing detection request packet 1021 With the ID of the SF
        node 121, to obtain the fault tracing detection request packet 1022. Alternatively, a
        second parameter updating unit 1208 generates, according to the ID of the SF node
20 121 and the fault tracing detection request packet 1021, the fault tracing detection
        request packet 1022 that includes the ID of the SF node 121.
         [0198] 304. The SFE 111 obtains an ID of the SF node 121 and a fault tracing
        detection response packet 1032.
         [0199] For example, a first communications unit 1105 in the SFE 111 receives the
25 fault tracing detection request packet 1022 from the SF node 121. A first obtaining
        unit 1107 is configured to obtain the ID of the SF node 121. The first obtaining unit
        1107 may obtain the ID of the SF node 121 according to an interface for receiving the
        fault tracing detection request packet 1022 and a correspondence between the ID of
        the SF node 121 stored in the storage unit in the SFE 111 and the interface for
30 receiving the fault tracing detection request packet 1022. Alternatively, the first
        obtaining unit 1107 may obtain the ID of the SF node 121 from the fault tracing
        detection request packet 1022. Alternatively, When the first parameter in the fault
        tracing detection request packet 1022 is used to identify the SF node 121, the first
        obtaining unit 1107 may use the first parameter as the ID of the SF node 121, to

                                                                                        46
        obtain the ID of the SF node 121.
        [0200] For example, the first obtaining unit 1107 m the SFE 111 may generate the
        fault tracing detection response packet 1032 according to the path ID, the obtained ID
        of the SF node 121, and the address of the service classifier 131. Alternatively, the
        first obtaining unit 1107 m the SFE 111 may add the obtained ID of the SF node 121
        to a received fault tracing detection response packet generated by another device, to
        obtain the fault tracing detection response packet 1032.
        [0201] Optionally, the first obtaining unit 1107 in the SFE 111 may further add the
         first parameter, an ID of the SFE 111, and/or an ID of an SF node 122 to the fault
10 tracing detection response packet 1032, Which helps the service classifier 131 to learn
        a location of the SF node 121 011 the service chain. The ID of the SFE 111 and the ID
        of the SF node 122 may be stored in the storage unit in the SFE 111. The first
        obtaining unit 1107 may obtain the ID of the SF node 122 according to a
        correspondence between the ID of the SF node 122 in the storage unit and the path
15 ID.
        [0202] 305. The SFE 111 sends the fault tracing detection response packet 1032 to
        the service classifier 131.
         [0203] For example, a first sending unit 1106 m the SFE 111 sends the fault
        tracing detection response packet 1032 to the service classifier 131 according to the
20 address of the service classifier 131 in the fault tracing detection request packet 1022.
        The first sending unit 1106 is configured to send the fault tracing detection response
        packet 1032 to the service classifier 131 m a manner of sending the fault tracing
        detection response packet 1032 by using a reverse service chain of the service chain
        or by using a unicast IP packet.
25 [0204] For example, that the first sending unit 1106 sends the fault tracing
        detection response packet 1032 by using the reverse service chain of the service chain
        includes: the storage unit in the SFE 111 may be configured to store a correspondence
        between the path ID of the service chain and a path ID of the reverse service chain.
        The reverse service chain and the service chain are opposite in direction. The reverse
30 service Chain and the service chain may pass through a same link or different links.
        The first sending unit 1106 m the SFE 111 may send the fault tracing detection
        response packet 1032 to the service classifier 131 according to a forwarding entry
        corresponding to the reverse service chain of the service chain. The forwarding entry
        corresponding to the reverse service chain of the service chain may be stored in the

                                                                                        47
        storage unit in the SFE 111.
        [0205] For example, the unicast IP packet may be an Internet Control Message
        Protocol (English filll name: Internet Control Message Protocol, English abbreviation:
        ICMP) packet or a User Datagram Protocol (English filll name: User Datagram
        Protocol, English abbreviation: UDP) packet. In an example of the ICMP packet, a
        destination address in the ICMP packet is the address of the service classifier 131. A
        packet header of the ICMP packet includes a type parameter, and the type parameter is
        used to identify that a type of the ICMP packet belongs to a fault tracing detection
        response packet. Content in the ICMP packet includes the path ID of the service chain
10 and the ID of the SF node 121. In an example of the UDP packet, a destination
        address in the UDP packet is the address of the service classifier 131. A port number
        included in a packet header of the UDP packet is used to identify that a type of the
        UDP packet belongs to a fault tracing detection response packet. Content in the UDP
        packet includes the path ID of the service chain and the ID of the SF node 121.
15 [0206] For example, a first receiving unit 1305 in the service classifier 131
        receives the fault tracing detection response packet 1032. A first determining unit
        1313 in the service classifier 131 may determine, according to the ID of the SF node
        121 in the fault tracing detection response packet 1032, that the service chain passes
        through the SF node 121 connected to the SFE 111, and a link between the SF node
20 121 and the SFE 111 is normal.
        [0207] 306. The SFE 111 obtains a fault tracing detection request packet 1023.
        [0208] For example, a fourth obtaining unit 1113 in the SFE 111 is configured to
        obtain the fault tracing detection request packet 1023. The fault tracing detection
        request packet 1023 includes a second parameter, the path ID of the service chain, and
25 the address of the service classifier 131. An SF node identified by using the second
        parameter is a next-hop SF node of an SF node, on the service chain, identified by
        using the first parameter. When the first parameter is the ID of the SF node 121, the
        second parameter is the ID of the SF node 122. When the first parameter is an ID of a
        previous-hop SF node of the SF node 121 011 the service chain, the second parameter
30 is the ID of the SF node 121. The ID of the previous-hop SF node of the SF node 121
        011 the service chain may be a preset ID, and is used to indicate that the previous-hop
        SF node of the SF node 121 011 the service chain does not eXist.
        [0209] For example, a method for obtaining the fault tracing detection request
        packet 1023 by the fourth obtaining unit 1113 in the SFE 111 includes: When the

                                                                                        48
        second parameter is the same as the ID of the SF node 121, the fourth obtaining unit
        1113 in the SFE 111 may use the fault tracing detection request packet 1022 as the
        fault tracing detection request packet 1023. Alternatively, the fault tracing detection
        request packet 1022 includes the first parameter, and the fourth obtaining unit 1113 in
        the SFE 111 replaces the first parameter in the fault tracing detection request packet
        1022 With the second parameter, to obtain the fault tracing detection request packet
        1023. Alternatively, the fourth obtaining unit 1113 in the SFE 111 is configured to
        generate the fault tracing detection request packet 1023 according to the obtained
        second parameter, the path ID, and the address of the service classifier 131.
10 [0210] For example, the storage unit in the SFE 111 stores a correspondence
        between the ID of the SF node 122 and the interface for receiving the fault tracing
        detection request packet 1022. The fourth obtaining unit 1113 in the SFE 111 obtains
        the second parameter according to the interface for receiving the fault tracing
        detection request packet 1022 and an ID that is of an SF node and is corresponding to
15 the interface for receiving the fault tracing detection request packet 1022.
        [0211] 307. The SFE 111 sends the fault tracing detection request packet 1023 to
        an SF node 122.
        [0212] For example, a second forwarding entry stored in the storage unit in the
        SFE 111 includes the path ID, the second parameter, and an address of a first device.
20 In step 307, the address of the first device is an address of the SF node 122. A second
        determining unit 1114 in the SFE 111 determines, according to the second parameter
        and the path ID, to forward the fault tracing detection request packet 1023 according
        to the second forwarding entry. A third sending unit 1115 in the SFE 111 sends the
        fault tracing detection request packet 1023 to the SF node 122 according to the
25 address of the SF node 122. Alternatively, a second forwarding entry stored in the
        storage unit in the SFE 111 includes the path ID, an identifier of the interface for
        receiving the fault tracing detection request packet 1022, and an address of a first
        device. In step 307, the address of the first device is an address of the SF node 122. A
        second determining unit 1114 in the SFE 111 may determine, according to the path ID
30 and the identifier of the interface for receiving the fault tracing detection request
        packet 1022, to forward the fault tracing detection request packet 1023 according to
        the second forwarding entry.
        [0213] 308. The SF node 122 sends a fault tracing detection request packet 1024
        to the SFE111.

                                                                                        49
        [0214] For example, a receiving unit 1205 in the SF node 122 is configured to
        receive the fault tracing detection request packet 1023 from the SFE 111. A sending
        unit 1206 in the SF node 122 is configured to send the fault tracing detection request
        packet 1024 to the SFE 111. In addition to the path ID and the address of the service
        classifier 131, the fault tracing detection request packet 1024 includes at least one of
        the second parameter or the ID of the SF node 122.
        [0215] For example, the sending unit 1206 may send the fault tracing detection
        request packet 1024 to the SFE 111 according to an interface through Which the
        receiving unit 1205 receives the fault tracing detection request packet 1023.
10 Alternatively, the sending unit 1206 may determine the address of the SFE 111
        according to a forwarding entry stored in a storage unit in the SF node 122. The
        forwarding entry stored in the storage unit in the SF node 122 includes the path ID
        and the address of the SFE 111. The sending unit 1206 sends the fault tracing
        detection request packet 1024 to the SFE 111 according to the address of the SFE 111.
15 The address of the SFE 111 may be an IP address of the SFE 111 or a MAC address of
        the SFE 111. If the SF node 122 and the SFE 111 are located 011 a same network
        device, the address of the SFE 111 may be an I/O address for connecting to the SF
        node 122. Alternatively, the address of the SFE 111 may be an identifier of an
        interface for connecting to the SFE 111 by the SF node 122.
20 [0216] For example, the SF node 122 has two working manners, the two working
         manners of the SF node 122 are the same as those of the SF node 121, and details are
        not described herein again.
         [0217] 309. The SFE 111 obtains an ID of the SF node 122 and a fault tracing
        detection response packet 1034.
25 [0218] For example, a receiving unit 1116 in the SFE 111 receives the fault
        tracing detection request packet 1024 from the SF node 122. A fifth obtaining unit
        1117 in the SFE 111 obtains the ID of the SF node 122. The fifth obtaining unit 1117
        may obtain the ID of the SF node 122 according to an interface for receiving the fault
        tracing detection request packet 1024 and a correspondence between the ID of the SF
30 node 122 stored in the storage unit in the SFE 111 and the interface for receiving the
        fault tracing detection request packet 1024. Alternatively, the fifth obtaining unit 1117
        may obtain the ID of the SF node 122 from the fault tracing detection request packet
        1024. Alternatively, if the second parameter in the fault tracing detection request
        packet 1024 is used to identify the SF node 122, the fifth obtaining unit 1117 uses the

                                                                                        50
        second parameter as the ID of the SF node 122, to obtain the ID of the SF node 122.
        [0219] For example, the fifth obtaining unit 1117 in the SFE 111 may generate the
        fault tracing detection response packet 1034 according to the path ID, the obtained ID
        of the SF node 122, and the address of the service classifier 131. Alternatively, the
        fifth obtaining unit 1117 in the SFE 111 may add the obtained ID of the SF node 122
        to a received fault tracing detection response packet generated by another device, to
        obtain the fault tracing detection response packet 1034. Alternatively, the fifth
        obtaining unit 1117 in the SFE 111 may replace, With the ID of the SF node 122, the
        ID that is of the SF node 121 in the fault tracing detection response packet 1032 and is
10 obtained by the first obtaining unit 1107, to obtain the fault tracing detection response
        packet 1034.
        [0220] Optionally, the fifth obtaining unit 1117 in the SFE 111 may further add
         the second parameter, the ID of the SFE 111, and/or an ID of an SF node 123 to the
        fault tracing detection response packet 1034, which helps the service classifier 131 to
15 learn a location of the SF node 122 011 the service chain. The ID of the SFE 111 and
        the ID of the SF node 123 may be stored in the storage unit in the SFE 111. The fifth
        obtaining unit 1117 may obtain the ID of the SF node 123 according to a
        correspondence between the ID of the SF node 123 in the storage unit and the path
        ID.
20 [0221] 310. The SFE 111 sends the fault tracing detection response packet 1034 to
        the service classifier 131.
        [0222] A method for sending the fault tracing detection response packet 1034 by
        the SFE 111 to the service classifier 131 in step 310 is the same as a method for
        sending the fault tracing detection response packet 1032 by the SFE 111 to the service
25 classifier 131 in step 305, and details are not described herein again.
        [0223] For example, a third receiving unit 1312 in the service classifier 131
        receives the fault tracing detection response packet 1034. The first determining unit
        1313 in the service classifier 131 may determine, according to the ID of the SF node
        122 in the fault tracing detection response packet 1034, that the service chain passes
30 through the SF node 122 connected to the SFE 111, and a link between the SF node
        122 and the SFE 111 is normal. After the fault tracing detection response packet 1032
        and the fault tracing detection response packet 1034 are received, the first determining
        unit 1313 may further determine that the SF node 122 011 the service chain is located
        011 a next hop 0f the SF node 121.

                                                                                        51
        [0224] 311. The SFE 111 obtains a fault tracing detection request packet 1025.
        [0225] For example, the fourth obtaining unit 1113 in the SFE 111 is configured
        to obtain the fault tracing detection request packet 1025. The fault tracing detection
        request packet 1025 includes a third parameter, the path ID of the service chain, and
        the address of the service classifier 131. An SF node identified by using the third
        parameter is a next-hop SF node of an SF node, on the service chain, identified by
        using the second parameter. When the second parameter is the ID of the SF node 122,
        the third parameter is the ID of the SF node 123 011 the service Chain. When the
        second parameter is the ID of the SF node 121, the third parameter is the ID of the SF
10 node 122.
        [0226] For example, a method for obtaining the fault tracing detection request
        packet 1025 by the fourth obtaining unit 1113 in the SFE 111 includes: When the ID of
        the SF node 122 included in the fault tracing detection request packet 1024 is the
        same as the third parameter, the fourth obtaining unit 1113 in the SFE 111 may use the
15 fault tracing detection request packet 1024 as the fault tracing detection request packet
        1025. Alternatively, the fault tracing detection request packet 1024 includes the
        second parameter, and the fourth obtaining unit 1113 in the SFE 111 replaces the
        second parameter in the fault tracing detection request packet 1024 With the third
        parameter, to obtain the fault tracing detection request packet 1025. Alternatively, the
20 fourth obtaining unit 1113 in the SFE 111 is configured to generate the fault tracing
        detection request packet 1025 according to the obtained third parameter, the path ID,
        and the address of the service classifier 131.
        [0227] For example, the storage unit in the SFE 111 stores a correspondence
        between the ID of the SF node 123 and the interface for receiving the fault tracing
25 detection request packet 1024. The fourth obtaining unit 1113 in the SFE 111 obtains
        the third parameter according to the interface for receiving the fault tracing detection
        request packet 1024 and an ID that is of an SF node and is corresponding to the
        interface for receiving the fault tracing detection request packet 1024.
        [0228] 312. The SFE 111 sends the fault tracing detection request packet 1025 to
30 an SFE 112.
        [0229] For example, a third forwarding entry stored in the storage unit in the SFE
        111 includes the path ID, the third parameter, and an address of a first device. In step
         312, the address of the first device is an address of the SFE 112. The second
        determining unit 1114 in the SFE 111 determines, according to the third parameter

                                                                                        52
        and the path ID, to forward the fault tracing detection request packet 1025 according
        to the third forwarding entry. The third sending unit 1115 in the SFE 111 sends the
        fault tracing detection request packet 1025 to the SFE 112 according to the address of
        the SFE 112. Alternatively, a third forwarding entry stored in the storage unit in the
        SFE 111 includes the path ID, an identifier of the interface for receiving the fault
        tracing detection request packet 1024, and an address of a first device. In step 312, the
        address of the first device is an address of the SFE 112. The second determining unit
        1114 in the SFE 111 may determine, according to the path ID and the identifier of the
        interface for receiving the fault tracing detection request packet 1024, to forward the
10 fault tracing detection request packet 1025 according to the third forwarding entry.
        [0230] 313. The SFE 112 sends the fault tracing detection request packet 1025 to
        an SF node 123.
        [0231] For example, a first communications unit 1105 in the SFE 112 is
        configured to receive the fault tracing detection request packet 1025 from the SFE 111.
15 A forwarding entry includes the path ID, the third parameter, and an address of the SF
        node 123. The first communications unit 1105 determines, according to the path ID
        and the third parameter, to forward the fault tracing detection request packet 1025
        according to the forwarding entry. The first communications unit 1105 sends the fault
        tracing detection request packet 1025 to the SF node 123 according to the address of
20 the SF node 123. Alternatively, a forwarding entry includes the path ID and an address
        of the SF node 123. The first communications unit 1105 determines, according to the
        path ID, to forward the fault tracing detection request packet 1025 according to the
        forwarding entry.
        [0232] 314. The SF node 123 sends a fault tracing detection request packet 1026
25 to the SFE 112.
        [0233] For example, the SF node 123 has two working manners, the two working
        manners of the SF node 123 are the same as the working manners of the SF node 122,
        and details are not described herein again. The SF node 123 may include content
        included in the SF node 121, and a method for sending the fault tracing detection
30 request packet 1026 by the SF node 123 to the SFE 112 in step 314 is the same as that
        in step 303. Alternatively, the SF node 123 may include content included in the SF
        node 122, and a method for sending the fault tracing detection request packet 1026 by
        the SF node 123 to the SFE 112 in step 314 is the same as that in step 308.
        [0234] 315. The SFE 112 obtains an ID of the SF node 123 and a fault tracing

                                                                                        53
        detection response packet 1036.
         [0235] The SFE 112 may include content included in the SFE 111, and a method
        for obtaining the ID of the SF node 123 and the fault tracing detection response
        packet 1036 by the SFE 112 in step 315 is the same as that in step 304 or step 309.
        [0236] Optionally, the SFE 112 may further add the third parameter and/or an ID
        of the SFE 112 to the fault tracing detection response packet 1036, Which helps the
        service classifier 131 to learn a location of the SF node 123 on the service chain.
        [0237] 316. The SFE 112 sends the fault tracing detection response packet 1036 to
        the service classifier 131.
10 [0238] The SFE 112 may include the content included in the SFE 111, and a
        method for sending the fault tracing detection response packet 1036 by the SFE 112 to
        the service classifier 131 in step 316 is the same as that in step 305 or step 310.
         [0239] For example, the third receiving unit 1312 in the service classifier 131
        receives the fault tracing detection response packet 1036 from the SFE 112. After the
15 fault tracing detection response packet 1036 is received, the first determining unit
        1313 in the service classifier 131 determines that the service chain passes through the
         SF node 123, and a link between the SF node 123 and the SFE 112 is normal. The first
        determining unit 1313 in the service classifier 131 obtains the ID of the SF node 123
        from the fault tracing detection response packet 1036, and further learns, according to
20 the obtained ID of the SF node 121 and the obtained ID of the SF node 122, an order
         in Which the service chain passes through the SF node 121, the SF node 122, and the
        SF node 123.
         [0240] In the foregoing embodiment, the service classifier 131 may obtain an ID
        of an SF node from a received fault tracing detection response packet, Which is
25 helpfill to learn, according to the obtained ID of the SF node and an order of obtaining
        IDs of SF nodes, an SF node that a packet actually passes through When being
        forwarded and an order of SF nodes that the packet passes through. In addition, the
        service Classifier 131 may further obtain at least one of the first parameter, the third
         parameter, the ID of the SFE 111, or the ID of the SF node 121 from the received fault
30 tracing detection response packet, Which is helpful to accurately determine a location
        of an SF node on the service chain.
         [0241] To detect a segment of a link included in the service chain, the fault tracing
        detection request packet 1021 fiarther includes an ID of an SF node used as an end
        point. The ID of the SF node used as the end point may be from the detection

                                                                                        54
        instruction. The SF node used as the end point is a last SF node to be detected on the
        service chain. Optionally, a fourth adding unit 1310 in the service classifier 131 may
        add the ID of the SF node used as the end point to the fault tracing detection request
        packet 1021. Correspondingly, the fault tracing detection request packets 1022, 1023,
        1024, 1025, and 1026 may fiarther include the ID of the SF node used as the end point.
        Optionally, between step 305 and step 306, the following is fiarther included: When the
        ID, in the fault tracing detection request packet 1022, of the SF node used as the end
        point is the same as the ID of the SF node 121, a control unit 1120 in the SFE 111
        controls the fourth obtaining unit 1113 in the SFE 111 not to perform step 306; or
10 when the ID, in the fault tracing detection request packet 1022, of the SF node used as
        the end point is different from the ID of the SF node 121, a control unit 1120 in the
        SFE 111 controls the fourth obtaining unit 1113 in the SFE 111 to perform step 306.
        [0242] Optionally, after the fourth obtaining unit 1113 in the SFE 111 performs
        step 306, between step 310 and step 311, the following is fiarther included: the control
15 unit 1120 in the SFE 111 determines Whether the ID, in the fault tracing detection
        request packet 1024, of the SF node used as the end point is the same as the ID of the
        SF node 122. If the ID of the SF node used as the end point is the same as the ID of
        the SF node 122, the control unit 1120 in the SFE 111 may control the fourth
        obtaining unit 1113 in the SFE 111 not to perform step 311. If the ID of the SF node
20 used as the end point is different from the ID of the SF node 122, the control unit
        1120 in the SFE 111 may control the fourth obtaining unit 1113 in the SFE 111 to
        perform step 311.
        [0243] Optionally, between step 301 and step 302, the following is filrther
        included: the first obtaining unit 1107 in the SFE 111 may obtain a fault tracing
25 detection response packet 1031. The fault tracing detection response packet 1031 may
        include the ID of the SFE 111, the path ID of the service chain, and the address of the
        service classifier 131. The first sending unit 1106 in the SFE 111 sends the fault
        tracing detection response packet 1031 to the service classifier 131. A method for
        obtaining the fault tracing detection response packet 1031 by the first obtaining unit
30 1107 is the same as a method for obtaining the fault tracing detection response packet
        1032 by the first obtaining unit 1107, and details are not described herein again. The
        first sending unit 1106 in the SFE 111 sends the fault tracing detection response
        packet 1031 to the service classifier 131. A second receiving unit 1311 in the service
        classifier 131 receives the fault tracing detection response packet 1031 from the SFE

                                                                                        55
        111. The first determining unit 1313 in the service classifier 131 determines,
        according to the fault tracing detection response packet 1031, that the service chain
        passes through the SFE 111, and a link between the service classifier 131 and the SFE
        111 is normal.
        [0244] Optionally, between step 312 and step 313, the following is filrther
        included: a first obtaining unit 1107 in the SFE 112 may obtain a fault tracing
        detection response packet 1035. The fault tracing detection response packet 1035
        includes the ID of the SFE 112, the path ID of the service chain, and the address of
        the service Classifier 131. A first sending unit 1106 in the SFE 112 sends the fault
10 tracing detection response packet 1035 to the service classifier 131. A second
        receiving unit 1311 in the service classifier 131 receives the fault tracing detection
        response packet 1035 from the SFE 112. The first determining unit 1313 in the service
        classifier 131 determines, according to the fault tracing detection response packet
        1035, that the service chain passes through the SFE 112, and a link between the
15 service classifier 131 and the SFE 112 is normal.
        [0245] Optionally, the fault tracing detection request packet 1021 filrther includes
        a node list. The node list in the fault tracing detection request packet 1021 is used to
        indicate an SF node, between the device for initiating fault detection and the SFE 112,
        that the service chain passes through and an order of SF nodes that the service chain
20 passes through. For the node list, When the fault tracing detection request packet 1021
        is generated, content included in the node list may be determined according to a start
        SF node 011 Which fault detection is performed. An SF node included in the node list
        and an order of SF nodes that the service chain passes through increase as an SF node
        that a fault tracing detection request packet including the node list passes through
25 increases. If an SFE 0n the service chain updates the node list in the fault tracing
        detection request packet 1021, the method provided in Embodiment 2 filrther includes
        the following optional steps.
        [0246] Before the service classifier 131 sends the fault tracing detection request
        packet 1021 in step 301, the following is further included: a second adding unit 1308
30 in the service classifier 131 adds the node list to the fault tracing detection request
        packet 1021. The node list in the fault tracing detection request packet 1021 includes
        the ID of the previous-hop SF node of the SF node 121 on the service chain. For
        example, if the SF node 121 is a first SF node 011 the service chain, the node list in the
        fault tracing detection request packet 1021 may include a preset ID. The preset ID is

                                                                                        56
        used to identify that the previous-hop SF node of the SF node 011 the service chain
         does not eXist. If the SF node 121 is a second SF node 011 the service chain, the node
        list in the fault tracing detection request packet 1021 includes an ID of the first SF
        node 011 the service chain.
        [0247] Before the SFE 111 sends the fault tracing detection response packet 1032
        in step 305, the following is filrther included: a first parameter updating unit 1118 in
        the SFE 111 may obtain an updated node 1istbased 0n the node list in the fault tracing
        detection request packet 1021. The first obtaining unit 1107 may add the updated node
        list to the fault tracing detection response packet 1032. The node list in the fault
10 tracing detection response packet 1032 is a list obtained by adding the ID of the SF
        node 121 to the node list in the fault tracing detection request packet 1021. An order
        of all SF nodes in the node list in the fault tracing detection response packet 1032 is
        the same as an order of all the SF nodes on the service chain. According to an order of
        IDs of SF nodes included in the node list in the fault tracing detection response packet
15 1032, an order of SF nodes that a service packet passes through When being
        forwarded 0n the service chain may be learned. The first determining unit 1313 in the
        service Classifier 131 may learn, according to the node list in the received fault tracing
        detection response packet 1032, an SF node that the service chain passes through and
        an order of SF nodes that the service chain passes through. For example, the first
20 parameter updating unit 1118 may add the ID of the SF node 121 to the node list
        obtained from the fault tracing detection request packet 1021, to obtain the updated
        node list. If the node list in the fault tracing detection request packet 1021 includes the
        preset ID, the updated node list includes the ID of the SF node 121 and the preset ID.
        The ID of the SF node 121 included in the updated node list may be located before or
25 after the preset ID. According to the foregoing order and the preset ID, it may be
        learned that the SF node 121 is the first SF node on the service chain.
        [0248] Before the SFE 111 sends the fault tracing detection request packet 1023 in
        step 307, the following is further included: the fault tracing detection request packet
        1023 obtained by the fourth obtaining unit 1113 in the SFE 111 filrther includes the
30 node list in the fault tracing detection response packet 1032. For example, if the node
        list in the fault tracing detection response packet 1032 includes the preset ID and the
        ID of the first SF node 121, the node list in the fault tracing detection request packet
        1023 includes the preset ID and the ID of the first SF node 121.
        [0249] Before the SFE 111 sends the fault tracing detection response packet 1034

                                                                                        57
        in step 310, the following is filrther included: the first parameter updating unit 1118 in
        the SFE 111 may obtain an updated node list based on the node list in the fault tracing
        detection request packet 1023. The first obtaining unit 1107 may add the updated node
        list in step 309 to the fault tracing detection response packet 1034. The node list in the
        fault tracing detection response packet 1034 is a list obtained by adding the ID of the
        SF node 122 to the node list in the fault tracing detection request packet 1023. In this
        way, the first determining unit 1313 in the service classifier 131 may learn, according
        to the node list in the received fault tracing detection response packet 1034, an SF
        node that the service chain passes through and an order of SF nodes that the service
10 chain passes through. For example, the first parameter updating unit 1118 may add the
        ID of the SF node 122 to the node list in the fault tracing detection request packet
         1023, to obtain the updated node list, that is, the node list in the fault tracing detection
        response packet 1034. The node list in the fault tracing detection response packet
        1034 includes the preset ID, the ID of the first SF node 121, and the ID of the second
15 SF node 122. If the ID of the first SF node 121 included in the node list in the fault
        tracing detection response packet 1032 is located before the preset ID, the ID of the
        second SF node 122 included in the node list in the fault tracing detection response
        packet 1034 is located before the ID of the first SF node 121. If the ID of the first SF
        node 121 included in the node list in the fault tracing detection response packet 1032
20 is located after the preset ID, the ID of the second SF node 122 included in the node
        list in the fault tracing detection response packet 1034 is located after the ID of the
        first SF node 121. According to the foregoing order, the preset ID, and the ID of the
        SF node 121, it may be learned that the SF node 122 is the second SF node 011 the
        service chain.
25 [0250] Before the SFE 111 sends the fault tracing detection request packet 1025 in
        step 312, the following is further included: the fault tracing detection request packet
        1025 obtained by the fourth obtaining unit 1113 in the SFE 111 may filrther include
        the node list in the fault tracing detection response packet 1034. For example, if the
        node list in the fault tracing detection response packet 1034 includes the preset ID, the
30 ID of the first SF node 121, and the ID of the second SF node 122, the node list in the
        fault tracing detection request packet 1025 includes the preset ID, the ID of the first
        SF node 121, and the ID of the second SF node 122.
        [0251] Before the SFE 112 sends the fault tracing detection response packet 1036
        in step 316, the following is filrther included: the first parameter updating unit 1118 in

                                                                                        58
        the SFE 112 may obtain an updated node list based on the node list in the fault tracing
        detection request packet 1025. A method for obtaining the updated node list by the
        SFE 112 is the same as a method for obtaining the updated node list by the SFE 111,
        and details are not described herein again. The first obtaining unit 1107 in the SFE
        112 may add the updated node list obtained by the first parameter updating unit 1118
        in the SFE 112 to the fault tracing detection response packet 1036. The node list in the
        fault tracing detection response packet 1036 includes the preset ID, the ID of the SF
         node 121, the ID of the SF node 122, and the ID of the SF node 123. The preset ID,
         the ID of the SF node 121, the ID of the SF node 122, and the ID of the SF node 123
10 are arranged according to a preset order, so that the service classifier 131 learns,
        according to SF nodes included in the node list in the fault tracing detection response
        packet 1036 and an order of the SF nodes, an SF node that a packet actually passes
        through when being forwarded and an order of SF nodes that the packet passes
        through.
15 [0252] In the foregoing embodiment, an ID of an SF node received by the service
        classifier 131 is carried in a fault tracing detection response packet in a form of a node
         list, so that the service classifier 131 can directly learn, according to the node list, an
        SF node that a packet actually passes through When being forwarded and an order of
        SF nodes that the packet passes through.
20 [0253] Optionally, the fault tracing detection request packet 1021 further includes
        a node list. The node list in the fault tracing detection request packet 1021 is used to
        indicate an SF node, between the device for initiating fault detection and the SFE 112,
        that the service chain passes through and an order of SF nodes that the service chain
        passes through. For the node list, When the fault tracing detection request packet 1021
25 is generated, content included in the node list may be determined according to a start
        SF node 011 Which fault detection is performed. An SF node included in the node list
        and an order of SF nodes that the service chain passes through increase as an SF node
        that a fault tracing detection request packet including the node list passes through
        increases. If an SF node on the service chain updates the node list in the fault tracing
30 detection request packet 1021, the method provided in Embodiment 2 filrther includes
        the following optional steps.
        [0254] Before the service classifier 131 sends the fault tracing detection request
        packet 1021 in step 301, the following is further included: a second adding unit 1308
        in the service classifier 131 adds the node list to the fault tracing detection request

                                                                                        59
        packet 1021. The node list in the fault tracing detection request packet 1021 includes
        the ID of the previous-hop SF node of the SF node 121 on the service chain. For
        example, if the SF node 121 is the first SF node 011 the service chain, the node list in
        the fault tracing detection request packet 1021 may include a preset ID. The preset ID
        is used to identify that the previous-hop SF node of the SF node 011 the service chain
        does not exist. If the SF node 121 is the second SF node 011 the service chain, the node
        list in the fault tracing detection request packet 1021 includes an ID of the first SF
        node 011 the service chain.
        [0255] Before the SF node 121 sends the fault tracing detection request packet
10 1022 in step 303, the following is further included: the second parameter updating
        unit 1208 in the SF node 121 may obtain an updated node 1istbased 0n the node list in
        the fault tracing detection request packet 1021. The second parameter updating unit
        1208 in the SF node 121 may add the updated node list to the fault tracing detection
        request packet 1022. The node list in the fault tracing detection request packet 1022 is
15 a list obtained by adding the ID of the SF node 121 to the node list in the fault tracing
        detection request packet 1021. That is, the node list in the fault tracing detection
        request packet 1022 is the same as the node list in the fault tracing detection response
        packet 1032 obtained by the SFE 111 in the foregoing embodiment, and details are
        not described herein again.
20 [0256] Before the SFE 111 sends the fault tracing detection response packet 1032
        in step 305, the following is filrther included: the first obtaining unit 1107 in the SFE
        111 may add the node list obtained from the fault tracing detection request packet
        1022 to the fault tracing detection response packet 1032.
        [0257] Before the SFE 111 sends the fault tracing detection request packet 1023 in
25 step 307, the following is further included: the fault tracing detection request packet
        1023 obtained by the fourth obtaining unit 1113 in the SFE 111 filrther includes the
        node list in the fault tracing detection response packet 1032.
        [0258] Before the SF node 122 sends the fault tracing detection request packet
        1024 in step 308, the following is further included: a second parameter updating unit
30 1208 in the SF node 122 may obtain an updated node 1istbased 0n the node list in the
        fault tracing detection request packet 1023. The second parameter updating unit 1208
        in the SF node 122 may add the updated node list to the fault tracing detection request
        packet 1024. The node list in the fault tracing detection request packet 1024 is a list
        obtained by adding the ID of the SF node 122 to the node list in the fault tracing

                                                                                        60
        detection request packet 1023. That is, the node list in the fault tracing detection
        request packet 1024 is the same as the node list in the fault tracing detection response
        packet 1034 obtained by the SFE 111 in the foregoing embodiment, and details are
        not described herein again.
        [0259] Before the SFE 111 sends the fault tracing detection response packet 1034
        in step 310, the following is filrther included: the fifth obtaining unit 1117 in the SFE
        111 may add the node list obtained from the fault tracing detection request packet
        1024 to the fault tracing detection response packet 1034.
        [0260] Before the SFE 111 sends the fault tracing detection request packet 1025 in
10 step 312, the following is further included: the fault tracing detection request packet
        1025 obtained by the fourth obtaining unit 1113 in the SFE 111 filrther includes the
        node list in the fault tracing detection response packet 1034.
        [0261] Before the SF node 123 sends the fault tracing detection request packet
        1026 in step 314, the following is further included: a second parameter updating unit
15 1208 in the SF node 123 may obtain an updated node 1istbased 0n the node list in the
        fault tracing detection request packet 1025. The second parameter updating unit 1208
        may add the ID of the SF node 123 to the fault tracing detection request packet 1026.
        That is, the node list in the fault tracing detection request packet 1026 is the same as
        the node list in the fault tracing detection response packet 1036 obtained by the SFE
20 112 in the foregoing embodiment, and details are not described herein again.
        [0262] Before the SFE 112 sends the fault tracing detection response packet 1036
        in step 316, the following is further included: a first obtaining unit 1107 in the SFE
        112 may further add the node list obtained from the fault tracing detection request
        packet 1026 to the fault tracing detection response packet 1036.
25 [0263] In comparison With an embodiment in Which an SFE obtains an updated
        node list, in the foregoing embodiment, an SF node obtains an updated node list,
        which is helpfial to reduce burden of the SFE.
        [0264] Optionally, the fault tracing detection request packet 1021 filrther includes
        a reference value. The reference value is greater than or equal to 0. If an SFE 0n the
30 service Chain updates the reference value in the fault tracing detection request packet
        1021, the method provided in Embodiment 2 further includes the following optional
         steps.
        [0265] Before the service classifier 131 sends the fault tracing detection request
        packet 1021 in step 301, the following is further included: a third adding unit 1309 in

                                                                                        61
        the service classifier 131 may add the reference value to the fault tracing detection
        request packet 1021. Alternatively, the fault tracing detection request packet 1021
        obtained by the service classifier 131 includes the reference value.
        [0266] Before the SFE 111 sends the fault tracing detection response packet 1032
        in step 305, the following is filrther included: a second parameter updating unit 1119
        in the SFE 111 obtains a sequence number of the SF node 121. The sequence number
        of the SF node 121 is generated according to the reference value and an offset. The
        offset is greater than 0. For example, the sequence number of the SF node 121 is
        generated by adding the offset to the reference value, or is generated by subtracting
10 the offset from the reference value. The first obtaining unit 1107 adds the sequence
        number of the SF node 121 to the fault tracing detection response packet 1032. In this
        way, the service classifier 131 may learn a location of the SF node on the service
        chain according to the sequence number of the SF node 121 in the received fault
        tracing detection response packet 1032. In this embodiment of the present invention,
15 if the sequence number of the SF node 121 may identify the location of the SF node
        121 on the service chain, the sequence number of the SF node 121 may be added to
        the fault tracing detection response packet 1032 as a parameter. The service Classifier
        131 may learn the location of the SF node 121 on the service chain according to the
        ID of the SF node 121 and the sequence number of the SF node 121 that are in the
20 fault tracing detection response packet 1032. Alternatively, if the sequence number of
        the SF node 121 may identify both the SF node 121 and the location of the SF node
        121 on the service chain, the sequence number of the SF node 121 may be carried in
        the fault tracing detection response packet 1032 as the ID of the SF node 121. The
        service classifier 131 may learn the location of the SF node 121 on the service chain
25 according to the sequence number of the SF node 121 in the fault tracing detection
        response packet 1032.
        [0267] Before the SFE 111 sends the fault tracing detection request packet 1023 in
        step 307, the following is further included: the fault tracing detection request packet
        1023 obtained by the fourth obtaining unit 1113 in the SFE 111 filrther includes the
30 sequence number of the SF node 121.
        [0268] Before the SFE 111 sends the fault tracing detection response packet 1034
        in step 310, the following is further included: the second parameter updating unit 1119
        in the SFE 111 is configured to obtain a sequence number of the SF node 122 based
        on the sequence number of the SF node 121 in the fault tracing detection request

                                                                                        62
        packet 1023. For example, the sequence number of the SF node 122 is generated by
        adding the offset to the sequence number of the SF node 121, or is generated by
        subtracting the offset from the sequence number of the SF node 121. The first
        obtaining unit 1107 adds the sequence number of the SF node 122 to the fault tracing
        detection response packet 1034. In this way, the service classifier 131 may learn a
        location of the SF node 122 on the service chain according to the sequence number of
        the SF node 122 in the received fault tracing detection response packet 1034. A
        function of the sequence number of the SF node 122 may be the same as a function of
        the sequence number of the SF node 121, and details are not described herein again.
10 [0269] Before the SFE 111 sends the fault tracing detection request packet 1025 in
        step 312, the following is further included: the fault tracing detection request packet
        1025 obtained by the fourth obtaining unit 1113 in the SFE 111 filrther includes the
        sequence number of the SF node 122 in the fault tracing detection response packet
        1034.
15 [0270] Before the SFE 112 sends the fault tracing detection response packet 1036
        in step 316, the following is filrther included: a second parameter updating unit 1119
        in the SFE 112 is configured to obtain a sequence number of the SF node 123 based
        on the sequence number of the SF node 122 in the fault tracing detection request
        packet 1025. For example, the sequence number of the SF node 123 is generated by
20 adding the offset to the sequence number of the SF node 122, or is generated by
        subtracting the offset from the sequence number of the SF node 122. The first
        obtaining unit 1107 adds the sequence number of the SF node 123 to the fault tracing
        detection response packet 1036. In this way, the service classifier 131 may learn a
        location of the SF node 123 on the service chain according to the sequence number of
25 the SF node 123 in the received fault tracing detection response packet 1036. A
        function of the sequence number of the SF node 123 may be the same as a function of
        the sequence number of the SF node 121, and details are not described herein again.
        [0271] In the foregoing embodiment, if a sequence number of an SF node may
        identify a location of the SF node on the service chain, the sequence number of the SF
30 node may be added to a fault tracing detection response packet as a parameter. The
        service classifier 131 may accurately learn the location of the SF node on the service
        chain according to an ID of the SF node and the sequence number of the SF node that
        are in the fault tracing detection response packet. Alternatively, if a sequence number
        of an SF node may identify both the SF node and a location of the SF node on the

                                                                                        63
        service chain, the sequence number of the SF node may be carried in a fault tracing
        detection response packet as an ID of the SF node. The service classifier 131 may
        accurately learn the location of the SF node 011 the service chain according to the
        sequence number of the SF node in the fault tracing detection response packet.
        [0272] Optionally, the fault tracing detection request packet 1021 further includes
        a reference value. If an SF node 011 the service chain updates the reference value in
        the fault tracing detection request packet 1021, the method provided in Embodiment 2
        further includes the following optional steps.
        [0273] Before the service classifier 131 sends the fault tracing detection request
10 packet 1021 in step 301, the following is further included: a third adding unit 1309 in
        the service classifier 131 may add the reference value to the fault tracing detection
        request packet 1021. Alternatively, the fault tracing detection request packet 1021
        obtained by the service classifier 131 includes the reference value.
        [0274] Before the SF node 121 sends the fault tracing detection request packet
15 1022 in step 303, the following is further included: a third parameter updating unit
        1209 in the SF node 121 may obtain a sequence number of the SF node 121 based on
        the reference value in the fault tracing detection request packet 1021. The third
        parameter updating unit 1209 adds the sequence number of the SF node 121 to the
        fault tracing detection request packet 1022. A method for obtaining the sequence
20 number of the SF node 121 by the SF node 121 is the same as a method for obtaining
        the sequence number of the SF node 121 by the SFE 111.
        [0275] Before the SFE 111 sends the fault tracing detection response packet 1032
        in step 305, the following is further included: the first obtaining unit 1107 in the SFE
        111 may add the sequence number of the SF node 121 obtained from the fault tracing
25 detection request packet 1022 to the fault tracing detection response packet 1032.
        [0276] Before the SFE 111 sends the fault tracing detection request packet 1023 in
        step 307, the following is further included: the fault tracing detection request packet
        1023 obtained by the fourth obtaining unit 1113 in the SFE 111 further includes the
        sequence number of the SF node 121 in the fault tracing detection response packet
30 1032.
        [0277] Before the SF node 122 sends the fault tracing detection request packet
        1024 in step 308, the following is further included: a third parameter updating unit
        1209 in the SF node 122 may obtain a sequence number of the SF node 122 based on
        the sequence number of the SF node 121 in the fault tracing detection request packet

                                                                                        64
        1023. The third parameter updating unit 1209 may add the sequence number of the SF
        node 122 to the fault tracing detection request packet 1024. A method for obtaining
        the sequence number of the SF node 122 by the SF node 122 is the same as a method
        for obtaining the sequence number of the SF node 122 by the SFE 111.
        [0278] Before the SFE 111 sends the fault tracing detection response packet 1034
        in step 310, the following is filrther included: the fifth obtaining unit 1117 in the SFE
        111 filrther adds the sequence number of the SF node 122 obtained from the fault
        tracing detection request packet 1024 to the fault tracing detection response packet
        1034.
10 [0279] Before the SFE 111 sends the fault tracing detection request packet 1025 in
        step 312, the following is further included: the fault tracing detection request packet
        1025 obtained by the fourth obtaining unit 1113 in the SFE 111 filrther includes the
        sequence number of the SF node 122 in the fault tracing detection response packet
        1034.
15 [0280] Before the SF node 123 sends the fault tracing detection request packet
        1026 in step 314, the following is filrther included: a third parameter updating unit
        1209 in the SF node 123 is configured to obtain a sequence number of the SF node
        123 based on the sequence number of the SF node 122 in the fault tracing detection
        request packet 1025. The third parameter updating unit 1209 adds the sequence
20 number of the SF node 123 to the fault tracing detection request packet 1026. A
        method for obtaining the sequence number of the SF node 123 by the SF node 123 is
        the same as a method for obtaining the sequence number of the SF node 123 by the
        SFE 112.
        [0281] Before the SFE 112 sends the fault tracing detection response packet 1036
25 in step 316, the following is further included: the first obtaining unit 1107 in the SFE
        112 may filrther add the sequence number of the SF node 123 obtained from the fault
        tracing detection request packet 1026 to the fault tracing detection response packet
        1036.
        [0282] In comparison With an embodiment in Which an SFE obtains a sequence
30 number of an SF node, in the foregoing embodiment, an SF node obtains a sequence
        number of the SF node itself, which is helpful to reduce burden of the SFE.

                                                                                        65
                                                            Embodiment 3

        [0283] FIG. 15 is a schematic structural diagram of a network according to
        Embodiment 3 0f the present invention. A structure of the network shown in FIG. 15
        is the same as the structure of the network shown in FIG. 10. A type of a packet sent
        by each apparatus in the network shown in FIG. 15 is different from a type of a packet
        sent by each apparatus in the network shown in FIG. 10. On a basis of the service
        forwarding apparatus shown in FIG. 4 0r FIG. 11, a second receiving unit (not shown
        in the figure) and a fourth sending unit (not shown in the figure) may be added to any
        SFE in the network shown in FIG. 15. Optionally, the service forwarding apparatus
10 further includes a reporting unit. On a basis of the device for initiating fault detection
        shown in FIG. 6 0r FIG. 12, a fourth receiving unit (not shown in the figure) may be
        added to a service classifier 131 used as a device for initiating fault detection in the
        network shown in FIG. 15. On a basis of the service function apparatus shown in FIG.
        8 0r FIG. 13, an obtaining unit (not shown in the figure) and a forwarding unit (not
15 shown in the figure) may be added to any SF node in the network shown in FIG. 15.
         [0284] FIG. 16 is a flowchart of a service chain fault detection method according
        to Embodiment 3 0f the present invention. The method provided in Embodiment 3
        may be executed before the method provided in Embodiment 1 or Embodiment 2, and
        the method provided in Embodiment 3 is optional in a service chain fault detection
20 process. With reference to the network shown in FIG. 15, the following describes in
        detail the service chain fault detection method provided in Embodiment 3.
        [0285] 701. A service classifier 131 sends a connectivity detection packet 1051 to
        an SFE 111.
        [0286] For example, a fourth receiving unit in the service classifier 131 used as a
25 device for initiating fault detection may receive an instruction used to enable
        connectivity detection on a service chain, to generate the connectivity detection
        packet 1051. Alternatively, a fourth receiving unit in the service classifier 131 used as
        a device for initiating fault detection obtains the connectivity detection packet 1051
        from another device connected to the service classifier 131. The connectivity
30 detection packet 1051 includes a path ID of the service chain. A sending unit 1306 in
        the service classifier 131 may send the connectivity detection packet 1051 to the SFE
        111 according to an address of the SFE 111 included in a forwarding entry.
        [0287] 702. The SFE 111 sends the connectivity detection packet 1051 to an SF

                                                                                        66
        node 121.
         [0288] For example, a second receiving unit in the SFE 111 receives the
        connectivity detection packet 1051 from the service classifier 131. A fourth sending
        unit in the SFE 111 sends the connectivity detection packet 1051 to the SF node 121
        according to an address of the SF node 121 included in a first forwarding entry. The
        first forwarding entry may be the same as the first forwarding entry mentioned in
        Embodiment 1 0r Embodiment 2, and details are not described herein again.
        [0289] 703. The SF node 121 sends a connectivity detection packet 1051 to the
        SFE 1 1 1 .
10 [0290] For example, an obtaining unit in the SF node 121 receives the
        connectivity detection packet 1051 from the SFE 111. A forwarding unit in the SF
        node 121 sends the connectivity detection packet 1051 to the SFE 111. A method for
        sending the connectivity detection packet 1051 by the forwarding unit in the SF node
        121 is the same as a method used by the sending unit 1206 in Embodiment 1 0r
15 Embodiment 2, and details are not described herein again.
        [0291] 704. The SFE 111 sends a connectivity detection packet 1051 to an SF
        node 122.
        [0292] A method for sending the connectivity detection packet 1051 by the SFE
        111 to the SF node 122 in step 704 is the same as a method in step 702.
20 [0293] 705. The SF node 122 sends a connectivity detection packet 1051 to the
        SFE 1 1 1 .
         [0294] The SF node 122 includes content included in the SF node 121. A method
        for sending the connectivity detection packet 1051 by the SF node 122 to the SFE 111
        in step 705 is the same as the method in step 703.
25 [0295] 706. The SFE 111 sends a connectivity detection packet 1051 to an SFE
        1 12.
        [0296] A method for sending the connectivity detection packet 1051 by the SFE
        111 to the SFE 112 in step 706 is the same as the method in step 702.
        [0297] 707. The SFE 112 sends the connectivity detection packet 1051 to an SF
30 node 123.
         [0298] The SFE 112 includes content included in the SFE 111. A method for
        sending the connectivity detection packet 1051 by the SFE 112 to the SF node 123 in
        step 707 is the same as the method in step 702.
        [0299] 708. The SF node 123 sends a connectivity detection packet 1051 to the

                                                                                        67
        SFE 112.
        [0300] The SF node 123 includes the content included in the SF node 121. A
        method for sending the connectivity detection packet 1051 by the SF node 123 to the
        SFE 112 in step 708 is the same as the method in step 703.
        [0301] 709. The SFE 112 feeds back a connectivity detection result to the service
        classifier 131.
        [0302] If the SFE 112 is a last SFE 0n the service chain, and a second receiving
        unit in the SFE 112 receives the connectivity detection packet 1051 from the SF node
        123 Within a preset time, a reporting unit in the SFE 112 feeds back, to the service
10 classifier 131, a connectivity detection result indicating link normality. If a second
        receiving unit in the SFE 112 does not receive the connectivity detection packet 1051
        from the SF node 123 within a preset time or does not receive the connectivity
        detection packet 1051 from the SFE 111 Within a preset time, a reporting unit in the
        SFE 112 feeds back, to the service classifier 131, a connectivity detection result
15 indicating link abnormality. Link abnormality may indicate a link fault.
        [0303] Optionally, the SFE 112 may feed back the connectivity detection result to
        a deVice that sends the instruction used to enable connectivity detection on the service
        chain, instead of feeding back the connectivity detection result to the service classifier
        131 in step 709.
20 [0304] Optionally, if the SFE 112 is not the last SFE 0n the service chain, a fourth
        sending unit in the SFE 112 further continues, according to a forwarding entry, to
        forward the connectivity detection packet 1051 to a next device 011 the service chain,
        and the last SFE 011 the service chain performs an operation of feeding back the
        connectivity detection result.
25 [0305] In the foregoing embodiment of the present invention, a tunnel is
        established between two adjacent nodes of all nodes included in the service chain, and
        a fault tracing detection request packet, a fault tracing detection response packet, and
        a connectivity detection packet may be transmitted through the tunnel between the
        two adjacent nodes. For example, if a tunnel is established between the SFE 111 and
30 the SF node 121, the fault tracing detection request packet, the fault tracing detection
        response packet, and the connectivity detection packet may be transmitted through the
        tunnel between the SFE 111 and the SF node 121. If a tunnel is established between
        the SFE 111 and the SF node 122, the fault tracing detection request packet, the fault
        tracing detection response packet, and the connectivity detection packet may be

                                                                                        68
        transmitted through the tunnel between the SFE 111 and the SF node 122. If a tunnel
        is established between the SFE 111 and the SFE 112, the fault tracing detection
        request packet, the fault tracing detection response packet, and the connectivity
        detection packet may be transmitted through the tunnel between the SFE 111 and the
        SFE 112.
        [0306] In the foregoing embodiment of the present invention, the fault tracing
        detection request packet, the fault tracing detection response packet, and the
        connectivity detection packet belong to an operation, administration and maintenance
        (English full name: operation, administration and maintenance, English abbreviation:
10 0AM) packet. The DAM packet may carry a parameter for identifying a packet type,
        so that an apparatus that receives a packet learns, according to the parameter that is
        for identifying a packet type and is carried in the DAM packet, that the received
        packet is one of the fault tracing detection request packet, the fault tracing detection
        response packet, or the connectivity detection packet. FIG. 17 is a schematic diagram
15 of an 0AM packet according to an embodiment of the present invention. The DAM
        packet shown in FIG. 17 includes network encapsulation (English name: network
        encapsulation), a service chain header (English name: service chain header), and
        content (English name: content). The network encapsulation included in the DAM
        packet may be Ethernet encapsulation, UDP encapsulation, Generic Routing
20 Encapsulation (English full name: Generic Routing Encapsulation, English
        abbreviation: GRE), Multiprotocol Label Switching (English full name: Multiprotocol
        Label Switching, English abbreviation: MPLS) encapsulation, or the like. A flag
        (English name: flag) bit included in the service chain header may be used to identify
        that the DAM packet is a packet used for service chain detection. One or more bits
25 included in the service chain header may be used to identify a path ID of a service
        chain. One or more bits included in the content in the DAM packet may be used to
        identify a type (English name: type) of the DAM packet, and a value of the type may
        identify that the DAM packet is a fault tracing detection request packet, a fault tracing
        detection response packet, or a connectivity detection packet. For example, when the
30 value of the type is 0, it indicates that the DAM packet is a fault tracing detection
        request packet; When the value of the type is 1, it indicates that the DAM packet is a
        fault tracing detection response packet; When the value of the type is 2, it indicates
        that the DAM packet is a connectivity detection packet. The one or more bits included
        in the content in the DAM packet may be used to identify an ID of a node. The node

                                                                                        69
         may be a node included in the service chain, for example, a node such as an SF node
        121 or an SFE 111 on the service Chain.
        [0307] If the DAM packet shown in FIG. 17 is a fault tracing detection response
        packet, and the fault tracing detection response packet is carried in an ICMP packet,
        content in the ICMP packet includes the service chain header and the content in the
        DAM packet in FIG. 17. A packet header of the ICMP packet further includes a type
        parameter, and the type parameter is used to identify that the ICMP packet belongs to
        a fault tracing detection response packet. If the DAM packet shown in FIG. 17 is a
        fault tracing detection response packet, and the fault tracing detection response packet
10 is carried in a UDP packet, content in the UDP packet includes the service Chain
        header and the content in the DAM packet in FIG. 17. A port number included in a
        packet header of the UDP packet is used to identify that a type of the UDP packet
        belongs to a fault tracing detection response packet.
        [0308] The foregoing processor may be a microprocessor or the processor may be
15 any conventional processor. The steps of the method disclosed With reference to the
        embodiments of the present invention may be directly performed by a hardware
        processor, or may be performed by using a combination of hardware in the processor
        and a software module. When it is implemented by using software, code that
        implements the foregoing functions may be stored in a computer-readable medium,
20 Where the computer--readable medium includes a computer storage medium. The
        storage medium may be any available medium accessible to a computer. The
        following is used as an example but is not limited: The computer readable medium
        may be a random access memory (English full name: random access memory, English
        abbreviation: RAM), a read-only memory (English full name: read-only memory,
25 English abbreviation: ROM), an electrically erasable programmable read-only
        memory (English filll name: electrically erasable programmable read-only memory,
        English abbreviation: EEPROM), a compact disc read-only memory (English filll
        name: compact disc-read only memory, English abbreviation: CD-ROM) or another
        optical disc storage, a disk storage medium or another magnetic storage device, or any
30 other medium that can be used to carry or store expected program code in a form of
        an instruction or data structure and can be accessed by a computer. The
        computer-readable medium may be a compact disc (English filll name: compact disc,
        English abbreviation: CD), a laser disc, an optical disc, a digital Video disc (English
        full name: digital Video disc, English abbreviation: DVD), a floppy disk, or a Blu-ray

                                                                                        70
        disc.
        [0309] Persons of ordinary skill in the art may understand that all or some of the
        steps of the foregoing method embodiments may be implemented by a program
        instructing relevant hardware. The foregoing program may be stored in a computer
        readable storage medium. When the program runs, the steps of the method
        embodiments are performed. The foregoing storage medium may be at least one of the
        following mediums: any medium that can store program code, such as a ROM, a
        RAM, a magnetic disk, or an optical disc.
        [0310] Finally, it should be noted that the foregoing embodiments are merely
10 intended for exemplarily describing the technical solutions of the present invention,
        but not for limiting the present invention. Although the present invention and benefits
        of the present invention are described in detail With reference to the foregoing
        embodiments, persons of an ordinary skill in the art should understand that they may
        still make modifications to the technical solutions described in the foregoing
15 embodiments or make equivalent replacements to some technical features thereof,
        Without departing from the scope of the claims of the present invention.
        [0311] Further embodiments of the present invention are provided in the
        following. It should be noted that the numbering used in the following section does
        not necessarily need to comply With the numbering used in the previous sections.
20 [0312] Embodiment 1, a service chain fault detection method, Where the method
        includes:

              obtaining, by a service forwarding entity SFE, a first fault tracing detection
        request packet, and then determining to communicate With a first service function SF
        node, Where the first fault tracing detection request packet includes a path identifier
25 ID and an address of a device for initiating fault detection, and the path ID is used to
        identify a path of a service chain;

              obtaining, by the SFE, an ID of the first SF node; and
              sending, by the SFE, a first fault tracing detection response packet to the device
        for initiating fault detection, Where the first fault tracing detection response packet
30 includes the path ID, the ID of the first SF node, and the address of the device for
        initiating fault detection.
         [0313] Embodiment 2, the method according to embodiment 1, Where the
        determining, by an SFE, to communicate With a first SF node 011 the service chain
         includes:

                                                                                        71
    determining, by the SFE according to the path ID, to forward the first fault

    tracing detection request packet according to a first forwarding entry, Where the first

    forwarding entry includes the path ID and an address of the first SF node;

    sending, by the SFE, the first fault tracing detection request packet to the first SF

    node according to the address of the first SF node; and

    receiving, by the SFE, a second fault tracing detection request packet from the

    first SF node, where the second fault tracing detection request packet includes the

    path ID and the address of the deVice for initiating fault detection.

         [0314] Embodiment 3, the method according to embodiment 2, Where the first
10 fault tracing detection request packet further includes a first parameter, the first

    parameter is used to identify the first SF node or is used to identify a previous-hop SF

    node of the first SF node 011 the service chain, and the first forwarding entry further

    includes the first parameter; and

    the determining, by the SFE according to the path ID, to forward the first fault

15 tracing detection request packet according to a first forwarding entry includes:

    determining, by the SFE according to the first parameter and the path ID, to forward

    the first fault tracing detection request packet according to the first forwarding entry.

    [0315] Embodiment 4, the method according to embodiment 3, Where the first

    fault tracing detection request packet filrther includes a time to live TTL field;

20  after the receiving, by the SFE, a second fault tracing detection request packet

    from the first SF node, the method filrther includes: obtaining, by the SFE, a TTL

    parameter, Where the TTL parameter is data obtained after a value of the TTL field in

    the first fault tracing detection request packet is updated; and

    the sending, by the SFE, a first fault tracing detection response packet to the

25 deVice for initiating fault detection filrther includes: When the TTL parameter is equal

    to a preset value, sending, by the SFE, the first fault tracing detection response packet

    to the deVice for initiating fault detection.

    [0316] Embodiment 5, the method according to embodiment 4, where the method

    further includes:

30  When the TTL parameter is not equal to the preset value, obtaining, by the SFE, a

    third fault tracing detection request packet, Where the third fault tracing detection

    request packet includes a second parameter, the path ID, the TTL field, and the

    address of the deVice for initiating fault detection, and the second parameter is used to

    identify a next-hop SF node of an SF node, on the service chain, identified by using

                                                   72
    the first parameter;

    determining, by the SFE according to the second parameter and the path ID, to

    forward the third fault tracing detection request packet according to a second

    forwarding entry, Where the second forwarding entry includes the path ID, the second

    parameter, and an address of a first device, the first device is a next-hop SFE 0f the

    SFE 0n the service chain or a second SF node, and the second SF node is a next-hop

    SF node of the first SF node on the service chain; and

    sending, by the SFE, the third fault tracing detection request packet to the first

    device according to the address of the first device.

10 [0317] Embodiment 6, the method according to embodiment 3, Where before the

    sending, by the SFE, a first fault tracing detection response packet to the deVice for

    initiating fault detection, the method fiirther includes:

    sending, by the SFE, a second fault tracing detection response packet to the

    device for initiating fault detection, where the second fault tracing detection response

15 packet includes the path ID, an ID of the SFE, and the address of the device for

    initiating fault detection.

    [0318] Embodiment 7, the method according to embodiment 3 or 6, where after

    the sending, by the SFE, a first fault tracing detection response packet to the device

    for initiating fault detection, the method fithher includes:

20  obtaining, by the SFE, a fourth fault tracing detection request packet, Where the

    fourth fault tracing detection request packet includes a second parameter, the path ID,

    and the address of the device for initiating fault detection, and the second parameter is

    used to identify a next-hop SF node of an SF node, on the service chain, identified by

    using the first parameter;

25  determining, by the SFE according to the second parameter and the path ID, to

    forward the fourth fault tracing detection request packet according to a second

    forwarding entry, Where the second forwarding entry includes the path ID, the second

    parameter, and an address of a first device, the first device is a next-hop SFE 0f the

    SFE 0n the service chain or a second SF node, and the second SF node is a next-hop

30 SF node of the first SF node on the service chain; and

    sending, by the SFE, the fourth fault tracing detection request packet to the first

    device according to the address of the first device.

    [0319] Embodiment 8, the method according to embodiment 7, where the first

    device is the second SF node, and the method further includes:

                                 73
    receiving, by the SFE, a fifth fault tracing detection request packet from the

    second SF node, Where the fifth fault tracing detection request packet includes the

    path ID and the address of the device for initiating fault detection;

    obtaining, by the SFE, an ID of the second SF node according to the fifth fault

    tracing detection request packet; and

    sending, by the SFE, a third fault tracing detection response packet to the device

    for initiating fault detection, Where the third fault tracing detection response packet

    includes the path ID, the ID of the second SF node, and the address of the device for

    initiating fault detection.

10 [0320] Embodiment 9, the method according to any one of embodiment 2,

    embodiment 3, or embodiments 6 to 8, Where the method further includes:
          adding, by the SFE, at least one of the first parameter or the ID of the SFE to the

    first fault tracing detection response packet.

    [0321] Embodiment 10, the method according to any one of embodiment 2,

15 embodiment 3, or embodiments 6 to 8, where the first fault tracing detection request

    packet further includes a node list, and the node list includes an ID of the

    previous-hop SF node of the first SF node on the service chain; and

    before the sending, by the SFE, a first fault tracing detection response packet to

    the device for initiating fault detection, the method further includes:

20  obtaining, by the SFE, an updated node list, Where the updated node list is a list

    generated after the ID of the first SF node is added to the node list, and an order of all

    SF nodes included in the updated node list is the same as an order of all the SF nodes

    on the service chain; and

    adding, by the SFE, the updated node list to the first fault tracing detection

25 response packet.

    [0322] Embodiment 11, the method according to any one of embodiment 2,

    embodiment 3, or embodiments 6 to 10, where the first fault tracing detection request

    packet further includes an ID of an SF node used as an end point; and

    after the sending, by the SFE, a first fault tracing detection response packet to the

30 device for initiating fault detection, the method filrther includes:

    ending, by the SFE, detection on the service chain When the ID of the first SF

    node is the same as the ID of the SF node used as the end point.

    [0323] Embodiment 12, the method according to any one of embodiments 1 to 11,

    Where the obtaining, by an SFE, a first fault tracing detection request packet includes:

                                           74
    receiving, by the SFE, the first fault tracing detection request packet sent by the

    device for initiating fault detection; or

    receiving, by the SFE, the first fault tracing detection request packet sent by a

    previous--hop SFE 0f the SFE 0n the service chain; or

    generating, by the SFE, the first fault tracing detection request packet.

    [0324] Embodiment 13, the method according to any one of embodiments 1 to 12,

    Where

    the sending, by the SFE, a first fault tracing detection response packet to the

    device for initiating fault detection includes:

10  obtaining, by the SFE, a path ID of a reverse service chain of the service Chain

    by using the path ID, Where the reverse service chain and the service chain are

    opposite in direction; and

    sending, by the SFE according to a forwarding entry corresponding to the path

    ID of the reverse service chain, the first fault tracing detection response packet to the

15 device for initiating fault detection, Where the forwarding entry corresponding to the

    path ID of the reverse service chain includes the path ID of the reverse service chain

    and the address of the device for initiating fault detection; or

    the sending, by the SFE, a first fault tracing detection response packet to the

    device for initiating fault detection includes:

20  adding, by the SFE, the first fault tracing detection response packet to a unicast

    Internet Protocol IP packet, and sending the unicast IP packet to the device for

    initiating fault detection, Where a destination IP address in the unicast IP packet is the

    address of the device for initiating fault detection.

    [0325] Embodiment 14, a service chain fault detection method, Where the method

25 includes:

    sending, by a device for initiating fault detection, at first fault tracing detection

    request packet to a service forwarding entity SFE, where the first fault tracing

    detection request packet includes a path identifier ID and an address of the device for

    initiating fault detection, and the path ID is used to identify a path of a service chain;

30  receiving, by the device for initiating fault detection, at first fault tracing

    detection response packet from the SFE, where the first fault tracing detection

    response packet includes the path ID, an ID of a first service fimction SF node, and

    the address of the device for initiating fault detection; and

    after receiving the first fault tracing detection response packet, determining, by

                                               75
        the device for initiating fault detection, that the service chain passes through the first
        SF node, and forwarding between the SFE and the first SF node is normal.
        [0326] Embodiment 15, the method according to embodiment 14, Where the
        sending, by a device for initiating fault detection, a first fault tracing detection request
        packet to the SFE includes:

              determining, according to the path ID by the device for initiating fault detection,
        to forward the first fault tracing detection request packet according to a forwarding
        entry, Where the forwarding entry includes the path ID and an address of the SFE; and

              sending, by the device for initiating fault detection, the first fault tracing
10 detection request packet to the SFE according to the address of the SFE.

        [0327] Embodiment 16, the method according to embodiment 14 or 15, Where the
        first fault tracing detection request packet filrther includes a first parameter, and the
        first parameter is used to identify the first SF node or is used to identify a
        previous-hop SF node of the first SF node on the service chain.
15 [0328] Embodiment 17, the method according to any one of embodiments 14 to
        16, Where the first fault tracing detection request packet further includes a time to live
        TTL field.
        [0329] Embodiment 18, the method according to any one of embodiments 14 to
        16, Where the first fault tracing detection request packet filrther includes a node list,
20 and the node list includes an ID of the previous-hop SF node of the first SF node on
        the service chain; and the first fault tracing detection response packet further includes
        an updated node list, the updated node list is a list generated after the ID of the first
        SF node is added to the node list, and an order of all SF nodes included in the updated
        node list is the same as an order of all the SF nodes on the service chain.
25 [0330] Embodiment 19, the method according to any one of embodiments 14 to
        16, Where before the receiving, by the device for initiating fault detection, a first fault
        tracing detection response packet from the SFE, the method further includes:

              receiving, by the device for initiating fault detection, a second fault tracing
        detection response packet from the SFE, where the second fault tracing detection
30 response packet includes the path ID, an ID of the SFE, and the address of the deVice
        for initiating fault detection; and

              after receiving the second fault tracing detection response packet, determining,
        by the device for initiating fault detection, that the service chain passes through the
        SFE, and forwarding between the SFE and the device for initiating fault detection is

                                                                                        76
    normal.

    [0331] Embodiment 20, the method according to any one of embodiments 14 to

    19, Where after the receiving, by the deVice for initiating fault detection, at first fault

    tracing detection response packet from the SFE, the method further includes:

    receiving, by the deVice for initiating fault detection, at third fault tracing

    detection response packet from the SFE, where the third fault tracing detection

    response packet includes the path ID, an ID of a second SF node, and the address of

    the device for initiating fault detection, and the second SF node is a next-hop SF node

    of the first SF node 011 the service chain; and

10  after receiving the third fault tracing detection response packet, determining, by

    the deVice for initiating fault detection, that the service chain passes through the

    second SF node, and forwarding between the SFE and the second SF node is normal.

    [0332] Embodiment 21, a service chain fault detection method, Where the method
    includes:

15  receiving, by a service function SF node, a first fault tracing detection request

    packet from a service forwarding entity SFE, Where the first fault tracing detection

    request packet includes a path identifier ID and an address of a deVice for initiating

    fault detection, and the path ID is used to identify a path of a service chain; and

    sending, by the SF node, a second fault tracing detection request packet to the

20 SFE, Where the second fault tracing detection request packet includes the path ID and

    the address of the deVice for initiating fault detection.

    [0333] Embodiment 22, the method according to embodiment 21, Where the first

    fault tracing detection request packet and the second fault tracing detection request

    packet each filrther includes a time to live TTL field; and

25  before the sending, by the SF node, a second fault tracing detection request

    packet to the SFE, the method fithher includes:

    obtaining, by the SF node, a TTL parameter, Where the TTL parameter is data

    obtained after a value of the TTL field included in the first fault tracing detection

    request packet is updated; and

30  using, by the SF node, the TTL parameter as a value of the TTL field included in

    the second fault tracing detection request packet.

    [0334] Embodiment 23, the method according to embodiment 21, Where the first

    fault tracing detection request packet filrther includes a node list, and the node list

    includes an ID of a previous-hop SF node of the SF node 011 the service chain; and

                                    77
              before the sending, by the SF node, a second fault tracing detection request
        packet to the SFE, the method further includes:

              obtaining, by the SF node, an updated node list, Where the updated node list is a
        list generated after an ID of the SF node is added to the node list, and an order of all
        SF nodes in the updated node list is the same as an order of all the SF nodes on the
        service chain; and

              adding, by the SF node, the updated node list to the second fault tracing detection
        request packet.
        [0335] Embodiment 24, the method according to any one of embodiments 21 to
10 23, Where the first fault tracing detection request packet filrther includes a first
        parameter, the first parameter is used to identify the SF node or is used to identify the
        previous-hop SF node of the SF node 011 the service chain, and the second fault
        tracing detection request packet filrther includes at least one of the first parameter or
        the ID of the SF node.
15 [0336] Embodiment 25, a service forwarding apparatus, Where the service
        forwarding apparatus includes:

              a first communications unit, configured to: obtain a first fault tracing detection
        request packet, and then determine to communicate With a first service function SF
        node, Where the first fault tracing detection request packet includes a path identifier
20 ID and an address of a device for initiating fault detection, and the path ID is used to
        identify a path of a service chain;

              a first obtaining unit, configured to obtain an ID of the first SF node; and
              a first sending unit, configured to send a first fault tracing detection response
        packet to the device for initiating fault detection, Where the first fault tracing detection
25 response packet includes the path ID, the ID of the first SF node, and the address of
        the device for initiating fault detection.
        [0337] Embodiment 26, the service forwarding apparatus according to
        embodiment 25, Where
              the first communications unit is specifically configured to determine, according
30 to the path ID, to forward the first fault tracing detection request packet according to a
        first forwarding entry, Where the first forwarding entry includes the path ID and an
         address of the first SF node;
              the first communications unit is specifically configured to send the first fault
        tracing detection request packet to the first SF node according to the address of the

                                                                                        78
         first SF node; and
              the first communications unit is specifically configured to receive a second fault

        tracing detection request packet from the first SF node, Where the second fault tracing
        detection request packet includes the path ID and the address of the deVice for
        initiating fault detection.
        [0338] Embodiment 27, the service forwarding apparatus according to
        embodiment 26, Where the first fault tracing detection request packet further includes
        a first parameter, the first parameter is used to identify the first SF node or is used to
        identify a previous-hop SF node of the first SF node 011 the service chain, and the first
10 forwarding entry further includes the first parameter; and

              the first communications unit is further configured to determine, according to the
        first parameter and the path ID, to forward the first fault tracing detection request
        packet according to the first forwarding entry.
        [0339] Embodiment 28, the service forwarding apparatus according to
15 embodiment 27, Where the first fault tracing detection request packet further includes
         a time to live TTL field;

              the service forwarding apparatus further includes: a second obtaining unit;
              the second obtaining unit is configured to obtain a TTL parameter, Where the
        TTL parameter is data obtained after a value of the TTL field in the first fault tracing
20 detection request packet is updated; and
              the first sending unit is filrther configured to: When the TTL parameter is equal to
        a preset value, send the first fault tracing detection response packet to the deVice for
        initiating fault detection.
        [0340] Embodiment 29, the service forwarding apparatus according to
25 embodiment 28, Where the service forwarding apparatus further includes: a third
        obtaining unit, a first determining unit, and a second sending unit, Where
              the third obtaining unit is configured to: When the TTL parameter is not equal to
        the preset value, obtain a third fault tracing detection request packet, Where the third
        fault tracing detection request packet includes a second parameter, the path ID, the
30 TTL field, and the address of the deVice for initiating fault detection, the second
        parameter is used to identify a next-hop SF node of an SF node, 011 the service chain,
        identified by using the first parameter, and a value of the TTL field in the third fault
        tracing detection request packet is the TTL parameter;
              the first determining unit is configured to determine, according to the second

                                                                                        79
        parameter and the path ID, to forward the third fault tracing detection request packet
        according to a second forwarding entry, Where the second forwarding entry includes
        the path ID, the second parameter, and an address of a first device, the first deVice is a
        next-hop SFE of the service forwarding apparatus 011 the service chain or a second SF
        node, and the second SF node is a next-hop SF node of the first SF node on the
        service chain; and

              the second sending unit is configured to send the third fault tracing detection
        request packet to the first deVice according to the address of the first device.
        [0341] Embodiment 30, the service forwarding apparatus according to
10 embodiment 27, where the first sending unit is further configured to send a second
        fault tracing detection response packet to the device for initiating fault detection,
        Where the second fault tracing detection response packet includes the path ID, an ID
        of the service forwarding apparatus, and the address of the device for initiating fault
        detection.
15 [0342] Embodiment 31, the service forwarding apparatus according to
        embodiment 27 or 30, Where the service forwarding apparatus further includes:

              a fourth obtaining unit, configured to obtain a fourth fault tracing detection
        request packet, Where the fourth fault tracing detection request packet includes a
        second parameter, the path ID, and the address of the device for initiating fault
20 detection, and the second parameter is used to identify a next-hop SF node of an SF
        node, 011 the service chain, identified by using the first parameter;

              a second determining unit, configured to determine, according to the second
        parameter and the path ID, to forward the fourth fault tracing detection request packet
        according to a second forwarding entry, Where the second forwarding entry includes
25 the path ID, the second parameter, and an address of a first device, the first device is a
        next-hop SFE of the service forwarding apparatus 011 the service chain or a second SF
        node, and the second SF node is a next-hop SF node of the first SF node on the
        service chain; and

              a third sending unit, configured to send the fourth fault tracing detection request
30 packet to the first device according to the address of the first device.

        [0343] Embodiment 32, the service forwarding apparatus according to
        embodiment 31, Where the first device is the second SF node, and the service
        forwarding apparatus fiirther includes:

              a receiving unit, configured to receive a fifth fault tracing detection request

                                                                                        80
        packet from the second SF node, Where the fifth fault tracing detection request packet
        includes the path ID and the address of the device for initiating fault detection; and

              a fifth obtaining unit, configured to obtain an ID of the second SF node
        according to the fifth fault tracing detection request packet; and

              the first sending unit is further configured to send a third fault tracing detection
        response packet to the device for initiating fault detection, where the third fault
        tracing detection response packet includes the path ID, the ID of the second SF node,
        and the address of the device for initiating fault detection.
        [0344] Embodiment 33, the service forwarding apparatus according to any one of
10 embodiment 26, embodiment 27, or embodiments 30 to 32, where the first obtaining
        unit is further configured to add at least one of the first parameter or the ID of the
        service forwarding apparatus to the first fault tracing detection response packet.
        [0345] Embodiment 34, the service forwarding apparatus according to any one of
         embodiment 26, embodiment 27, or embodiments 30 to 32, where the first fault
15 tracing detection request packet fiarther includes a node list, and the node list includes
        an ID of the previous-hop SF node of the first SF node on the service chain;

              the service forwarding apparatus fiarther includes:
              a first parameter updating unit, configured to obtain an updated node list, Where
        the updated node list is a list generated after the ID of the first SF node is added to the
20 node list, and an order of all SF nodes included in the updated node list is the same as
         an order of all the SF nodes on the service chain; and
              the first obtaining unit is fiarther configured to add the updated node list to the
        first fault tracing detection response packet.
        [0346] Embodiment 35, the service forwarding apparatus according to any one of
25 embodiment 26, embodiment 27, or embodiments 30 to 34, where the first fault
        tracing detection request packet fiarther includes an ID of an SF node used as an end
        point; and
              the service forwarding apparatus further includes:
              a control unit, configured to: after the first sending unit sends the first fault
30 tracing detection response packet to the device for initiating fault detection, determine
        that the ID of the first SF node is the same as the ID of the SF node used as the end
        point, and end detection on the service chain.
        [0347] Embodiment 36, the service forwarding apparatus according to any one of
        embodiments 25 to 35, Where

                                                                                        81
              the first communications unit is specifically configured to receive the first fault
        tracing detection request packet sent by the device for initiating fault detection; or

              the first communications unit is specifically configured to receive the first fault
        tracing detection request packet sent by a previous-hop SFE 0f the service forwarding
        apparatus 011 the service chain; or

              the first communications unit is specifically configured to generate the first fault
        tracing detection request packet.
        [0348] Embodiment 37, the service forwarding apparatus according to any one of
        embodiments 25 to 36, Where the first sending unit is specifically configured to obtain
10 a path ID of a reverse service chain of the service chain by using the path ID, Where
        the reverse service chain and the service chain are opposite in direction; and

              the first sending unit is specifically configured to send, according to a forwarding
        entry corresponding to the path ID of the reverse service chain, the first fault tracing
        detection response packet to the device for initiating fault detection, where the
15 forwarding entry includes the path ID of the reverse service chain and the address of
        the device for initiating fault detection; or

              the first sending unit is specifically configured to: add the first fault tracing
        detection response packet to a unicast Internet Protocol IP packet, and send the
        unicast IP packet to the device for initiating fault detection, Where a destination IP
20 address in the unicast IP packet is the address of the device for initiating fault
        detection.
         [0349] Embodiment 38, a device for initiating fault detection, Where the device
        for initiating fault detection includes:

              a sending unit, configured to send a first fault tracing detection request packet to
25 a service forwarding entity SFE, Where the first fault tracing detection request packet

        includes a path ID and an address of the device for initiating fault detection, and the
        path ID is used to identify a path of a service chain;

              a first receiving unit, configured to receive a first fault tracing detection response
        packet from the SFE, where the first fault tracing detection response packet includes
30 the path ID, an ID of a first service function SF node, and the address of the device for
        initiating fault detection; and

              a first determining unit, configured to: after the first fault tracing detection
        response packet is received, determine that the service chain passes through the first
        SF node, and forwarding between the SFE and the first SF node is normal.

                                                                                        82
    [0350] Embodiment 39, the device for initiating fault detection according to

    embodiment 38, Where

    the sending unit is specifically configured to determine, according to the path ID,

    to forward the first fault tracing detection request packet according to a forwarding

    entry, Where the forwarding entry includes the path ID and an address of the SFE; and

    the sending unit is specifically configured to send the first fault tracing detection

    request packet to the SFE according to the address of the SFE.

    [0351] Embodiment 40, the device for initiating fault detection according to

    embodiment 38 or 39, Where the first fault tracing detection request packet further

10 includes a first parameter, and the first parameter is used to identify the first SF node

    or is used to identify a previous-hop SF node of the first SF node on the service chain.

    [0352] Embodiment 41, the device for initiating fault detection according to any

    one of embodiments 38 to 40, Where the device for initiating fault detection fiarther

    includes:

15  a first adding unit, configured to add a time to live TTL field to the first fault

    tracing detection request packet.

    [0353] Embodiment 42, the device for initiating fault detection according to any

    one of embodiments 38 to 40, Where the device for initiating fault detection fiarther

    includes:

20  a second adding unit, configured to add a node list to the first fault tracing

    detection request packet, Where the node list includes an ID of the previous-hop SF

    node of the first SF node on the service chain; and

    the first fault tracing detection response packet further includes an updated node

    list, the updated node list is a list generated after the ID of the first SF node is added

25 to the node list, and an order of all SF nodes included in the updated node list is the

    same as an order of all the SF nodes on the service chain.

    [0354] Embodiment 43, the device for initiating fault detection according to any

    one of embodiments 38 to 40, Where the device for initiating fault detection fiarther

    includes:

30  a second receiving unit, configured to receive a second fault tracing detection

    response packet from the SFE, where the second fault tracing detection response

    packet includes the path ID, an ID of the SFE, and the address of the device for

    initiating fault detection; and

    the first determining unit is further configured to: after the second fault tracing

                                       83
        detection response packet is received, determine that the service chain passes through
        the SFE, and forwarding between the SFE and the fault detection is normal.
        [0355] Embodiment 44, the device for initiating fault detection according to any
        one of embodiments 38 to 43, Where the device for initiating fault detection fiirther
        includes:

              a third receiving unit, configured to receive a third fault tracing detection
        response packet from the SFE, Where the third fault tracing detection response packet
        includes the path ID, an ID of a second SF node, and the address of the deVice for
        initiating fault detection, and the second SF node is a next-hop SF node of the first SF
10 node 011 the service chain; and

              the first determining unit is further configured to: after the third fault tracing
        detection response packet is received, determine that the service chain passes through
        the second SF node, and forwarding between the SFE and the second SF node is
        normal.
15 [0356] Embodiment 45, a service function SF apparatus, where the SF apparatus
        includes:

              a receiving unit, configured to receive a first fault tracing detection request
        packet from a service forwarding entity SFE, Where the first fault tracing detection
        request packet includes a path identifier ID and an address of a device for initiating
20 fault detection, and the path ID is used to identify a path of a service chain; and

              a sending unit, configured to send a second fault tracing detection request packet
        to the SFE, Where the second fault tracing detection request packet includes the path
        ID and the address of the device for initiating fault detection.
        [0357] Embodiment 46, the SF apparatus according to embodiment 45, Where the
25 first fault tracing detection request packet further includes a first parameter, the first
        parameter is used to identify the SF apparatus or is used to identify a previous-hop SF
        node of the SF apparatus 011 the service chain, and the second fault tracing detection
        request packet further includes at least one of the first parameter or an ID of the SF
         apparatus.
30 [0358] Embodiment 47, the SF apparatus according to embodiment 45 or 46,
        Where the first fault tracing detection request packet and the second fault tracing
        detection request packet each further includes a time to live TTL field;

              the SF apparatus fiirther includes:
              a first parameter updating unit, configured to obtain a TTL parameter, Where the

                                                                                        84
    TTL parameter is data obtained after a value of the TTL field included in the first fault

    tracing detection request packet is updated; and

    the first parameter updating unit is configured to use the TTL parameter as a

    value of the TTL field included in the second fault tracing detection request packet.

    [0359] Embodiment 48, the SF apparatus according to embodiment 45 or 46,

    Where the first fault tracing detection request packet further includes a node list, and

    the node list includes an ID of the previous-hop SF node of the SF apparatus 011 the

    service chain;

    the SF apparatus fiirther includes:

10  a second parameter updating unit, configured to obtain an updated node list,

    Where the updated node list is a list generated after the ID of the SF apparatus is

    added to the node list, and an order of all SF nodes in the updated node list is the same

    as an order of all the SF nodes 011 the service chain; and
         the second parameter updating unit is configured to add the updated node list to

15 the second fault tracing detection request packet.

                                         85

    Huawei Technologies C0., Ltd.
    EP 19 160 813.2
    H12303WOEP-A

                                   CLAIMS

          1. A service chain fault detection method, wherein the service chain comprises a plurality
    of service function nodes, and a packet passes through according to an order of the plurality of
    service function nodes, wherein the method comprises:

          obtaining, by a service forwarding entity, SFE (111), a first fault tracing detection request
    packet (1042) sent by a previous-hop SFE 0f the SFE 0n the service chain, wherein the first
    fault tracing detection request packet (1042) comprises a path identifier, ID, and the path ID
    is used to identify a path of a service chain;

    determining, by the SFE (111), a service function, SF, node (121), based on a forwarding

    entry stored in a memory (1102) of the SFE (111), to which the first fault tracing detection

10 request packet (1042) is to be sent, n;
               obtaining, by the SFE (111), an ID of the SF node (121) from the memory (1102) of the SFE

    (111);
          sending, by the SFE (111), a first fault tracing detection response packet (1032) to a device

    for initiating fault detection (131), wherein the first fault tracing detection response packet

15 (1032) comprises the path ID and the ID of the SF node (121); and

          wherein before the sending, by the SFE (111), the first fault tracing detection response
    packet (1032), the method further comprises: sending, by the SFE (111), a second fault tracing
    detection response packet to the device for initiating fault detection, wherein the second fault
    tracing detection response packet comprises an ID of the SFE (111) and the path ID.

20

    2. The method according to claim 1, wherein the determining, by an SFE (111), to

    communicate with the SF node (121), comprises:

    obtaining, by the SFE (111), a correspondence based on the path ID, wherein the

    correspondence comprises the path ID and an address of the SF node (121);

25  sending, by the SFE (111), the first fault tracing detection request packet (1042) to the SF

    node (121) according to the address of the SF node (121); and
          receiving, by the SFE (111), a second fault tracing detection request packet from the SF

    node (121), wherein the second fault tracing detection request packet comprises the path ID.

30  3. The method according to claim 1, wherein the first fault tracing detection request packet

    (1042) further comprises a first parameter, the first parameter is used to identify the SF node

    (121) or is used to identify a previous-hop SF node of the SF node (121) on the service chain;

    and the determining, by the SFE (111), to communicate with the SF node (121) comprises:

    obtaining, by the SFE (111), a correspondence based on the path ID and the first parameter,
                                                                                        2

    wherein the correspondence comprises the path ID, the first parameter and an address of the
    SF node (121);

          sending, by the SFE (111), the first fault tracing detection request packet (1042) to the SF
    node (121) according to the address of the SF node; and

          receiving, by the SFE (111), a second fault tracing detection request packet from the SF
    node (121), wherein the second fault tracing detection request packet comprises the path ID.

             4. The method according to claim 3, wherein the first fault tracing detection response
       packet (1032) further comprises at least one of the first parameter and an ID of the SFE (111).

10

             5. The method according to any one of claims 1 to 4, wherein the first fault tracing
       detection request packet (1042) further comprises a node list, and the node list comprises an
        ID of the previous-hop SF node of the SF node (121) on the service chain; and the first fault
       tracing detection response packet (1032) further comprises an updated node list, the updated
15 node list comprises the ID of the SF node (121) and the node list, and an order of all SF nodes
       comprised in the updated node list is the same as an order of all the SF nodes on the service
        chain.

             6. The method according to any one of claims 1 to 5, wherein the first fault tracing
20 detection request packet (1042) further comprises an ID of an SF node used as an end point;

       and
               after the sending, by the SFE (111), a first fault tracing detection response packet (1032) to

       the device for initiating fault detection, the method further comprises:
               ending, by the SFE (111), detection on the service chain when the ID of the SF node (121)

25 is the same as the ID of the SF node used as the end point.

             7. The method according to any one of claims 1 to 6, wherein the obtaining, by the SFE
       (111), a first fault tracing detection request packet (1042) comprises:

             receiving, by the SFE (111), the first fault tracing detection request packet (1042) from the
30 device for initiating fault detection; or

               receiving, by the SFE (111), the first fault tracing detection request packet (1042) from a
        previous-hop SFE of the SFE (111) on the service chain; or

             generating, by the SFE (111), the first fault tracing detection request packet (1042).

35  8. A service chain fault detection method, wherein the service chain comprises a plurality

    of service function nodes, and a packet passes through according to an order of the plurality of

    service function nodes, wherein the method comprises:

    sending, by a device for initiating fault detection (131), a first fault tracing detection
                                                                 3

    request packet (1042) to a service forwarding entity, SFE (111), wherein the first fault tracing
    detection request packet (1042) comprises a path identifier, ID, and the path ID is used to
    identify a path of a service chain;

          sendin (302) by the SFE (111) the first fault traein detection remzest basket (1042) to a
    service function SF node (121)-

          adding; b the SF node (121) an ID ofthe SF node (121) to the first fauit tmein detection

    mm: packetlméglg

          sendin T 03) by the SF node (121) the firSt fault tracing detection request packet (1042)

10  obtaining by the SFE (111) the ID 0fthe SF node (121) from the first fauit tracino detection

    mqueetbagkeittqg);

    receiving, by the device for initiating fault detection (131), a first fault tracing detection

    response packet (1032) from the SFE (111), wherein the first fault tracing detection response

    packet (1032) comprises the path ID and aetheID 0f etheeeiivieefenetiefiSF; node (121);

15  determining, by the device for initiating fault detection (131), that forwarding between the

    SFE (111) and the SF node (121) is normal based on the received ID of the SF node (121);

    wherein before the receiving, by the device for initiating fault detection (131), the first fault

    tracing detection response packet (1032), the method further comprises:

    receiving, by the device for initiating fault detection, a second fault tracing detection

20 response packet from the SFE (111), wherein the second fault tracing detection response packet
       comprises the path ID and an ID of the SFE (111); and

    determining, by the device for initiating fault detection, that forwarding between the SFE

    (111) and the device for initiating fault detection is normal based on the received ID of the SFE

    (111).

25

             9. The method according to claim 8, wherein the sending, by a device for initiating fault

    detection, a first fault tracing detection request packet (1042) to the SFE (111) comprises:

    obtaining, by the device for initiating fault detection, a correspondence based on the path

    ID, wherein the correspondence comprises the path ID and an address of the SFE (111); and

30  sending, by the device for initiating fault detection, the first fault tracing detection request

    packet (1042) to the SFE according to the address of the SFE (111).

              10. The method according to claim 8 0r 9, wherein the first fault tracing detection request
       packet (1042) further comprises a first parameter, and the first parameter is used to identify
35 the SF node (121) or is used to identify a previous-hop SF node of the SF node (121) on the
        service chain.

    11. The method according to any one of claims 8 to 10, wherein the first fault tracing
                                                                 4

    detection request packet (1042) further comprises a node list, and the node list comprises an
    ID of the previous-hop SF node of the SF node (121) on the service chain; and the first fault
    tracing detection response packet (1032) further comprises an updated node list, the updated
    node list comprises the ID of the SF node (121) and the node list, and an order of all SF nodes
    comprised in the updated node list is the same as an order of all the SF nodes on the service
    chain.

    12. A service forwarding apparatus (111), wherein the service forwarding apparatus (111)

    comprises:

10  a first communications unit (1103; 1105), configured to: obtain a first fault tracing

    detection request packet (1042) sent by a previous-hop SFE 0f the SFE 0n the service chain,

    wherein the first fault tracing detection request packet (1042) comprises a path identifier, ID,

    and the path ID is used to identify a path of a service chain and determine a service function,

    SF, node (121), based on a forwarding entry stored in a memory (1102) of the SFE (111), to

15 which the first fault tracing detection request packet (1042) is to be sent, wherein the service

    chain comprises a plurality of service function nodes, and a packet passes through according

    to an order of the plurality of service function nodes;

    a first obtaining unit, configured to obtain an ID of the SF node (121) from the memory

    (1102) of the SFE (111);

20  a first sending unit, configured to send a first fault tracing detection response packet (1032)

    to the device for initiating fault detection (131), wherein the first fault tracing detection

    response packet (1032) comprises the path ID and the ID of the SF node (121); and

    wherein the first sending unit is further configured to send a second fault tracing detection

    response packet to the device for initiating fault detection before sending the first fault tracing

25 detection response packet (1032), wherein the second fault tracing detection response packet

    comprises the path ID and an ID of the service forwarding apparatus.

    13. The service forwarding apparatus according to claim 12, wherein the first

    communications unit is specifically configured to:

30  obtain a correspondence based on the path ID, wherein the correspondence comprises the

    path ID and an address of the SF node (121);

    send the first fault tracing detection request packet (1042) to the SF node according to the

    address of the SF node (121) comprised in the correspondence; and

    receive a second fault tracing detection request packet from the SF node (121), wherein

35 the second fault tracing detection request packet comprises the path ID.

          14. The service forwarding apparatus according to claim 12, wherein the first fault tracing
    detection request packet (1042) further comprises a first parameter, the first parameter is used
                                                                 5

    to identify the SF node (121) or is used to identify a previous-hop SF node of the SF node (121)
    on the service chain; and the first communications unit is specifically configured to:

          obtain a correspondence based on the path ID and the first parameter, wherein the
    correspondence comprises the path ID, the first parameter and an address of the SF node (121);

          send the first fault tracing detection request packet (1042) to the SF node according to the
    address of the SF nod (121)e comprised in the correspondence; and

          receive a second fault tracing detection request packet from the SF node (121), wherein
    the second fault tracing detection request packet comprises the path ID.

10  15. The service forwarding apparatus according to claim 14, wherein the first fault tracing

    detection response packet (1032) further comprises at least one of the first parameter and an

    ID of the service forwarding apparatus.

              16. The service forwarding apparatus according to any one of claims 12 to 15, wherein the
15 first fault tracing detection request packet (1042) further comprises a node list, and the node

        list comprises an ID of the previous-hop SF node of the SF node (121) on the service chain; and
       the first fault tracing detection response packet (1032) further comprises an updated node list,
        the updated node list comprises the ID of the SF node (121) and the node list, and an order of
       all SF nodes comprised in the updated node list is the same as an order of all the SF nodes on
20 the service chain.

    17. The service forwarding apparatus according to any one of claims 12 to 16, wherein the

    first fault tracing detection request packet (1042) further comprises an ID of an SF node used
    as an end point; and

25  the service forwarding apparatus further comprises:

    a control unit, configured to: after the first sending unit sends the first fault tracing

    detection response packet (1032) to the device for initiating fault detection, determine that the

    ID of the SF node is the same as the ID of the SF node (121) used as the end point, and end

    detection on the service chain.

30

              18. The service forwarding apparatus according to any one of claims 12 to 17, wherein

    the first communications unit is specifically configured to receive the first fault tracing

    detection request packet (1042) from the device for initiating fault detection; or
         the first communications unit is specifically configured to receive the first fault tracing

35 detection request packet (1042) from a previous-hop SFE of the service forwarding apparatus
       on the service chain; or

         the first communications unit is specifically configured to generate the first fault tracing
    detection request packet (1042).
          19. A device for initiating fault detection (131), wherein the device for initiating fault
    detection (131) comprises:

          a sending unit (1306), configured to send a first fault tracing detection request packet
    (1042) to a service forwarding entity, SFE (111), wherein the first fault tracing detection request
    packet (1042) comprises a path identifier, ID, and the path ID is used to identify a path of a
    service chain, wherein the service chain comprises a plurality of service function nodes, and a

    sendin the first fault tracin detection request Backet (0142) to the SFE further comprises)"

10  the SFE (111) sends (£3702) the first fauit tracih ` detection reauest Dacket (1042) to a

    service function SF, 1'10d6(121)'
         the SF node (121) adds an ID of the SF node 121) to the first fault tracing detection

    £11119§1111¢ket {191421;

          the SF node (121) sends ($309)) the first fault tracimI detection request packet (1042) to

15

          the SFE (111 obtains the ID ofthe SF node (121) from the first fault traci r1 detection

    mghéitipegzlgefllgzwh

    a first receiving unit (1305), configured to receive a first fault tracing detection response

    packet (1032) from the SFE (111), wherein the first fault tracing detection response packet

20 (1032) comprises the path ID and anthem of aeeeeieeieeetieegthe SF; node (121);

    a first determining unit (1313), configured to determine that forwarding between the SFE

    (111) and the SF node (121) is normal based on the received ID of the SF node (121);
         wherein the device for initiating fault detection further comprises:

             a second receiving unit, configured to receive a second fault tracing detection response
25 packet from the SFE (111) before receiving a first fault tracing detection response packet (1032)

       from the SFE (111), wherein the second fault tracing detection response packet comprises the

    path ID and an ID of the SFE; and

    the first determining unit is further configured to determine that forwarding between the

    SFE (111) and the fault detection is normal based on the received ID of the SFE (111).

30

             20. The device for initiating fault detection according to claim 19, wherein the sending unit

    is specifically configured to:

          obtain a correspondence based on the path ID, wherein the correspondence comprises the
    path ID and an address of the SFE; and

35  send the first fault tracing detection request packet (1042) to the SFE (111) according to

    the address of the SFE (111) comprised in the correspondence.

    21. The device for initiating fault detection according to claim 19 or 20, wherein the first
                                                                     7

       fault tracing detection request packet (1042) further comprises a first parameter, and the first
       parameter is used to identify the SF node (121) or is used to identify a previous-hop SF node of
        the SF node (121) on the service chain.

             22. The device for initiating fault detection according to any one of claims 19 to 21, wherein
       the first fault tracing detection request packet (1042) further comprises a node list, wherein
        the node list comprises an ID of the previous-hop SF node of the SF node (121) on the service
        chain; and

             the first fault tracing detection response packet (1032) further comprises an updated node
10 list, the updated node list comprises the ID of the SF node (121) and the node list, and an order

       of all SF nodes comprised in the updated node list is the same as an order of all the SF nodes
        on the service chain.

             23. A system, comprising a service forwarding apparatus according to any one of claims
15 12 to 18, and a device for initiating fault detection according to any one of claims 19 to 22.

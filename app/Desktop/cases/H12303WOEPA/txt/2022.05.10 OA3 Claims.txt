    Huawei Technologies C0., Ltd.
    EP 19 160 813.2
    H12303WOEP-A

                                                               CLAIMS

             1. A service chain fault detection method, wherein the service chain comprises a plurality
       of service function nodes, and a packet passes through according to an order of the plurality of
       service function nodes, wherein the method comprises:

             obtaining, by a service forwarding entity, SFE (111), a first fault tracing detection request
       packet (1042), wherein the first fault tracing detection request packet (1042) comprises a bath
       identifier ID and the bath ID is used to identify a bath of a service chaimaeek

               determining, by the SFE (111), Wa service function, SF, node (121),
        based on a fowardine entry stored in a memory (1102) ofthe SFE (111), to which the first fauit
10 tracing detection request packet (1042) is to be sent, WWW

    sefiéeeehain;

         obtaining, by the SFE (111), an ID of the SF node (121) from the memory (1102) of the SFE
    111 ;

15  sending, by the SFE (111), a first fault tracing detection response packet(1932) to a device

    for initiating fault detection (131), wherein the first fault tracing detection response packet

    (1932) comprises the path ID and the ID of the SF node (121); and

    wherein before the sending by the SFE (111), the first fault tracing: detection resDonse

    packet {10321,

20 the method further comprises: sending, by the SFE {111), a second fault tracing detection
       response packet to the device for initiating fault detection, wherein the second fault tracing
       detection response packet comprises an ID of the SFE (111) and the path ID.

    2. The method according to claim 1, wherein the determining, by an SFE (111), to

25 communicate with thee SF n0de_(_1_21), comprises:

    obtaining, by the SFE_(11~1_), a correspondence based on the path ID, wherein the

    correspondence comprises the path ID and an address of the SF n0de_(1_2_1);

    sending, by the SFE»(1_1.1), the first fault tracing detection request packet(15142) to the SF

    node(121) according to the address of the SF n0de_(12_1_); and

30  receiving, by the SFE_(1;1), a second fault tracing detection request packet from the SF

    node (121), wherein the second fault tracing detection request packet comprises the path ID.

             3. The method according to claim 1, wherein the first fault tracing detection request packet
       {1042)fu1ther comprises a first parameter, the first parameter is used to identify the SF node
35 {121) or is used to identify a previous-hop SF node of the SF node {1211 on the service chain;
                                                                                        2

    and the determining, by thean SFE_{_1~1_1), to communicate with thga SF nodeL121) comprises:
          obtaining, by the SFELL11), a correspondence based on the path ID and the first parameter,

    wherein the correspondence comprises the path ID, the first parameter and an address of the
    SF node112;);

          sending, by the SFE10.11.), the first fault tracing detection request packet1mg) to the SF
    nodeLL21}. according to the address of the SF node; and

          receiving, by the SFE_L1_1_1), a second fault tracing detection request packet from the SF
    node (121}, wherein the second fault tracing detection request packet comprises the path ID.

10  4. The method according to claim 3, wherein the first fault tracing detection response

    packet 110321fuither comprises at least one of the first parameter and an ID of the SFE {111).

             5. The method according to any one of claims 1 to 4, wherein the first fault tracing
       detection request packet1194.2) further comprises a node list, and the node list comprises an
15 ID of the previous-hop SF node of the SF node11.2.1.) on the service chain; and the first fault
       tracing detection response packet135332) further comprises an updated node list, the updated
        node list comprises the ID of the SF node11213 and the node list, and an order of all SF nodes
       comprised in the updated node list is the same as an order of all the SF nodes on the service
        chain.

20

             6. The method according to any one of claims 1 to 5, wherein the first fault tracing
       detection request packet£1942) further comprises an ID of an SF node used as an end point;
       and

             after the sending, by the SFE11111, a first fault tracing detection response packet11132} to
25 the device for initiating fault detection, the method further comprises:

               ending, by the SFE11.11), detection on the service chain when the ID of the SF node112;)
       is the same as the ID of the SF node used as the end point.

    7. The method according to any one of claims 1 to 6, wherein the obtaining, by thean SFE

30 £111), a first fault tracing detection request packet£19142} comprises:

    receiving, by the SFE_(_1111, the first fault tracing detection request packet£1942 from the

    device for initiating fault detection; or

    receiving, by the SFEL111), the first fault tracing detection request packet11942) from a

    previous-hop SFE of the SFEL111) on the service chain; or

35  generating, by the SFE111;), the first fault tracing detection request packet11942).

          8. A service chain fault detection method, wherein the service chain comprises a plurality
    of service function nodes, and a packet passes through according to an order of the plurality of
                                              3

    service function nodes, wherein the method comprises:

          sending, by a device for initiating fault detection (131), a first fault tracing detection
    request packet(14142) to a service forwarding entity, SFE (111), wherein the first fault tracing

    detection request packet_(iggg) comprises a path identifier, ID, and the path ID is used to

    identify a path of a service chain;

    receiving, by the device for initiating fault detection (131), a first fault tracing detection

    response packet_(1932) from the SFE (111), wherein the first fault tracing detection response
    packet(193,2) comprises the path ID and an ID of a service function, SF, node (121);

    determining, by the device for initiating fault detection (131), that forwarding between the

10 SFE (111) and the SF node (121) is normal based on the received ID of the SF n0de_(12_1);

    wherein before the receiving, by the device for initiating fault detection (131), the first fault

    tracing detection response packet (1032)

    WWW, the method further
    comprises:

15  receiving, by the device for initiating fault detection, a second fault tracing detection

    response packet from the SFE_(111), wherein the second fault tracing detection response packet

    comprises the path ID and an ID of the SFE(11;); and

    determining, by the device for initiating fault detection, that forwarding between the SFE

    (111) and the device for initiating fault detection is normal based on the received ID of the SFE

20  111 .

             9. The method according to claim 8, wherein the sending, by a device for initiating fault
       detection, a first fault tracing detection request packet_(LQgflg) t0 the SFE,(_1.1.1_) comprises:

             obtaining, by the device for initiating fault detection, a correspondence based on the path
25 ID, wherein the correspondence comprises the path ID and an address of the SFE(111); and

             sending, by the device for initiating fault detection, the first fault tracing detection request
       packet_(ngg) t0 the SFE according to the address of the SFE,(_1.1_1,).

              10. The method according to claim 8 0r 9, wherein the first fault tracing detection request
30 packet {10422fu1ther comprises a first parameter, and the first parameter is used to identify

       the SF node {121) or is used to identify a previous-hop SF node of the SF node (121) on the
        service chain.

              11. The method according to any one of claims 8 to 10, wherein the first fault tracing
35 detection request packet11%) further comprises a node list, and the node list comprises an

       ID of the previous-hop SF node of the SF n0de_(,12_.1) 0n the service chain; and the first fault
       tracing detection response packet_(1932) further comprises an updated node list, the updated
        node list comprises the ID of the SF node112;) and the node list, and an order of all SF nodes
                                                                 4

    comprised in the updated node list is the same as an order of all the SF nodes on the service
    chain.

             12. A service forwarding apparatus (111), wherein the service forwarding apparatus (111)
       comprises:

               a first communications unit (1103; 1105), configured to: obtain a first fault tracing
       detection request packet (1042), wherein the first fauit tracing detection request packet (1042)
       comprises a path identifier ID and the path 1D is used to identifv a path of a service chain and
        theedetermine WWith--a service function, SF, node (121): based on a forwarding
10 entry stored in a memory (1102) of the SFE (111 to which the first fault tracing detection

       request Daeket (1042) is to be sent--whfwehe--the--fiesmeg--éekmfifiest--aaeket

    wherein the service chain comprises a plurality of service function nodes, and a packet passes

    through according to an order of the plurality of service function nodes;

15  a first obtaining unit, configured to obtain an ID of the SF node (121) from the memory

    g 1102 2 of the SFE (1111;

    a first sending unit, configured to send a first fault tracing detection response packet11032)

    t0 the device for initiating fault detection (131), wherein the first fault tracing detection

    response packetfiggg) comprises the path ID and the ID of the SF node (121); and

20  wherein the first sending unit is further configured to send a second fault tracing detection

    response packet to the device for initiating fault detection before sendin the first fault tracing

    detection response packet (1032), wherein the second fault tracing detection response packet

    comprises the path ID and an ID of the service forwarding apparatus.

25  13. The service forwarding apparatus according to claim 12, wherein the first

    communications unit is specifically configured to:

    obtain a correspondence based on the path ID, wherein the correspondence comprises the

    path ID and an address of the SF node(121);

    send the first fault tracing detection request packet_(1ogg) t0 the SF node according to the

30 address of the SF n0de(121) comprised in the correspondence; and

    receive a second fault tracing detection request packet from the SF n0de_(_12_1), wherein

    the second fault tracing detection request packet comprises the path ID.

              14. The service forwarding apparatus according to claim 12, wherein the first fault tracing
35 detection request packet_(1942) further comprises a first parameter, the first parameter is used

       to identify the SF nodeQ1) or is used to identify a previous-hop SF node of the SF n0de(121)
       0n the service chain; and the first communications unit is specifically configured to:

             obtain a correspondence based on the path ID and the first parameter, wherein the
                                                                     5

       correspondence comprises the path ID, the first parameter and an address of the SF node1121);
             send the first fault tracing detection request packet119,421 to the SF node according to the

       address of the SF nodjgggle comprised in the correspondence; and
             receive a second fault tracing detection request packet from the SF node112;), wherein

       the second fault tracing detection request packet comprises the path ID.

              15. The service forwarding apparatus according to claim 14, wherein the first fault tracing
       detection response packet {1032) further comprises at least one of the first parameter and an
       ID of the service forwarding apparatus.

10

              16. The service forwarding apparatus according to any one of claims 12 to 15, wherein the
       first fault tracing detection request packetitggtg) further comprises a node list, and the node
       list comprises an ID of the previous-hop SF node of the SF node112;) on the service chain; and
       the first fault tracing detection response packet@32) further comprises an updated node list,
15 the updated node list comprises the ID of the SF nodefigfl and the node list, and an order of
       all SF nodes comprised in the updated node list is the same as an order of all the SF nodes on
        the service chain.

              17. The service forwarding apparatus according to any one of claims 12 to 16, wherein the
20 first fault tracing detection request packet11%) further comprises an ID of an SF node used

       as an end point; and
             the service forwarding apparatus further comprises:
             a control unit, configured to: after the first sending unit sends the first fault tracing

       detection response packetgggg) to the device for initiating fault detection, determine that the
25 ID of the SF node is the same as the ID of the SF node112;) used as the end point, and end

        detection on the service chain.

              18. The service forwarding apparatus according to any one of claims 12 to 17, wherein
             the first communications unit is specifically configured to receive the first fault tracing
30 detection request packet1&2) from the device for initiating fault detection; or
             the first communications unit is specifically configured to receive the first fault tracing
       detection request packet11942} from a previous-hop SFE of the service forwarding apparatus
       on the service chain; or
             the first communications unit is specifically configured to generate the first fault tracing
35 detection request packet11942).

               19. A device for initiating fault detection (131), wherein the device for initiating fault
        detection (131) comprises:
                                                                     6

             a sending unit (1306), configured to send a first fault tracing detection request packet
        (1942) to a service forwarding entity, SFE (111), wherein the first fault tracing detection request
       packet(1042) comprises a path identifier, ID, and the path ID is used to identify a path of a
       service chain, wherein the service chain comprises a plurality of service function nodes, and a
       packet passes through according to an order of the plurality of service function nodes;

             a first receiving unit (1305), configured to receive a first fault tracing detection response
       packet(1032) from the SFE (111), wherein the first fault tracing detection response packet
       (1032) comprises the path ID and an ID of a service function, SF, node (121);

               a first determining unit (1313), configured to determine that forwarding between the SFE
10 (111) and the SF node (121) is normal based on the received ID of the SF n0de_(12_1);

             wherein the device for initiating fault detection further comprises:
             a second receiving unit, configured to receive a second fault tracing detection response
       packet from the SFE (111) before receiving a first fault tracing detection response packet (1032)
       from the SFE g 111 1, wherein the second fault tracing detection response packet comprises the
15 path ID and an ID of the SFE; and
             the first determining unit is further configured to determine that forwarding between the
        SFE(111) and the fault detection is normal based on the received ID of the SFE_(_1_1_1).

    20. The device for initiating fault detection according to claim 19, wherein the sending unit

20 is specifically configured to:
             obtain a correspondence based on the path ID, wherein the correspondence comprises the

    path ID and an address of the SFE; and

    send the first fault tracing detection request packet(1042) to the SFE(141) according to

    the address of the SFE,(_1,1.1_) comprised in the correspondence.

25

             21. The device for initiating fault detection according to claim 19 or 20, wherein the first

    fault tracing detection request packet(1042) further comprises a first parameter, and the first

    parameter is used to identify the SF n0de,(1_2.1_) or is used to identify a previous-hop SF node of

    the SF n0de(1;2~1) 0n the service chain.

30

             22. The device for initiating fault detection according to any one of claims 19 to 21, wherein

    the first fault tracing detection request packet,(1_0_4_2) further comprises a node list, wherein

    the node list comprises an ID of the previous-hop SF node of the SF n0de_(_1_2_1_) 0n the service

    chain; and

35  the first fault tracing detection response packet_(103g) further comprises an updated node

    list, the updated node list comprises the ID of the SF n0de(1_._21) and the node list, and an order
    of all SF nodes comprised in the updated node list is the same as an order of all the SF nodes

    on the service chain.
      23. A system, comprising a service forwarding apparatus according to any one of claims
12 to 18, and a device for initiating fault detection according to any one of claims 19 to 22.

14-07-2025 - Page 1
Patent Translate
Powered by EPO and Google
Notice
This translation is machine-generated. It cannot be guaranteed that it is intelligible, accurate,
complete, reliable or fit for specific purposes. Critical decisions, such as commercially
relevant or financial decisions, should not be based on machine-translation output.
DESCRIPTION CN109739690A
Backup methods and related products
[0001]
Technical Field
[0002]
The present application relates to the field of electronic technology, and in particular to a
backup method and related products.
[0003]
Background Art
[0004]
With the development of science and technology, data storage and management have
become more and more concerned. In order to meet the growing demand for data storage
and management, data storage and management services can be provided through clusters,
that is, data is backed up to a remote storage system to back up user data for a long time.
Currently, there are two ways to back up data, namely synchronous backup and
asynchronous backup. In synchronous backup, when the primary cluster writes data, the
primary cluster will synchronously back up the data to the standby cluster. In asynchronous
backup, when the primary cluster writes data, the primary cluster will delay backing up the
data to the standby cluster.
14-07-2025 - Page 2
Regardless of the backup method, the primary and backup clusters are required to have
backup support, and they must follow the same communication protocol to facilitate data
transmission, that is, they must be in the same system architecture. Since different
communication protocols are used for different backup clusters, when the backup cluster is
changed, the network architecture of the primary and backup clusters needs to be
readjusted.
[0005]
In the prior art, the data backup method is single, the process is cumbersome, and the user
experience is low.
[0006]
Summary of the invention
[0007]
The embodiments of the present application provide a backup method and related products,
so as to realize data backup between a primary cluster and a backup cluster in different
system frameworks, thereby increasing the data backup methods.
[0008]
In a first aspect, an embodiment of the present application provides a backup method, the
method comprising:
[0009]
Obtaining an input backup plan, and extracting a backup strategy in the backup plan,
wherein the backup strategy includes a backup target backup cluster and a backup mode;
[0010]
configuring parameters according to the backup strategy to establish a communication
connection with the target backup cluster;
[0011]
14-07-2025 - Page 3
Receive a write request from a client, extract a data identifier carried in the write request,
determine a primary cluster corresponding to the data identifier, write the data to be written
in the write request into the primary cluster, and back up the data to be written to the target
backup cluster based on the backup method.
[0012]
In a second aspect, an embodiment of the present application provides a backup device, the
backup device comprising:
[0013]
An acquisition unit, configured to acquire an input backup plan and extract a backup
strategy in the backup plan, wherein the backup strategy includes a backup target backup
cluster and a backup mode;
[0014]
A configuration unit, configured to configure parameters according to the backup strategy to
establish a communication connection with the target backup cluster;
[0015]
The backup unit is used to receive a write request from a client, extract a data identifier
carried in the write request, determine a primary cluster corresponding to the data identifier,
write the data to be written in the write request into the primary cluster, and back up the
data to be written to the target backup cluster based on the backup method.
[0016]
In a third aspect, an embodiment of the present application provides a device comprising a
processor, a memory, a communication interface, and one or more programs, wherein the
one or more programs are stored in the memory and configured to be executed by the
processor, and the program includes instructions for executing the steps in the method
described in the first aspect.
[0017]
In a fourth aspect, an embodiment of the present application provides a computer-readable
storage medium storing a computer program for electronic data exchange, wherein the
computer program enables a computer to execute the method described in the first aspect.
14-07-2025 - Page 4
[0018]
In a fifth aspect, an embodiment of the present application provides a computer program
product, which includes a non-transitory computer-readable storage medium storing a
computer program, and the computer is operable to cause the computer to execute the
method described in the first aspect.
[0019]
Implementing the embodiments of the present application has the following beneficial
effects:
[0020]
It can be seen that in an embodiment of the present application, the middleware receives an
input backup plan, configures parameters according to the backup plan, and thereby
establishes a communication connection with a target backup cluster. When a write request
is received, the middleware identifies the primary cluster to which the write request needs to
be written, writes the data to be written carried in the write request to the primary cluster,
and based on the backup method in the backup plan, backs up the data to be written to the
target backup cluster, thereby realizing data writing and backup by the middleware. No
communication connection is required between the primary cluster and the backup cluster,
and there is no need for the primary cluster and the backup cluster to belong to the same
network architecture. The single problem that the primary cluster and the backup cluster
must follow the same network protocol during backup is solved, and the backup method is
increased.
[0021]
BRIEF DESCRIPTION OF THE DRAWINGS
[0022]
In order to more clearly illustrate the technical solutions in the embodiments of the present
application, the drawings required for use in the description of the embodiments will be
briefly introduced below. Obviously, the drawings described below are some embodiments
of the present application. For ordinary technicians in this field, other drawings can be
obtained based on these drawings without paying any creative work.
[0023]
14-07-2025 - Page 5
FIG1A is a schematic diagram of a network architecture of a backup method provided in an
embodiment of the present application;
[0024]
FIG1B is a schematic diagram of a backup method according to an embodiment of the
present application;
[0025]
FIG2 is a schematic diagram of a flow chart of another backup method provided in an
embodiment of the present application;
[0026]
FIG3 is a flow chart of another backup method provided in an embodiment of the present
application;
[0027]
FIG4 is a schematic diagram of the structure of a backup device provided in an embodiment
of the present application;
[0028]
FIG. 5 is a block diagram of the functional units of a backup device provided in an
embodiment of the present application.
[0029]
DETAILED DESCRIPTION
[0030]
The technical solutions in the embodiments of the present application will be clearly and
completely described below in conjunction with the drawings in the embodiments of the
present application. Obviously, the described embodiments are only part of the
embodiments of the present application, rather than all of the embodiments.
Based on the embodiments in this application, all other embodiments obtained by ordinary
technicians in this field without making any creative work shall fall within the scope of
protection of this application.
14-07-2025 - Page 6
[0031]
The terms "first", "second", "third", "fourth" and the like in the specification, claims and
drawings of this application are used to distinguish different objects rather than to describe
a specific order.
In addition, the terms "includes," "comprises," and "has," and any variations thereof, are
intended to cover a non-exclusive inclusion.
For example, a process, method, system, product or apparatus comprising a series of steps
or units is not limited to the listed steps or units, but may optionally include unlisted steps or
units, or may optionally include other steps or units inherent to the process, method,
product or apparatus.
[0032]
Reference herein to an "embodiment" means that a particular feature, result, or
characteristic described in connection with the embodiment can be included in at least one
embodiment of the present application.
The appearances of this phrase in various places in the specification are not necessarily all
referring to the same embodiment, nor are separate or alternative embodiments mutually
exclusive of other embodiments.
It is understood explicitly and implicitly by those skilled in the art that the embodiments
described herein may be combined with other embodiments.
[0033]
The devices in the present application may include smart phones (such as Android phones,
iOS phones, Windows Phone phones, etc.), tablet computers, PDAs, laptops, mobile Internet
devices MID (Mobile Internet Devices, abbreviated as: MID) or wearable devices, etc. The
above devices are only examples and not exhaustive, including but not limited to the above
devices. For the convenience of description, the above devices are referred to as user
equipment UE (User equipment, abbreviated as: UE) in the following embodiments.
Of course, in practical applications, the user equipment is not limited to the above-
mentioned forms of realization, and may also include, for example: smart vehicle terminals,
computer equipment, etc.
[0034]
Below, some terms in this application are explained to facilitate understanding by those
skilled in the art.
14-07-2025 - Page 7
[0035]
Middleware is an independent system software or service program. Distributed application
software uses middleware to share resources between different technologies.
Middleware sits on top of the client/server operating system, manages computer resources
and network communications, and is software that connects two independent applications
or independent systems.
Connected systems can exchange information with each other through middleware even if
they have different interfaces.
[0036]
First, refer to FIG. 1A , which is a schematic diagram of a network architecture of a backup
method provided in an embodiment of the present application, wherein the network
architecture includes: a client 100 , a middleware 200 , a main cluster 300 , and a backup
cluster 400 , wherein the main cluster 300 and the backup cluster 400 may be one or more,
may be the same device, or may be different devices, and the present application does not
make a sole limitation;
[0037]
The client 100 is used to send a backup plan and a write request to the middleware 200;
[0038]
The middleware 200 is used to receive the backup plan and the write request from the client
100, configure the parameters in the configuration file of the middleware 200 according to
the backup plan, establish a communication connection with the standby cluster 400, extract
the data identifier carried in the write request, determine the primary cluster corresponding
to the data identifier, write the data to be written in the write request to the primary cluster,
and back up the written data to the standby cluster 400;
[0039]
The main cluster 300 is used to receive the data to be written sent by the middleware 200
and store the data to be written;
[0040]
The standby cluster 400 is configured to receive the data to be written sent by the
middleware 200 and store the data to be written.
14-07-2025 - Page 8
[0041]
It can be seen that in the embodiment of the present application, the middleware 200
receives the backup plan from the client 100, configures the parameters according to the
backup plan, and thus communicates with the corresponding target standby cluster 400, and
then receives the write request from the client 100, extracts the data to be written of the
write request, writes the data to be written to the main cluster 300, and backs up the data to
be written to the target standby cluster 400, thereby realizing the writing and backup of data
by the middleware, without the need for a communication connection between the main
cluster and the standby cluster, and without the need for the main cluster and the standby
cluster to belong to the same network architecture, which solves the single problem that the
main cluster and the standby cluster must follow the same network protocol during backup,
increases the backup method, and improves the user experience.
[0042]
First, refer to FIG. 1B , which is a flowchart of a backup method provided in an embodiment
of the present application. The method is applied to a device, and the device is applied to a
middleware. The method includes the contents shown in steps S101 to S103:
[0043]
Step S101: The middleware obtains an input backup plan and extracts a backup strategy in
the backup plan, wherein the backup strategy includes a backup target backup cluster and a
backup mode.
[0044]
Optionally, the middleware obtains input of the backup plan specifically including: receiving
a backup plan sent from the client, wherein the backup plan is selected by the user on the
visual interface of the client, for example, backup buttons are set on the visual interface of
the client, each backup button corresponds to a backup plan, and when the backup button is
clicked, the backup plan corresponding to the backup button is read and sent to the
middleware to indicate the middleware configuration parameters.
[0045]
The target backup cluster is a remote storage system for storing backup data, which may be
a Network Attached Storage (NAS) or a Distributed Storage System (DSS).
14-07-2025 - Page 9
[0046]
Step S102: The middleware configures parameters according to the backup strategy to
establish a communication connection with the target backup cluster.
[0047]
Optionally, the middleware configures parameters according to the backup strategy
specifically including:
[0048]
Identify the device identifier of the target backup cluster, wherein the device identifier is the
identification information of the device, which is used to indicate the device type. Each
backup cluster has unique identification information. A mapping relationship table between
the identification information and the network protocol cluster is pre-established. The
network protocol cluster corresponding to the device identifier is extracted from the
mapping relationship table. For example, when the target backup cluster is a NAS storage
system, the corresponding network protocol cluster includes the transmission control
protocol/internet protocol TCP/IP (Transmission Control Protocol/Internet Protocol, referred
to as TCP/IP), the packet exchange/sequenced packet exchange protocol IPX/SPX
(Internetwork Packet Exchange/Sequences Packet Exchange, referred to as: IPX/SPX), RS-485;
obtain the preset communication method with the target backup cluster, determine the
network protocol corresponding to the preset communication method in the network
protocol cluster, for example, when the preset communication method is a gateway, that is,
data is transmitted between the middleware and the target backup cluster via the network,
determine that the network protocol is TCP/IP, and when the preset communication method
is a wireless LAN, determine that the network protocol is IPX/SPX; therefore, the network
protocol corresponding to the target backup cluster can be determined according to the
mapping relationship between the device identifier, the preset communication method and
the network protocol; extract the driver corresponding to the network protocol from the
driver database, load the driver, and perform data backup with the target backup cluster
through the network protocol; wherein, the preset communication method includes at least
one of a serial port, a gateway and a wireless LAN.
[0049]
14-07-2025 - Page 10
Step S103: The middleware receives a write request from the client, extracts the data
identifier carried in the write request, determines the primary cluster corresponding to the
data identifier, writes the data to be written in the write request into the primary cluster, and
backs up the data to be written to the target backup cluster based on the backup method.
[0050]
Optionally, determining the primary cluster corresponding to the data identifier and writing
the data to be written in the write request into the primary cluster specifically includes:
performing a hash operation on the data identifier to obtain a hash value corresponding to
the data identifier, that is, using a hash calculation to transform an input of any length into
an output of a certain length through a hash algorithm, wherein the hash algorithm can be
the message digest algorithm MD5 (Message-DigestAlgorithm5, abbreviated as: MD5) or the
secure hash standard algorithm SHS (Secure Hash Standard) Standard, referred to as: SHS),
etc., use one of the above hash algorithms to calculate the target identifier to obtain a hash
value; after obtaining the hash value, perform a modulo operation on the hash value
according to a preset value to obtain a target key value, that is, y=(x, b), wherein x represents
the hash value, b identifies a preset value, specifically 500, 1000, 1500 or other values, y
represents the target key value, and mod represents a modulo operation; determine the
target main cluster corresponding to the target key value according to the mapping
relationship between the key value and the main cluster, and mark the target main cluster as
the main cluster corresponding to the data identifier; extract the save path carried in the
write request, and write the data to be written in the write request to the storage space of
the main cluster under the save path.
For example, when the saving path is E:\BaiduNetdiskDownload, the middleware saves the
data to the log file of the BaiduNetdiskDownload folder of the E disk, and writes the data to
be written to the main cluster.
[0051]
Furthermore, when the data to be written is written into the primary cluster, the data to be
written is backed up to the backup cluster according to the backup method. Specifically,
when the backup method is synchronous backup, a backup operation is performed while
writing to the primary cluster, and the data to be written is synchronously backed up to the
target backup cluster. If the backup method is asynchronous backup, a pre-set backup
interval is obtained, and the data to be written is first written into the primary cluster. When
the middleware receives a data write success response fed back by the primary cluster, a
backup operation is performed after the backup interval to back up the data to be written to
the target backup cluster.
14-07-2025 - Page 11
[0052]
The backup interval may be 1 minute, 2 minutes, 3 minutes or other values.
[0053]
It can be seen that in the embodiment of the present application, the middleware receives
an input backup plan, configures parameters according to the backup plan, and thereby
establishes a communication connection with the target backup cluster. When a write
request is received, the middleware identifies the primary cluster to which the write request
needs to be written, writes the data to be written carried in the write request to the primary
cluster, and based on the backup method in the backup plan, backs up the data to be written
to the target backup cluster, thereby realizing data writing and backup by the middleware.
No communication connection is required between the primary cluster and the backup
cluster, and there is no need for the primary cluster and the backup cluster to belong to the
same network architecture. The single problem that the primary cluster and the backup
cluster must follow the same network protocol during backup is solved, and backup methods
are increased. Moreover, different backup operations are performed for different backup
methods, so that different backup methods can be flexibly configured according to different
user needs, thereby further improving user experience.
[0054]
Optionally, in a possible example, the method includes:
[0055]
Before performing the backup operation, the data to be written is identified, and it is
determined whether the data to be written contains privacy words or privacy pictures. If so,
it is determined that the data to be written contains privacy information. When backing up
the data to be written to the target cluster, the data to be written is encrypted, and the
encrypted data is written to the target backup cluster. The encryption of the data to be
written specifically includes: obtaining encryption information from the client, wherein the
encryption information includes one of fingerprint information, iris information, and face ID
information, and using the encryption information to encrypt the write data, thereby
preventing malicious behavior from stealing the data to be written from the target backup
cluster, resulting in privacy leakage, and protecting user privacy.
Moreover, the entire encryption process is carried out without the user noticing, thus
improving the user experience.
14-07-2025 - Page 12
[0056]
Optionally, in a possible example, after receiving a write request from the client, the method
further includes:
[0057]
Extract the data to be written carried in the write request, obtain the memory of the data to
be written, if the memory of the data to be written is greater than a preset threshold, when
the backup mode is synchronous backup, send a prompt message to the client, the prompt
message is used to prompt the middleware to send an adjustment instruction to adjust the
backup mode to asynchronous backup.
The reason is that when the memory of the data to be written is too large, when
synchronous backup is adopted, it is necessary to wait for the write success information fed
back by the main cluster and the target backup cluster before processing the next write
request. Since the memory of the proxy write data is too large, when backing up the data to
be written to the target backup cluster, when synchronous backup is adopted, the time for
transmitting data with the target backup cluster through the network is long, the backup is
slow, and the waiting time is long. The process of writing data to the main cluster does not
require network transmission (it can be written through the serial port), so the time to write
to the main cluster is shorter, and when asynchronous backup is adopted, the thread that
takes a long time to back up to the target backup cluster can be run in the background, and
only the thread writing to the main cluster needs to be executed, that is, the backup time is
equivalent to the time required to write to the main cluster, so the time to process each write
request in the synchronous backup mode is shortened, which indirectly reduces the backup
time, does not increase the user's waiting time, and improves the user experience.
[0058]
The preset threshold may be 2GB, 5GB, 10GB or other values.
[0059]
Refer to FIG. 2 , which is a flow chart of another backup method provided in an embodiment
of the present application. The method is applied to a device, and the device is applied to a
middleware. The method includes the contents shown in steps S201 to S206:
[0060]
14-07-2025 - Page 13
Step S201: Obtain an input backup plan, and extract a backup strategy in the backup plan,
wherein the backup strategy includes a backup target backup cluster and a backup mode.
[0061]
Step S202: configuring parameters according to the backup strategy to establish a
communication connection with the target backup cluster.
[0062]
Step S203, receiving a write request from the client, extracting a data identifier carried in the
write request, determining a primary cluster corresponding to the data identifier, writing the
data to be written in the write request into the primary cluster, and backing up the data to
be written to the target backup cluster based on the backup method.
[0063]
Step S204: receiving confirmation character ACK information for the write request fed back
by the primary cluster and the target standby cluster, and determining the execution result
of the write request according to the ACK information fed back by the primary cluster and
the target standby cluster.
[0064]
Step S205: When the backup mode is synchronous backup, determine whether the first ACK
information for the write request fed back by the primary cluster and the second ACK
information for the write request fed back by the target backup cluster are received to obtain
the execution result of the write request.
[0065]
Specifically, if the first ACK information for the write request fed back by the main cluster and
the second ACK information for the write request fed back by the target backup cluster are
received, it is determined that the write operation and the backup operation of the write
request are successfully executed. The reason is that the synchronous backup method, that
is, the write operation and the backup operation are a thread, and it is necessary to ensure
that both operations are successfully executed, and the result of the thread is successful. If
only one operation success feedback information is received, the execution result of the
thread is failed. In the prior art, if the thread fails to execute, the thread will be executed
sequentially or the application will be exited (that is, the next write request will not be
allowed to be received). However, there will be many write requests when backing up data,
14-07-2025 - Page 14
so the current method causes a long waiting time for the user, so the following method is
adopted The following solution: if the first ACK information is not received, it is determined
that the write operation of the write request has failed, and the target standby cluster is
instructed to mark the data to be written as data to be stored. When it is determined that the
main cluster has recovered to normal, a data write request is sent to the standby cluster to
extract the data to be stored from the target standby cluster and write the data to be stored
to the main cluster; if the second ACK information is not received, it is determined that the
backup operation of the write request has failed, and the main cluster is instructed to mark
the written data as data to be backed up. When it is determined that the target standby
cluster has recovered to normal, a data backup request is sent to the main cluster to extract
the data to be backed up from the main cluster and back up the data to be backed up to the
target standby cluster.
[0066]
Step S206: When the backup mode is asynchronous backup, determine whether the third
ACK information for the write request fed back by the primary cluster is received to obtain
the execution result of the write request.
[0067]
Specifically, due to the asynchronous backup method, the backup operation and the write
operation are two independent threads, and the execution results of the two will not affect
each other. If the backup fails, the backup operation for the data to be written can be re-
executed in the background until the backup operation for the data to be written is
completed. Therefore, when receiving the write success information fed back by the main
cluster, there is no need to wait for whether the ACK information for the write request fed
back by the target backup cluster can be received. The backup operation of the data to be
written can be assumed to be successful, and the next write request can be received, and the
write operation and backup operation of the next request will be executed.
[0068]
It can be seen that in the embodiment of the present application, the middleware receives
an input backup plan, configures parameters according to the backup plan, and thereby
establishes a communication connection with the target backup cluster. When a write
request is received, the middleware identifies the primary cluster to which the write request
needs to be written, writes the data to be written carried in the write request to the primary
cluster, and based on the backup method in the backup plan, backs up the data to be written
14-07-2025 - Page 15
to the target backup cluster, thereby realizing data writing and backup by the middleware.
No communication connection is required between the primary cluster and the backup
cluster, and there is no need for the primary cluster and the backup cluster to belong to the
same network architecture. The single problem that the primary cluster and the backup
cluster must follow the same network protocol during backup is solved, and backup methods
are increased. Moreover, different backup operations are performed for different backup
methods, so that different backup methods can be flexibly configured according to different
user needs, thereby further improving user experience.
[0069]
Refer to FIG. 3 , which is a flow chart of another backup method provided in an embodiment
of the present application. The method is applied to a device, and the device is applied to a
middleware. The method includes the contents shown in steps S301 to S306:
[0070]
Step S301: Obtain an input backup plan, and extract a backup strategy in the backup plan,
wherein the backup strategy includes a backup target backup cluster and a backup mode.
[0071]
Step S302: configuring parameters according to the backup strategy to establish a
communication connection with the target backup cluster.
[0072]
Step S303: receiving a write request from a client, extracting a data identifier carried in the
write request, determining a primary cluster corresponding to the data identifier, and
writing the data to be written in the write request into the primary cluster.
[0073]
Step S304: add a timestamp to the data to be written, obtain the memory of the data to be
written, send storage space acquisition information to the target standby cluster to
determine the remaining storage space of the target standby cluster, and receive a response
from the standby cluster to the storage space acquisition information, wherein the response
carries the remaining storage space of the target standby cluster.
[0074]
14-07-2025 - Page 16
Step S305: If the remaining storage space is smaller than the memory for the data to be
written, a deletion instruction is sent to the target standby cluster, where the deletion
instruction is used to instruct the standby cluster to delete the target data in the backed-up
data.
[0075]
The target data is obtained by the backup cluster performing the following operations:
parsing the timestamp of the backed up data, obtaining the backup date of each backed up
data, determining the backup duration of each backed up data according to the backup date,
and marking the backed up data with a backup duration longer than a preset duration as the
target data.
[0076]
Furthermore, the target data can also be obtained by the backup cluster performing the
following operations: receiving the memory of the data to be written sent by the
middleware, parsing the timestamp of the backed up data, obtaining the backup date of
each backed up data, obtaining the memory of each backed up data, and calculating the
memory of the backed up data in the order of the backup date; when it is determined that
the memory of the backed up data is equal to or greater than the memory of the data to be
written, marking the backed up data involved in the calculation of the memory as the target
data.
[0077]
Step S306: upon receiving a deletion response to the deletion instruction fed back by the
standby cluster, backing up the data to be written and the timestamp of the data to be
written to the standby cluster based on the backup mode.
[0078]
It can be seen that in an embodiment of the present application, the middleware receives an
input backup plan, configures parameters according to the backup plan, and thereby
establishes a communication connection with a target standby cluster. When a write request
is received, the middleware identifies the primary cluster to which the write request needs to
be written, writes the data to be written carried in the write request to the primary cluster,
and based on the backup method in the backup plan, backs up the data to be written to the
target standby cluster, thereby realizing data writing and backup by the middleware. No
communication connection is required between the primary cluster and the standby cluster,
14-07-2025 - Page 17
and there is no need for the primary cluster and the standby cluster to belong to the same
network architecture. The single problem that the primary cluster and the standby cluster
must follow the same network protocol during backup is solved, and backup methods are
added. Moreover, different backup operations are performed for different backup methods,
so that different backup methods can be flexibly configured according to different user
needs, further improving user experience. Moreover, before backup, a timestamp is added
to the data to record the backup time. During backup, the data that has been backed up by
the target standby cluster is flexibly deleted based on the timestamp, thereby freeing up
space to backup new data, flexibly configuring the storage space of the target standby
cluster, and solving the problem of insufficient memory.
[0079]
Consistent with the embodiments shown in FIG. 1 , FIG. 2 , and FIG. 3 , please refer to FIG. 4 ,
which is a schematic diagram of the structure of a backup device 400 provided in an
embodiment of the present application. As shown in FIG. 4 , the device 400 includes a
processor, a memory, a communication interface, and one or more programs, wherein the
one or more programs are different from the one or more application programs, and the
one or more programs are stored in the memory and configured to be executed by the
processor, and the program includes instructions for executing the following steps;
[0080]
Obtaining an input backup plan, and extracting a backup strategy in the backup plan,
wherein the backup strategy includes a backup target backup cluster and a backup mode;
[0081]
configuring parameters according to the backup strategy to establish a communication
connection with the target backup cluster;
[0082]
Receive a write request from a client, extract a data identifier carried in the write request,
determine a primary cluster corresponding to the data identifier, write the data to be written
in the write request into the primary cluster, and back up the data to be written to the target
backup cluster based on the backup method.
[0083]
14-07-2025 - Page 18
In a possible example, in terms of configuring parameters according to the backup strategy
to establish a communication connection with the target standby cluster, the program is
specifically used to execute instructions of the following steps:
[0084]
Identify the device identifier of the target standby cluster;
[0085]
Acquire a preset communication mode with the target standby cluster;
[0086]
Determine the network protocol corresponding to the target standby cluster according to
the mapping relationship between the device identifier, the preset communication mode
and the network protocol;
[0087]
Extracting a driver corresponding to the network protocol from a driver database, loading
the driver, and performing data backup with the target standby cluster through the network
protocol;
[0088]
Wherein, the preset communication mode includes at least one of a serial port, a gateway
and a wireless local area network.
[0089]
In a possible example, in terms of determining the primary cluster corresponding to the data
identifier and writing the data to be written in the write request into the primary cluster, the
above program is specifically used to execute instructions of the following steps:
[0090]
Performing a hash operation on the data identifier to obtain a hash value corresponding to
the data identifier;
[0091]
14-07-2025 - Page 19
Perform a modulo operation on the hash value according to a preset value to obtain a target
key value;
[0092]
Determine a target main cluster corresponding to the target key value according to a
mapping relationship between the key value and the main cluster, and mark the target main
cluster as the main cluster corresponding to the data identifier;
[0093]
The save path carried in the write request is extracted, and the data to be written in the write
request is written into the storage space of the primary cluster under the save path.
[0094]
In a possible example, the above program is also used to execute instructions for the
following steps:
[0095]
Receive confirmation character ACK information for the write request fed back by the
primary cluster and the target standby cluster, and determine the execution result of the
write request according to the ACK information fed back by the primary cluster and the
target standby cluster.
[0096]
In a possible example, when the backup mode is synchronous backup, in terms of
determining the execution result of the write request according to the ACK information fed
back by the primary cluster and the target backup cluster, the above program is specifically
used to execute instructions of the following steps:
[0097]
If first ACK information for the write request fed back by the primary cluster and second ACK
information for the write request fed back by the target backup cluster are received, it is
determined that both the write operation and the backup operation of the write request are
successfully executed;
[0098]
14-07-2025 - Page 20
If the first ACK information is not received, it is determined that the write operation of the
write request has failed, the target standby cluster is instructed to mark the data to be
written as data to be stored, and when it is determined that the primary cluster has
recovered to normal, a data write request is sent to the standby cluster to extract the data to
be stored from the target standby cluster and write the data to be stored into the primary
cluster;
[0099]
If the second ACK information is not received, it is determined that the backup operation of
the write request has failed, and the primary cluster is instructed to mark the written data as
data to be backed up. When it is determined that the target backup cluster has recovered to
normal, a data backup request is sent to the primary cluster to extract the data to be backed
up from the primary cluster and back up the data to be backed up to the target backup
cluster.
[0100]
In a possible example, when the backup mode is asynchronous backup, in terms of
determining the execution result of the write request according to the ACK information fed
back by the primary cluster and the target backup cluster, the above program is specifically
used to execute the following steps:
[0101]
If the third ACK information for the write request fed back by the primary cluster is received,
it is determined that both the write operation and the backup operation for the write request
are successful.
[0102]
In a possible example, before backing up the data to be written to the target standby cluster,
the program is further used to execute instructions of the following steps:
[0103]
Adding a timestamp to the data to be written;
[0104]
14-07-2025 - Page 21
In terms of backing up the data to be written to the target backup cluster based on the
backup method, the above program is specifically used to execute instructions of the
following steps:
[0105]
When backing up the data to be written to the target standby cluster, obtaining the memory
of the data to be written, sending storage space acquisition information to the target
standby cluster to determine the remaining storage space of the target standby cluster, and
receiving a response from the standby cluster to the storage space acquisition information,
wherein the response carries the remaining storage space of the target standby cluster;
[0106]
If the remaining storage space is smaller than the memory of the data to be written, a
deletion instruction is sent to the target standby cluster, wherein the deletion instruction is
used to instruct the standby cluster to delete the target data in the backed up data, wherein
the target data is obtained by the standby cluster performing the following operations:
parsing the timestamp of the backed up data, obtaining the backup date of each backed up
data, determining the backup duration of each backed up data according to the backup date,
and marking the backed up data with a backup duration longer than a preset duration as the
target data;
[0107]
When receiving a deletion response to the deletion instruction fed back by the standby
cluster, the to-be-written data and the timestamp of the to-be-written data are backed up to
the standby cluster based on the backup mode.
[0108]
Referring to FIG. 5 , FIG. 5 shows a possible functional unit composition block diagram of an
apparatus 500 for the backup method involved in the above embodiment. The apparatus 500
includes: an acquisition unit 510, a configuration unit 520, and a backup unit 530, wherein:
[0109]
The acquisition unit 510 is used to acquire the input backup plan and extract the backup
strategy in the backup plan, wherein the backup strategy includes the backup target backup
cluster and the backup mode;
14-07-2025 - Page 22
[0110]
A configuration unit 520, configured to configure parameters according to the backup
strategy to establish a communication connection with the target backup cluster;
[0111]
The backup unit 530 is used to receive a write request from a client, extract a data identifier
carried in the write request, determine a primary cluster corresponding to the data identifier,
write the data to be written in the write request into the primary cluster, and back up the
data to be written to the target backup cluster based on the backup method.
[0112]
In a possible example, when configuring parameters according to the backup strategy to
establish a communication connection with the target backup cluster, the configuration unit
is specifically used to: identify the device identifier of the target backup cluster; and to
obtain a preset communication method with the target backup cluster; and to determine the
network protocol corresponding to the target backup cluster based on a mapping
relationship between the device identifier, the preset communication method and the
network protocol; and to extract a driver corresponding to the network protocol from a
driver database, load the driver, and perform data backup with the target backup cluster
through the network protocol; wherein the preset communication method includes at least
one of a serial port, a gateway and a wireless local area network.
[0113]
In a possible example, when determining the primary cluster corresponding to the data
identifier and writing the data to be written in the write request into the primary cluster, the
backup unit 530 is specifically used to: perform a hash operation on the data identifier to
obtain a hash value corresponding to the data identifier; and perform a modulo operation
on the hash value according to a preset value to obtain a target key value; and determine the
target primary cluster corresponding to the target key value according to a mapping
relationship between the key value and the primary cluster, and mark the target primary
cluster as the primary cluster corresponding to the data identifier; and extract the save path
carried in the write request, and write the data to be written in the write request to the
storage space of the primary cluster under the save path.
[0114]
14-07-2025 - Page 23
In a possible example, the electronic device 500 further includes a determining unit 540;
[0115]
The determination unit 540 is configured to receive confirmation character ACK information
for the write request fed back by the primary cluster and the target standby cluster, and
determine the execution result of the write request according to the ACK information fed
back by the primary cluster and the target standby cluster.
[0116]
In a possible example, when the backup mode is synchronous backup, when determining
the execution result of the write request according to the ACK information fed back by the
primary cluster and the target standby cluster, the backup unit 540 is specifically used to: if
first ACK information for the write request fed back by the primary cluster and second ACK
information for the write request fed back by the target standby cluster are received,
determine that the write operation and the backup operation of the write request are both
successfully executed; and if the first ACK information is not received, determine that the
write operation of the write request fails to execute, instruct the target standby cluster to
mark the to-be-written data as to-be-stored data, and when it is determined that the primary
cluster is restored to normal, send a data write request to the standby cluster to extract the
to-be-stored data from the target standby cluster and write the to-be-stored data to the
primary cluster; and if the second ACK information is not received, determine that the
backup operation of the write request fails to execute, instruct the primary cluster to mark
the written data as to-be-backed up data, and when it is determined that the target standby
cluster is restored to normal, send a data backup request to the primary cluster to extract
the to-be-backed up data from the primary cluster and back up the to-be-backed up data to
the target standby cluster.
[0117]
In a possible example, when the backup mode is asynchronous backup, when determining
the execution result of the write request according to the ACK information fed back by the
primary cluster and the target backup cluster, the backup unit 540 is specifically used to:
upon receiving the third ACK information for the write request fed back by the primary
cluster, determine that both the write operation and the backup operation of the write
request are successful.
[0118]
14-07-2025 - Page 24
In a possible example, the electronic device 500 further includes an adding unit 550;
[0119]
Among them, the adding unit 550 is used to add a timestamp to the data to be written.
When the data to be written is backed up to the target backup cluster based on the backup
method, the backup unit 530 is specifically used to: when the data to be written is backed up
to the target backup cluster, obtain the memory of the data to be written, send storage
space acquisition information to the target backup cluster to determine the remaining
storage space of the target backup cluster, receive a response from the backup cluster to the
storage space acquisition information, and the response carries the remaining storage space
of the target backup cluster; and if the remaining storage space is less than the memory of
the data to be written, A deletion instruction is sent to the target standby cluster, where the
deletion instruction is used to instruct the standby cluster to delete target data in the backed
up data, where the target data is obtained by the standby cluster performing the following
operations: parsing the timestamp of the backed up data, obtaining the backup date of each
backed up data, determining the backup duration of each backed up data according to the
backup date, and marking the backed up data with a backup duration longer than a preset
duration as target data; and when a deletion response to the deletion instruction is received
from the standby cluster, backing up the data to be written and the timestamp of the data to
be written to the standby cluster based on the backup method.
[0120]
An embodiment of the present application also provides a computer storage medium,
wherein the computer storage medium stores a computer program for electronic data
exchange, and the computer program enables a computer to execute part or all of the steps
of any backup method recorded in the above method embodiments.
[0121]
An embodiment of the present application also provides a computer program product,
which includes a non-transitory computer-readable storage medium storing a computer
program, and the computer program is operable to cause a computer to execute part or all
of the steps of any backup method recorded in the above method embodiments.
[0122]
It should be noted that, for the sake of simplicity of description, the aforementioned method
embodiments are all expressed as a series of action combinations, but those skilled in the art
14-07-2025 - Page 25
should know that the present application is not limited to the described order of actions,
because according to the present application, certain steps may be performed in other
orders or simultaneously.
Secondly, those skilled in the art should also be aware that the embodiments described in
the specification are all optional embodiments, and the actions and modules involved are
not necessarily required for this application.
[0123]
In the above embodiments, the description of each embodiment has its own emphasis. For
parts that are not described in detail in a certain embodiment, reference can be made to the
relevant descriptions of other embodiments.
[0124]
In several embodiments provided in this application, it should be understood that the
disclosed device can be implemented in other ways.
For example, the device embodiments described above are merely illustrative. For example,
the division of the units is merely a logical function division. There may be other division
methods in actual implementation. For example, multiple units or components may be
combined or integrated into another system, or some features may be ignored or not
executed.
Another point is that the mutual coupling or direct coupling or communication connection
shown or discussed may be an indirect coupling or communication connection through
some interface, device or unit, which may be electrical or other forms.
[0125]
The units described as separate components may or may not be physically separated, and
the components shown as units may or may not be physical units, that is, they may be
located in one place or distributed over multiple network units.
Some or all of the units may be selected according to actual needs to achieve the purpose of
the solution of this embodiment.
[0126]
In addition, each functional unit in each embodiment of the present application may be
integrated into one processing unit, or each unit may exist physically separately, or two or
more units may be integrated into one unit.
14-07-2025 - Page 26
The above integrated unit can be implemented in the form of hardware or in the form of a
software program module.
[0127]
If the integrated unit is implemented in the form of a software program module and sold or
used as an independent product, it can be stored in a computer-readable memory.
Based on this understanding, the technical solution of the present application, or the part
that contributes to the prior art, or all or part of the technical solution can be embodied in
the form of a software product. The computer software product is stored in a memory and
includes a number of instructions for enabling a computer device (which may be a personal
computer, server or network device, etc.) to execute all or part of the steps of the method
described in each embodiment of the present application.
The aforementioned memory includes: U disk, read-only memory (ROM), random access
memory (RAM), mobile hard disk, magnetic disk or optical disk and other media that can
store program code.
[0128]
A person skilled in the art can understand that all or part of the steps in the various methods
of the above embodiments can be completed by instructing related hardware through a
program, and the program can be stored in a computer-readable memory, and the memory
can include: a flash drive, a read-only memory (English: Read-Only Memory, abbreviated as:
ROM), a random access memory (English: Random Access Memory, abbreviated as: RAM), a
magnetic disk or an optical disk, etc.
[0129]
The embodiments of the present application are introduced in detail above. Specific
examples are used in this article to illustrate the principles and implementation methods of
the present application. The description of the above embodiments is only used to help
understand the method and core idea of the present application. At the same time, for
general technical personnel in this field, according to the idea of the present application,
there will be changes in the specific implementation method and application scope. In
summary, the content of this specification should not be understood as a limitation on the
present application.
14-07-2025 - Page 1
Patent Translate
Powered by EPO and Google
Notice
This translation is machine-generated. It cannot be guaranteed that it is intelligible, accurate,
complete, reliable or fit for specific purposes. Critical decisions, such as commercially
relevant or financial decisions, should not be based on machine-translation output.
CLAIMS CN109739690A
1.
A backup method, characterized in that the method comprises:
Obtaining an input backup plan, and extracting a backup strategy in the backup plan,
wherein the backup strategy includes a backup target backup cluster and a backup mode;
configuring parameters according to the backup strategy to establish a communication
connection with the target backup cluster;
Receive a write request from a client, extract a data identifier carried in the write request,
determine a primary cluster corresponding to the data identifier, write the data to be written
in the write request into the primary cluster, and back up the data to be written to the target
backup cluster based on the backup method.
2.
The method according to claim 1, characterized in that configuring parameters according to
the backup strategy to establish a communication connection with the target backup cluster
specifically comprises:
Identify the device identifier of the target standby cluster;
Acquire a preset communication mode with the target standby cluster;
Determine the network protocol corresponding to the target standby cluster according to
the mapping relationship between the device identifier, the preset communication mode
and the network protocol;
Extracting a driver corresponding to the network protocol from a driver database, loading
the driver, and performing data backup with the target standby cluster through the network
protocol;
14-07-2025 - Page 2
Wherein, the preset communication mode includes at least one of a serial port, a gateway
and a wireless local area network.
3.
The method according to claim 1 or 2, characterized in that determining the primary cluster
corresponding to the data identifier and writing the data to be written in the write request
into the primary cluster specifically comprises:
Performing a hash operation on the data identifier to obtain a hash value corresponding to
the data identifier;
Perform a modulo operation on the hash value according to a preset value to obtain a target
key value;
Determine a target main cluster corresponding to the target key value according to a
mapping relationship between the key value and the main cluster, and mark the target main
cluster as the main cluster corresponding to the data identifier;
The save path carried in the write request is extracted, and the data to be written in the write
request is written into the storage space of the primary cluster under the save path.
4.
The method according to any one of claims 1 to 3, characterized in that the method further
comprises:
Receive confirmation character ACK information for the write request fed back by the
primary cluster and the target standby cluster, and determine the execution result of the
write request according to the ACK information fed back by the primary cluster and the
target standby cluster.
5.
The method according to claim 4, characterized in that when the backup mode is
synchronous backup, determining the execution result of the write request according to the
ACK information fed back by the primary cluster and the target backup cluster specifically
includes:
If first ACK information for the write request fed back by the primary cluster and second ACK
information for the write request fed back by the target backup cluster are received, it is
determined that both the write operation and the backup operation of the write request are
successfully executed;
If the first ACK information is not received, it is determined that the write operation of the
write request has failed, the target standby cluster is instructed to mark the data to be
14-07-2025 - Page 3
written as data to be stored, and when it is determined that the primary cluster has
recovered to normal, a data write request is sent to the standby cluster to extract the data to
be stored from the target standby cluster and write the data to be stored into the primary
cluster;
If the second ACK information is not received, it is determined that the backup operation of
the write request has failed, and the primary cluster is instructed to mark the written data as
data to be backed up. When it is determined that the target backup cluster has recovered to
normal, a data backup request is sent to the primary cluster to extract the data to be backed
up from the primary cluster and back up the data to be backed up to the target backup
cluster.
6.
The method according to claim 4, characterized in that when the backup mode is
asynchronous backup, determining the execution result of the write request according to the
ACK information fed back by the primary cluster and the target backup cluster specifically
includes:
If the third ACK information for the write request fed back by the primary cluster is received,
it is determined that both the write operation and the backup operation for the write request
are successful.
7.
The method according to claim 1, characterized in that before backing up the data to be
written to the target standby cluster, the method further comprises:
Adding a timestamp to the data to be written;
Based on the backup method, backing up the data to be written to the target backup cluster
specifically includes:
When backing up the data to be written to the target standby cluster, obtaining the memory
of the data to be written, sending storage space acquisition information to the target
standby cluster to determine the remaining storage space of the target standby cluster, and
receiving a response from the standby cluster to the storage space acquisition information,
wherein the response carries the remaining storage space of the target standby cluster;
If the remaining storage space is smaller than the memory of the data to be written, a
deletion instruction is sent to the target standby cluster, wherein the deletion instruction is
used to instruct the standby cluster to delete the target data in the backed up data, wherein
the target data is obtained by the standby cluster performing the following operations:
parsing the timestamp of the backed up data, obtaining the backup date of each backed up
data, determining the backup duration of each backed up data according to the backup date,
14-07-2025 - Page 4
and marking the backed up data with a backup duration longer than a preset duration as the
target data;
When receiving a deletion response to the deletion instruction fed back by the standby
cluster, the to-be-written data and the timestamp of the to-be-written data are backed up to
the standby cluster based on the backup mode.
8.
A backup device, characterized in that the backup device comprises:
An acquisition unit, configured to acquire an input backup plan and extract a backup
strategy in the backup plan, wherein the backup strategy includes a backup target backup
cluster and a backup mode;
A configuration unit, configured to configure parameters according to the backup strategy to
establish a communication connection with the target backup cluster;
The backup unit is used to receive a write request from a client, extract a data identifier
carried in the write request, determine a primary cluster corresponding to the data identifier,
write the data to be written in the write request into the primary cluster, and back up the
data to be written to the target backup cluster based on the backup method.
9.
A device, characterized in that it comprises a processor, a memory, a communication
interface and one or more programs, wherein the one or more programs are stored in the
memory and are configured to be executed by the processor, and the program includes
instructions for executing the steps in any one of the methods of claims 1-7.
10.
A computer-readable storage medium, characterized in that it is used to store a computer
program, wherein the computer program is executed by a processor to implement the
method according to any one of claims 1 to 7.
